<!doctype html>
<html lang="pt-BR">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sistema de Gest√£o de Oficina</title>
  <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            box-sizing: border-box;
            font-family: Arial, 'Times New Roman', serif;
            min-height: 100%;
            transition: all 0.3s ease;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #e0e0e0;
        }

        html, body {
            height: 100%;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100%;
            border-radius: 15px;
        }

        header {
            padding: 30px;
            border-radius: 20px;
            margin-bottom: 30px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
            transition: all 0.3s ease;
            position: relative;
            background: rgba(30, 30, 50, 0.98);
        }

        header:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.2);
        }

        h1 {
            font-size: 42px;
            background: linear-gradient(135deg, #1e88e5 0%, #00acc1 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-align: center;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .subtitle {
            text-align: center;
            color: #718096;
            font-size: 18px;
            font-style: italic;
        }

        nav {
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            justify-content: center;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.1);
            background: rgba(30, 30, 50, 0.98);
        }

        .nav-btn {
            color: white;
            border: none;
            padding: 14px 28px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 15px;
            font-family: Arial, sans-serif;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(30, 136, 229, 0.3);
            background: linear-gradient(135deg, #1e88e5 0%, #00acc1 100%);
        }

        .nav-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(30, 136, 229, 0.4);
        }

        .nav-btn.active {
            background: linear-gradient(135deg, #43a047 0%, #2e7d32 100%);
            box-shadow: 0 6px 25px rgba(67, 160, 71, 0.4);
        }

        .content-section {
            padding: 35px;
            border-radius: 20px;
            margin-bottom: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            display: none;
            animation: fadeIn 0.5s ease;
            background: rgba(30, 30, 50, 0.98);
            color: #e0e0e0;
        }

        .content-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        h2 {
            color: #1e88e5;
            margin-bottom: 25px;
            font-size: 32px;
            font-weight: bold;
            border-bottom: 3px solid #00acc1;
            padding-bottom: 12px;
        }

        h3 {
            color: #00acc1;
            margin-bottom: 15px;
            font-size: 20px;
            font-weight: 600;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            font-size: 14px;
            color: #b0b0c0;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #3a3a5e;
            border-radius: 10px;
            font-size: 14px;
            font-family: Arial, sans-serif;
            transition: all 0.3s ease;
            background: #2a2a3e;
            color: #e0e0e0;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #1e88e5;
            box-shadow: 0 0 0 3px rgba(30, 136, 229, 0.1);
        }

        textarea {
            resize: vertical;
            min-height: 100px;
        }

        .btn {
            color: white;
            border: none;
            padding: 14px 32px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-family: Arial, sans-serif;
            font-weight: 600;
            transition: all 0.3s ease;
            margin-right: 10px;
            margin-top: 10px;
            box-shadow: 0 4px 15px rgba(30, 136, 229, 0.3);
            background: linear-gradient(135deg, #1e88e5 0%, #00acc1 100%);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(30, 136, 229, 0.4);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-danger {
            background: linear-gradient(135deg, #e53935 0%, #c62828 100%);
            box-shadow: 0 4px 15px rgba(229, 57, 53, 0.3);
        }

        .btn-danger:hover {
            box-shadow: 0 6px 25px rgba(229, 57, 53, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #43a047 0%, #2e7d32 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(67, 160, 71, 0.3);
        }

        .btn-secondary:hover {
            box-shadow: 0 6px 25px rgba(67, 160, 71, 0.4);
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 13px;
        }

        .message {
            padding: 16px 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            font-size: 15px;
            animation: slideDown 0.5s ease;
            border-left: 5px solid;
            font-weight: 500;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.success {
            background: #d4edda;
            border-color: #28a745;
            color: #155724;
        }

        .message.error {
            background: #f8d7da;
            border-color: #dc3545;
            color: #721c24;
        }

        .message.info {
            background: #d1ecf1;
            border-color: #17a2b8;
            color: #0c5460;
        }

        .radio-group {
            display: flex;
            gap: 25px;
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(30, 136, 229, 0.05);
            border-radius: 10px;
        }

        .radio-group label {
            display: flex;
            align-items: center;
            cursor: pointer;
            font-weight: 600;
        }

        .radio-group input[type="radio"] {
            width: auto;
            margin-right: 8px;
            cursor: pointer;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
        }

        th, td {
            padding: 16px;
            text-align: left;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        th {
            color: white;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 13px;
            letter-spacing: 0.5px;
            background: linear-gradient(135deg, #1e88e5 0%, #00acc1 100%);
        }

        tr:hover {
            transition: all 0.3s ease;
            background: rgba(30, 136, 229, 0.1);
        }

        tr:last-child td {
            border-bottom: none;
        }

        .action-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .search-box {
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 25px;
            border: 2px solid rgba(30, 136, 229, 0.2);
            background: rgba(30, 30, 50, 0.98);
        }

        .card {
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 25px;
            border: 2px solid rgba(30, 136, 229, 0.2);
            transition: all 0.3s ease;
            background: rgba(30, 30, 50, 0.98);
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .stat-card {
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            border: 2px solid rgba(30, 136, 229, 0.4);
            transition: all 0.3s ease;
            background: linear-gradient(135deg, rgba(30, 136, 229, 0.15) 0%, rgba(0, 172, 193, 0.15) 100%);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 30px rgba(30, 136, 229, 0.2);
        }

        .stat-value {
            font-size: 40px;
            font-weight: bold;
            background: linear-gradient(135deg, #1e88e5 0%, #00acc1 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: 10px 0;
        }

        .stat-label {
            font-size: 16px;
            font-weight: 600;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .os-items {
            padding: 20px;
            border-radius: 12px;
            margin-top: 20px;
            border: 2px solid rgba(30, 136, 229, 0.2);
        }

        .os-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .os-item:hover {
            background: rgba(30, 136, 229, 0.05);
        }

        .os-item:last-child {
            border-bottom: none;
        }

        .total-section {
            background: linear-gradient(135deg, #1e88e5 0%, #00acc1 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin-top: 20px;
            text-align: right;
            font-size: 24px;
            font-weight: bold;
            box-shadow: 0 4px 20px rgba(30, 136, 229, 0.3);
        }

        .badge {
            display: inline-block;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .badge-open {
            background: #fff3cd;
            color: #856404;
        }

        .badge-closed {
            background: #d4edda;
            color: #155724;
        }

        .badge-paid {
            background: #d4edda;
            color: #155724;
        }

        .badge-pending {
            background: #fff3cd;
            color: #856404;
        }

        .search-results {
            border: 2px solid rgba(30, 136, 229, 0.3);
            border-radius: 10px;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 10px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        .search-result-item {
            padding: 15px;
            cursor: pointer;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .search-result-item:hover {
            background: rgba(30, 136, 229, 0.2);
        }

        .search-result-item:last-child {
            border-bottom: none;
        }

        .selected-client {
            padding: 20px;
            border-radius: 12px;
            margin-top: 15px;
            border: 2px solid #1e88e5;
            background: linear-gradient(135deg, rgba(30, 136, 229, 0.2) 0%, rgba(0, 172, 193, 0.2) 100%);
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            border-bottom: 2px solid rgba(30, 136, 229, 0.2);
            padding-bottom: 10px;
        }

        .tab {
            padding: 12px 24px;
            background: transparent;
            border: none;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            border-radius: 8px 8px 0 0;
            transition: all 0.3s ease;
            color: #e0e0e0;
        }

        .tab:hover {
            background: rgba(30, 136, 229, 0.1);
        }

        .tab.active {
            background: linear-gradient(135deg, #1e88e5 0%, #00acc1 100%);
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .edit-panel {
            position: fixed;
            top: 0;
            right: -600px;
            width: 600px;
            height: 100%;
            box-shadow: -5px 0 30px rgba(0, 0, 0, 0.3);
            transition: right 0.4s ease;
            z-index: 1000;
            overflow-y: auto;
            padding: 30px;
            background: #1e1e32;
        }

        .edit-panel.open {
            right: 0;
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            z-index: 999;
            transition: opacity 0.3s ease;
        }

        .overlay.active {
            display: block;
        }

        .close-panel {
            position: absolute;
            top: 20px;
            right: 20px;
            background: #e53935;
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 20px;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .close-panel:hover {
            transform: rotate(90deg);
            background: #c62828;
        }

        .item-quantity {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .qty-btn {
            background: #1e88e5;
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .qty-btn:hover {
            background: #1565c0;
            transform: scale(1.1);
        }

        .qty-display {
            min-width: 40px;
            text-align: center;
            font-weight: bold;
            font-size: 16px;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }

            nav {
                flex-direction: column;
            }

            .nav-btn {
                width: 100%;
            }

            h1 {
                font-size: 28px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .edit-panel {
                width: 100%;
                right: -100%;
            }

            .tabs {
                flex-wrap: wrap;
            }
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="/_sdk/element_sdk.js" type="text/javascript"></script>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
  <div class="overlay" id="overlay" onclick="closeEditPanel()"></div>
  <div class="container">
   <header>
    <h1 id="systemTitle">Sistema de Gest√£o de Oficina</h1>
    <p class="subtitle" id="companyName">Auto Mec√¢nica Premium</p>
   </header>
   <nav><button class="nav-btn active" onclick="showSection('clientes')">üë• Clientes</button> <button class="nav-btn" onclick="showSection('servicos')">üîß Servi√ßos</button> <button class="nav-btn" onclick="showSection('ordens')">üìã Ordens de Servi√ßo</button> <button class="nav-btn" onclick="showSection('contasPagar')">üí∞ Contas a Pagar</button> <button class="nav-btn" onclick="showSection('contasReceber')">üíµ Contas a Receber</button> <button class="nav-btn" onclick="showSection('relatorios')">üìä Relat√≥rios</button>
   </nav>
   <div id="messageContainer"></div><!-- Se√ß√£o Clientes -->
   <section id="clientes" class="content-section active">
    <div class="tabs"><button class="tab active" onclick="showTab('cadastroCliente')">Cadastrar</button> <button class="tab" onclick="showTab('pesquisaCliente')">Pesquisar</button>
    </div>
    <div id="cadastroCliente" class="tab-content active">
     <h2>Cadastro de Clientes</h2>
     <div class="radio-group"><label> <input type="radio" name="tipoCliente" value="fisica" checked onchange="toggleClienteForm()"> Pessoa F√≠sica </label> <label> <input type="radio" name="tipoCliente" value="juridica" onchange="toggleClienteForm()"> Pessoa Jur√≠dica </label>
     </div>
     <form id="formCliente" onsubmit="salvarCliente(event)">
      <div id="camposFisica">
       <div class="form-row">
        <div class="form-group"><label for="nomeCliente">Nome *</label> <input type="text" id="nomeCliente" required>
        </div>
        <div class="form-group"><label for="cpfCliente">CPF</label> <input type="text" id="cpfCliente" maxlength="14" placeholder="000.000.000-00" oninput="maskCPF(this)">
        </div>
       </div>
       <div class="form-row">
        <div class="form-group"><label for="telefoneCliente">Telefone *</label> <input type="text" id="telefoneCliente" required maxlength="15" placeholder="(00) 00000-0000" oninput="maskPhone(this)">
        </div>
        <div class="form-group"><label for="cepCliente">CEP</label> <input type="text" id="cepCliente" maxlength="9" placeholder="00000-000" oninput="maskCEP(this)">
        </div>
       </div>
       <div class="form-group"><label for="enderecoCliente">Endere√ßo</label> <input type="text" id="enderecoCliente">
       </div>
      </div>
      <div id="camposJuridica" style="display: none;">
       <div class="form-row">
        <div class="form-group"><label for="nomeEmpresa">Nome *</label> <input type="text" id="nomeEmpresa">
        </div>
        <div class="form-group"><label for="cnpjEmpresa">CNPJ *</label> <input type="text" id="cnpjEmpresa" maxlength="18" placeholder="00.000.000/0000-00" oninput="maskCNPJ(this)">
        </div>
       </div>
       <div class="form-row">
        <div class="form-group"><label for="razaoSocial">Raz√£o Social *</label> <input type="text" id="razaoSocial">
        </div>
        <div class="form-group"><label for="nomeFantasia">Nome Fantasia</label> <input type="text" id="nomeFantasia">
        </div>
       </div>
       <div class="form-row">
        <div class="form-group"><label for="inscricaoEstadual">Inscri√ß√£o Estadual *</label> <input type="text" id="inscricaoEstadual">
        </div>
        <div class="form-group"><label for="inscricaoMunicipal">Inscri√ß√£o Municipal</label> <input type="text" id="inscricaoMunicipal">
        </div>
       </div>
       <div class="form-row">
        <div class="form-group"><label for="emailEmpresa">E-mail</label> <input type="email" id="emailEmpresa">
        </div>
        <div class="form-group"><label for="telefoneEmpresa">Telefone</label> <input type="text" id="telefoneEmpresa" maxlength="15" placeholder="(00) 00000-0000" oninput="maskPhone(this)">
        </div>
       </div>
       <div class="form-row">
        <div class="form-group"><label for="cepEmpresa">CEP</label> <input type="text" id="cepEmpresa" maxlength="9" placeholder="00000-000" oninput="maskCEP(this)">
        </div>
        <div class="form-group"><label for="enderecoEmpresa">Endere√ßo</label> <input type="text" id="enderecoEmpresa">
        </div>
       </div>
      </div><button type="submit" class="btn" id="btnSalvarCliente">üíæ Cadastrar Cliente</button> <button type="button" class="btn btn-secondary" onclick="limparFormCliente()">üîÑ Limpar</button>
     </form>
    </div>
    <div id="pesquisaCliente" class="tab-content">
     <h2>Pesquisar Clientes</h2>
     <div class="search-box">
      <div class="form-row">
       <div class="form-group"><label for="tipoBuscaCliente">Buscar por</label> <select id="tipoBuscaCliente" onchange="limparCampoBuscaCliente()"> <option value="nome">Nome</option> <option value="cpf">CPF</option> <option value="cnpj">CNPJ</option> </select>
       </div>
       <div class="form-group"><label for="searchCliente">Digite para buscar</label> <input type="text" id="searchCliente" placeholder="Digite para buscar..." oninput="aplicarMascaraBusca()">
       </div>
       <div class="form-group"><label for="filterTipo">Filtrar por Tipo</label> <select id="filterTipo"> <option value="">Todos</option> <option value="fisica">Pessoa F√≠sica</option> <option value="juridica">Pessoa Jur√≠dica</option> </select>
       </div>
      </div><button class="btn" onclick="filtrarClientes()">üîç Pesquisar</button>
     </div>
     <div id="listaClientes"></div>
    </div>
   </section><!-- Se√ß√£o Servi√ßos -->
   <section id="servicos" class="content-section">
    <div class="tabs"><button class="tab active" onclick="showTab('cadastroServico')">Cadastrar</button> <button class="tab" onclick="showTab('pesquisaServico')">Pesquisar</button>
    </div>
    <div id="cadastroServico" class="tab-content active">
     <h2>Cadastro de Servi√ßos</h2>
     <form id="formServico" onsubmit="salvarServico(event)">
      <div class="form-row">
       <div class="form-group"><label for="descricaoServico">Descri√ß√£o *</label> <input type="text" id="descricaoServico" required>
       </div>
       <div class="form-group"><label for="valorServico">Valor (R$) *</label> <input type="number" id="valorServico" step="0.01" min="0" required>
       </div>
      </div><button type="submit" class="btn" id="btnSalvarServico">üíæ Cadastrar Servi√ßo</button> <button type="button" class="btn btn-secondary" onclick="limparFormServico()">üîÑ Limpar</button>
     </form>
    </div>
    <div id="pesquisaServico" class="tab-content">
     <h2>Pesquisar Servi√ßos</h2>
     <div class="search-box"><input type="text" id="searchServico" placeholder="Digite para buscar..."> <button class="btn" onclick="filtrarServicos()" style="margin-top: 15px;">üîç Pesquisar</button>
     </div>
     <div id="listaServicos"></div>
    </div>
   </section><!-- Se√ß√£o Ordens de Servi√ßo -->
   <section id="ordens" class="content-section">
    <div class="tabs"><button class="tab active" onclick="showTab('cadastroOS')">Cadastrar</button> <button class="tab" onclick="showTab('pesquisaOS')">Pesquisar</button>
    </div>
    <div id="cadastroOS" class="tab-content active">
     <h2>Nova Ordem de Servi√ßo</h2>
     <form id="formOS" onsubmit="salvarOS(event)">
      <div class="card">
       <h3>üîç Buscar Cliente</h3>
       <div class="form-group"><label for="searchClienteOS">Pesquisar por Nome, CPF, CNPJ ou Raz√£o Social</label> <input type="text" id="searchClienteOS" placeholder="Digite para buscar cliente..." oninput="buscarClienteOS()">
        <div id="resultadosClienteOS" class="search-results" style="display: none;"></div>
       </div>
       <div id="clienteSelecionadoOS"></div>
      </div>
      <div class="card">
       <h3>üöó Dados do Ve√≠culo (Opcional)</h3>
       <div class="form-row">
        <div class="form-group"><label for="placaOS">Placa</label> <input type="text" id="placaOS" maxlength="8" placeholder="ABC-1234">
        </div>
        <div class="form-group"><label for="marcaOS">Marca</label> <input type="text" id="marcaOS">
        </div>
        <div class="form-group"><label for="modeloOS">Modelo</label> <input type="text" id="modeloOS">
        </div>
       </div>
       <div class="form-row">
        <div class="form-group"><label for="corOS">Cor</label> <input type="text" id="corOS">
        </div>
        <div class="form-group"><label for="kmOS">Quilometragem</label> <input type="text" id="kmOS" placeholder="Ex: 50000" oninput="formatarQuilometragem(this)">
        </div>
       </div>
      </div>
      <div class="card">
       <h3>üë§ Respons√°veis (Opcional)</h3>
       <div class="form-row">
        <div class="form-group"><label for="recebidoPorOS">Recebido Por</label> <input type="text" id="recebidoPorOS">
        </div>
        <div class="form-group"><label for="autorizadoPorOS">Autorizado Por</label> <input type="text" id="autorizadoPorOS">
        </div>
       </div>
      </div>
      <div class="card">
       <h3>üîß Servi√ßos</h3>
       <div class="form-row">
        <div class="form-group"><label for="searchServicoOS">Pesquisar Servi√ßo</label> <input type="text" id="searchServicoOS" placeholder="Digite para buscar..." oninput="buscarServicoOS()">
         <div id="resultadosServicoOS" class="search-results" style="display: none;"></div>
        </div>
       </div>
      </div>
      <div id="itensOSContainer" style="display: none;">
       <div class="os-items" id="itensOS"></div>
       <div class="total-section" id="totalOS">
        Total: R$ 0,00
       </div>
      </div>
      <div class="card">
       <h3>üìù Observa√ß√µes</h3>
       <div class="form-group"><label for="observacoesOS">Observa√ß√µes</label> <textarea id="observacoesOS" rows="4"></textarea>
       </div>
      </div><button type="submit" class="btn" id="btnSalvarOS">üíæ Criar Ordem de Servi√ßo</button> <button type="button" class="btn btn-secondary" onclick="limparFormOS()">üîÑ Limpar</button>
     </form>
    </div>
    <div id="pesquisaOS" class="tab-content">
     <h2>Pesquisar Ordens de Servi√ßo</h2>
     <div class="search-box">
      <div class="form-row">
       <div class="form-group"><label for="searchOS">N√∫mero da OS</label> <input type="text" id="searchOS" placeholder="Digite o n√∫mero...">
       </div>
       <div class="form-group"><label for="searchPlacaOS">Placa</label> <input type="text" id="searchPlacaOS" placeholder="Digite a placa...">
       </div>
       <div class="form-group"><label for="searchCpfCnpjOS">CPF/CNPJ</label> <input type="text" id="searchCpfCnpjOS" placeholder="Digite CPF/CNPJ...">
       </div>
      </div>
      <div class="form-row">
       <div class="form-group"><label for="dataEntradaOS">Data de Entrada</label> <input type="date" id="dataEntradaOS">
       </div>
       <div class="form-group"><label for="dataSaidaOS">Data de Sa√≠da</label> <input type="date" id="dataSaidaOS">
       </div>
       <div class="form-group"><label for="filterStatusOS">Status</label> <select id="filterStatusOS"> <option value="">Todos</option> <option value="aberta">Aberta</option> <option value="fechada">Fechada</option> </select>
       </div>
      </div><button class="btn" onclick="filtrarOS()">üîç Pesquisar</button>
     </div>
     <div id="listaOS"></div>
    </div>
   </section><!-- Se√ß√£o Contas a Pagar -->
   <section id="contasPagar" class="content-section">
    <div class="tabs"><button class="tab active" onclick="showTab('cadastroContaPagar')">Cadastrar</button> <button class="tab" onclick="showTab('pesquisaContaPagar')">Pesquisar</button>
    </div>
    <div id="cadastroContaPagar" class="tab-content active">
     <h2>Cadastro de Contas a Pagar</h2>
     <form id="formContaPagar" onsubmit="salvarContaPagar(event)">
      <div class="card">
       <h3>üîç Buscar Empresa</h3>
       <div class="form-group"><label for="searchEmpresaPagar">Pesquisar por Nome, CNPJ ou C√≥digo</label> <input type="text" id="searchEmpresaPagar" placeholder="Digite para buscar empresa..." oninput="buscarEmpresaPagar()">
        <div id="resultadosEmpresaPagar" class="search-results" style="display: none;"></div>
       </div>
       <div id="empresaSelecionadaPagar"></div>
      </div>
      <div class="form-row">
       <div class="form-group"><label for="numeroDocPagar">N√∫mero do Documento/NF *</label> <input type="text" id="numeroDocPagar" required>
       </div>
       <div class="form-group"><label for="empresaNomePagar">Nome da Empresa *</label> <input type="text" id="empresaNomePagar" required>
       </div>
      </div>
      <div class="form-row">
       <div class="form-group"><label for="empresaPagar">CNPJ da Empresa *</label> <input type="text" id="empresaPagar" required maxlength="18" placeholder="00.000.000/0000-00" oninput="maskCNPJ(this)">
       </div>
       <div class="form-group"><label for="dataLancamentoPagar">Data de Lan√ßamento *</label> <input type="date" id="dataLancamentoPagar" required>
       </div>
      </div>
      <div class="form-row">
       <div class="form-group"><label for="dataVencimentoPagar">Data de Vencimento *</label> <input type="date" id="dataVencimentoPagar" required>
       </div>
       <div class="form-group"><label for="valorPagar">Valor (R$) *</label> <input type="number" id="valorPagar" step="0.01" min="0" required>
       </div>
      </div>
      <div class="form-group"><label for="statusPagar">Status *</label> <select id="statusPagar" required> <option value="aberto">Em Aberto</option> <option value="pago">Pago</option> </select>
      </div><button type="submit" class="btn" id="btnSalvarContaPagar">üíæ Cadastrar Conta</button> <button type="button" class="btn btn-secondary" onclick="limparFormContaPagar()">üîÑ Limpar</button>
     </form>
    </div>
    <div id="pesquisaContaPagar" class="tab-content">
     <h2>Pesquisar Contas a Pagar</h2>
     <div class="search-box">
      <div class="form-row">
       <div class="form-group"><label for="searchContaPagar">N√∫mero do Documento ou Nome da Empresa</label> <input type="text" id="searchContaPagar" placeholder="Digite para buscar...">
       </div>
       <div class="form-group"><label for="dataVencimentoBuscaPagar">Data de Vencimento</label> <input type="date" id="dataVencimentoBuscaPagar">
       </div>
       <div class="form-group"><label for="filterStatusPagar">Status</label> <select id="filterStatusPagar"> <option value="">Todos</option> <option value="aberto">Em Aberto</option> <option value="pago">Pago</option> </select>
       </div>
      </div><button class="btn" onclick="filtrarContasPagar()">üîç Pesquisar</button>
     </div>
     <div id="listaContasPagar"></div>
    </div>
   </section><!-- Se√ß√£o Contas a Receber -->
   <section id="contasReceber" class="content-section">
    <div class="tabs"><button class="tab active" onclick="showTab('cadastroContaReceber')">Cadastrar</button> <button class="tab" onclick="showTab('pesquisaContaReceber')">Pesquisar</button>
    </div>
    <div id="cadastroContaReceber" class="tab-content active">
     <h2>Cadastro de Contas a Receber</h2>
     <form id="formContaReceber" onsubmit="salvarContaReceber(event)">
      <div class="form-row">
       <div class="form-group"><label for="numeroDocReceber">N√∫mero do Documento/NF *</label> <input type="text" id="numeroDocReceber" required>
       </div>
       <div class="form-group"><label for="dataEmissaoReceber">Data de Emiss√£o/Lan√ßamento *</label> <input type="date" id="dataEmissaoReceber" required>
       </div>
      </div>
      <div class="form-row">
       <div class="form-group"><label for="dataVencimentoReceber">Data de Vencimento *</label> <input type="date" id="dataVencimentoReceber" required>
       </div>
       <div class="form-group"><label for="valorReceber">Valor (R$) *</label> <input type="number" id="valorReceber" step="0.01" min="0" required>
       </div>
      </div>
      <div class="form-group"><label for="statusReceber">Status *</label> <select id="statusReceber" required> <option value="aberto">Em Aberto</option> <option value="pago">Pago</option> </select>
      </div><button type="submit" class="btn" id="btnSalvarContaReceber">üíæ Cadastrar Conta</button> <button type="button" class="btn btn-secondary" onclick="limparFormContaReceber()">üîÑ Limpar</button>
     </form>
    </div>
    <div id="pesquisaContaReceber" class="tab-content">
     <h2>Pesquisar Contas a Receber</h2>
     <div class="search-box">
      <div class="form-row">
       <div class="form-group"><label for="searchContaReceber">N√∫mero do Documento</label> <input type="text" id="searchContaReceber" placeholder="Digite para buscar...">
       </div>
       <div class="form-group"><label for="filterStatusReceber">Status</label> <select id="filterStatusReceber"> <option value="">Todos</option> <option value="aberto">Em Aberto</option> <option value="pago">Pago</option> </select>
       </div>
      </div><button class="btn" onclick="filtrarContasReceber()">üîç Pesquisar</button>
     </div>
     <div id="listaContasReceber"></div>
    </div>
   </section><!-- Se√ß√£o Relat√≥rios -->
   <section id="relatorios" class="content-section">
    <h2>üìä Relat√≥rios e Estat√≠sticas</h2>
    <div class="stats-grid" id="statsGrid"></div>
    <div class="card">
     <h3>Relat√≥rios Detalhados</h3>
     <div class="form-row"><button class="btn" onclick="gerarRelatorio('clientes')">üìã Clientes Cadastrados</button> <button class="btn" onclick="gerarRelatorio('osAbertas')">üìÇ OS em Aberto</button> <button class="btn" onclick="gerarRelatorio('osFechadas')">‚úÖ OS Finalizadas</button> <button class="btn" onclick="gerarRelatorio('servicosExecutados')">üîß Servi√ßos Executados</button>
     </div>
     <div class="form-row"><button class="btn" onclick="gerarRelatorio('contasPagar')">üí∞ Contas a Pagar</button> <button class="btn" onclick="gerarRelatorio('contasReceber')">üíµ Contas a Receber</button>
     </div>
    </div>
    <div class="card">
     <h3>Faturamento por Per√≠odo</h3>
     <div class="form-row">
      <div class="form-group"><label for="dataInicialRelatorio">Data Inicial</label> <input type="date" id="dataInicialRelatorio">
      </div>
      <div class="form-group"><label for="dataFinalRelatorio">Data Final</label> <input type="date" id="dataFinalRelatorio">
      </div>
     </div><button class="btn" onclick="gerarRelatorio('faturamentoPeriodo')">üìä Gerar Relat√≥rio</button>
    </div>
    <div id="relatorioDetalhado"></div>
   </section>
  </div><!-- Painel de Edi√ß√£o -->
  <div class="edit-panel" id="editPanel"><button class="close-panel" onclick="closeEditPanel()">√ó</button>
   <div id="editPanelContent"></div>
  </div>
  <script>
        // Sistema de armazenamento usando localStorage
        let allData = [];
        let editingId = null;
        let currentOSItems = [];
        let osCounter = 1;
        let selectedClienteOS = null;

        // Fun√ß√µes de armazenamento local
        function saveToLocalStorage() {
            localStorage.setItem('oficinaData', JSON.stringify(allData));
        }

        function loadFromLocalStorage() {
            const data = localStorage.getItem('oficinaData');
            if (data) {
                allData = JSON.parse(data);
                const maxOS = Math.max(0, ...allData
                    .filter(item => item.type === 'os' && item.numeroOS)
                    .map(os => parseInt(os.numeroOS.replace('OS-', '')) || 0)
                );
                osCounter = maxOS + 1;
                atualizarTodasListas();
                atualizarEstatisticas();
            }
            console.log('Sistema inicializado com sucesso!');
        }

        function generateId() {
            return 'id_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }

        // M√°scaras de entrada
        function maskCPF(input) {
            let value = input.value.replace(/\D/g, '');
            if (value.length <= 11) {
                value = value.replace(/(\d{3})(\d)/, '$1.$2');
                value = value.replace(/(\d{3})(\d)/, '$1.$2');
                value = value.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
                input.value = value;
            }
        }

        function maskCNPJ(input) {
            let value = input.value.replace(/\D/g, '');
            if (value.length <= 14) {
                value = value.replace(/^(\d{2})(\d)/, '$1.$2');
                value = value.replace(/^(\d{2})\.(\d{3})(\d)/, '$1.$2.$3');
                value = value.replace(/\.(\d{3})(\d)/, '.$1/$2');
                value = value.replace(/(\d{4})(\d)/, '$1-$2');
                input.value = value;
            }
        }

        function maskPhone(input) {
            let value = input.value.replace(/\D/g, '');
            if (value.length <= 11) {
                if (value.length <= 10) {
                    value = value.replace(/^(\d{2})(\d)/, '($1) $2');
                    value = value.replace(/(\d{4})(\d)/, '$1-$2');
                } else {
                    value = value.replace(/^(\d{2})(\d)/, '($1) $2');
                    value = value.replace(/(\d{5})(\d)/, '$1-$2');
                }
                input.value = value;
            }
        }

        function maskCEP(input) {
            let value = input.value.replace(/\D/g, '');
            if (value.length <= 8) {
                value = value.replace(/^(\d{5})(\d)/, '$1-$2');
                input.value = value;
            }
        }

        function aplicarMascaraBusca() {
            const tipoBusca = document.getElementById('tipoBuscaCliente').value;
            const input = document.getElementById('searchCliente');
            
            if (tipoBusca === 'cpf') {
                maskCPF(input);
            } else if (tipoBusca === 'cnpj') {
                maskCNPJ(input);
            }
        }

        function limparCampoBuscaCliente() {
            document.getElementById('searchCliente').value = '';
        }

        function formatarQuilometragem(input) {
            let value = input.value.replace(/\D/g, '');
            if (value) {
                input.value = value + ' km';
                input.setSelectionRange(value.length, value.length);
            }
        }

        function showSection(sectionId) {
            const sections = document.querySelectorAll('.content-section');
            sections.forEach(section => section.classList.remove('active'));
            
            const buttons = document.querySelectorAll('.nav-btn');
            buttons.forEach(btn => btn.classList.remove('active'));
            
            document.getElementById(sectionId).classList.add('active');
            event.target.classList.add('active');

            if (sectionId === 'relatorios') {
                atualizarEstatisticas();
            }
        }

        function showTab(tabId) {
            const section = event.target.closest('.content-section');
            const tabs = section.querySelectorAll('.tab');
            const contents = section.querySelectorAll('.tab-content');
            
            tabs.forEach(tab => tab.classList.remove('active'));
            contents.forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabId).classList.add('active');
        }

        function showMessage(message, type = 'success') {
            const container = document.getElementById('messageContainer');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            messageDiv.textContent = message;
            
            container.innerHTML = '';
            container.appendChild(messageDiv);
            
            setTimeout(() => {
                messageDiv.style.opacity = '0';
                setTimeout(() => messageDiv.remove(), 500);
            }, 4000);
        }

        function toggleClienteForm() {
            const tipo = document.querySelector('input[name="tipoCliente"]:checked').value;
            const camposFisica = document.getElementById('camposFisica');
            const camposJuridica = document.getElementById('camposJuridica');
            
            if (tipo === 'fisica') {
                camposFisica.style.display = 'block';
                camposJuridica.style.display = 'none';
                document.getElementById('nomeCliente').required = true;
                document.getElementById('telefoneCliente').required = true;
                document.getElementById('nomeEmpresa').required = false;
                document.getElementById('cnpjEmpresa').required = false;
                document.getElementById('razaoSocial').required = false;
                document.getElementById('inscricaoEstadual').required = false;
            } else {
                camposFisica.style.display = 'none';
                camposJuridica.style.display = 'block';
                document.getElementById('nomeCliente').required = false;
                document.getElementById('telefoneCliente').required = false;
                document.getElementById('nomeEmpresa').required = true;
                document.getElementById('cnpjEmpresa').required = true;
                document.getElementById('razaoSocial').required = true;
                document.getElementById('inscricaoEstadual').required = true;
            }
        }

        function salvarCliente(event) {
            event.preventDefault();
            
            const tipo = document.querySelector('input[name="tipoCliente"]:checked').value;
            
            const cliente = {
                id: editingId || generateId(),
                type: 'cliente',
                tipoCliente: tipo,
                createdAt: new Date().toISOString()
            };

            if (tipo === 'fisica') {
                cliente.nome = document.getElementById('nomeCliente').value.toUpperCase();
                cliente.cpf = document.getElementById('cpfCliente').value;
                cliente.telefone = document.getElementById('telefoneCliente').value;
                cliente.endereco = document.getElementById('enderecoCliente').value.toUpperCase();
                cliente.cep = document.getElementById('cepCliente').value;
            } else {
                cliente.nome = document.getElementById('nomeEmpresa').value.toUpperCase();
                cliente.cnpj = document.getElementById('cnpjEmpresa').value;
                cliente.razaoSocial = document.getElementById('razaoSocial').value.toUpperCase();
                cliente.nomeFantasia = document.getElementById('nomeFantasia').value.toUpperCase();
                cliente.inscricaoEstadual = document.getElementById('inscricaoEstadual').value.toUpperCase();
                cliente.inscricaoMunicipal = document.getElementById('inscricaoMunicipal').value.toUpperCase();
                cliente.email = document.getElementById('emailEmpresa').value.toUpperCase();
                cliente.telefone = document.getElementById('telefoneEmpresa').value;
                cliente.endereco = document.getElementById('enderecoEmpresa').value.toUpperCase();
                cliente.cep = document.getElementById('cepEmpresa').value;
            }

            if (editingId) {
                const index = allData.findIndex(r => r.id === editingId);
                if (index !== -1) {
                    allData[index] = cliente;
                    showMessage('‚úÖ Cliente atualizado com sucesso!', 'success');
                }
            } else {
                allData.push(cliente);
                showMessage('‚úÖ Cliente cadastrado com sucesso!', 'success');
            }

            saveToLocalStorage();
            limparFormCliente();
            atualizarTodasListas();
            closeEditPanel();
        }

        function limparFormCliente() {
            document.getElementById('formCliente').reset();
            document.querySelector('input[name="tipoCliente"][value="fisica"]').checked = true;
            toggleClienteForm();
            editingId = null;
            document.getElementById('btnSalvarCliente').textContent = 'üíæ Cadastrar Cliente';
        }

        function editarCliente(id) {
            const cliente = allData.find(c => c.id === id);
            if (!cliente) {
                showMessage('‚ùå Cliente n√£o encontrado', 'error');
                return;
            }

            openEditPanel();
            
            const content = document.getElementById('editPanelContent');
            content.innerHTML = `
                <h2>Editar Cliente</h2>
                <form id="formEditCliente" onsubmit="salvarClienteEdit(event, '${id}')">
                    ${cliente.tipoCliente === 'fisica' ? `
                        <div class="form-group">
                            <label>Nome *</label>
                            <input type="text" id="editNome" value="${cliente.nome || ''}" required>
                        </div>
                        <div class="form-group">
                            <label>CPF</label>
                            <input type="text" id="editCpf" value="${cliente.cpf || ''}" maxlength="14" oninput="maskCPF(this)">
                        </div>
                        <div class="form-group">
                            <label>Telefone *</label>
                            <input type="text" id="editTelefone" value="${cliente.telefone || ''}" required maxlength="15" oninput="maskPhone(this)">
                        </div>
                        <div class="form-group">
                            <label>CEP</label>
                            <input type="text" id="editCep" value="${cliente.cep || ''}" maxlength="9" oninput="maskCEP(this)">
                        </div>
                        <div class="form-group">
                            <label>Endere√ßo</label>
                            <input type="text" id="editEndereco" value="${cliente.endereco || ''}">
                        </div>
                    ` : `
                        <div class="form-group">
                            <label>Nome *</label>
                            <input type="text" id="editNome" value="${cliente.nome || ''}" required>
                        </div>
                        <div class="form-group">
                            <label>CNPJ *</label>
                            <input type="text" id="editCnpj" value="${cliente.cnpj || ''}" required maxlength="18" oninput="maskCNPJ(this)">
                        </div>
                        <div class="form-group">
                            <label>Raz√£o Social *</label>
                            <input type="text" id="editRazaoSocial" value="${cliente.razaoSocial || ''}" required>
                        </div>
                        <div class="form-group">
                            <label>Nome Fantasia</label>
                            <input type="text" id="editNomeFantasia" value="${cliente.nomeFantasia || ''}">
                        </div>
                        <div class="form-group">
                            <label>Inscri√ß√£o Estadual *</label>
                            <input type="text" id="editInscricaoEstadual" value="${cliente.inscricaoEstadual || ''}" required>
                        </div>
                        <div class="form-group">
                            <label>Inscri√ß√£o Municipal</label>
                            <input type="text" id="editInscricaoMunicipal" value="${cliente.inscricaoMunicipal || ''}">
                        </div>
                        <div class="form-group">
                            <label>E-mail</label>
                            <input type="email" id="editEmail" value="${cliente.email || ''}">
                        </div>
                        <div class="form-group">
                            <label>Telefone</label>
                            <input type="text" id="editTelefone" value="${cliente.telefone || ''}" maxlength="15" oninput="maskPhone(this)">
                        </div>
                        <div class="form-group">
                            <label>CEP</label>
                            <input type="text" id="editCep" value="${cliente.cep || ''}" maxlength="9" oninput="maskCEP(this)">
                        </div>
                        <div class="form-group">
                            <label>Endere√ßo</label>
                            <input type="text" id="editEndereco" value="${cliente.endereco || ''}">
                        </div>
                    `}
                    <button type="submit" class="btn">üíæ Salvar Altera√ß√µes</button>
                    <button type="button" class="btn btn-secondary" onclick="closeEditPanel()">‚ùå Cancelar</button>
                </form>
            `;
        }

        function salvarClienteEdit(event, id) {
            event.preventDefault();
            const cliente = allData.find(c => c.id === id);
            if (!cliente) return;

            cliente.nome = document.getElementById('editNome').value.toUpperCase();
            cliente.telefone = document.getElementById('editTelefone').value;
            cliente.cep = document.getElementById('editCep').value;
            cliente.endereco = document.getElementById('editEndereco').value.toUpperCase();

            if (cliente.tipoCliente === 'fisica') {
                cliente.cpf = document.getElementById('editCpf').value;
            } else {
                cliente.cnpj = document.getElementById('editCnpj').value;
                cliente.razaoSocial = document.getElementById('editRazaoSocial').value.toUpperCase();
                cliente.nomeFantasia = document.getElementById('editNomeFantasia').value.toUpperCase();
                cliente.inscricaoEstadual = document.getElementById('editInscricaoEstadual').value.toUpperCase();
                cliente.inscricaoMunicipal = document.getElementById('editInscricaoMunicipal').value.toUpperCase();
                cliente.email = document.getElementById('editEmail').value.toUpperCase();
            }

            saveToLocalStorage();
            showMessage('‚úÖ Cliente atualizado com sucesso!', 'success');
            atualizarTodasListas();
            closeEditPanel();
        }

        function excluirCliente(id) {
            const cliente = allData.find(c => c.id === id);
            if (!cliente) return;

            const confirmDiv = document.createElement('div');
            confirmDiv.className = 'message info';
            confirmDiv.innerHTML = `
                ‚ö†Ô∏è Tem certeza que deseja excluir este cliente?
                <div style="margin-top: 10px;">
                    <button class="btn btn-danger btn-small" onclick="confirmarExclusaoCliente('${id}')">‚úì Confirmar</button>
                    <button class="btn btn-secondary btn-small" onclick="this.parentElement.parentElement.remove()">‚úó Cancelar</button>
                </div>
            `;
            document.getElementById('messageContainer').appendChild(confirmDiv);
        }

        function confirmarExclusaoCliente(id) {
            allData = allData.filter(c => c.id !== id);
            saveToLocalStorage();
            showMessage('‚úÖ Cliente exclu√≠do com sucesso!', 'success');
            atualizarTodasListas();
        }

        function filtrarClientes() {
            renderizarClientes();
        }

        function renderizarClientes() {
            const searchTerm = document.getElementById('searchCliente').value.toLowerCase();
            const filterTipo = document.getElementById('filterTipo').value;
            const tipoBusca = document.getElementById('tipoBuscaCliente').value;
            
            const clientes = allData.filter(item => {
                if (item.type !== 'cliente') return false;
                
                let matchSearch = !searchTerm;
                
                if (searchTerm) {
                    if (tipoBusca === 'nome') {
                        matchSearch = item.nome && item.nome.toLowerCase().includes(searchTerm);
                    } else if (tipoBusca === 'cpf') {
                        matchSearch = item.cpf && item.cpf.includes(searchTerm);
                    } else if (tipoBusca === 'cnpj') {
                        matchSearch = item.cnpj && item.cnpj.includes(searchTerm);
                    }
                }
                
                const matchTipo = !filterTipo || item.tipoCliente === filterTipo;
                
                return matchSearch && matchTipo;
            });

            const container = document.getElementById('listaClientes');
            
            if (clientes.length === 0 && (searchTerm || filterTipo)) {
                container.innerHTML = '<div class="message info">‚ùå Nenhum cliente encontrado</div>';
                return;
            }
            
            if (clientes.length === 0) {
                container.innerHTML = '';
                return;
            }

            let html = '<table><thead><tr><th>Nome</th><th>CPF/CNPJ</th><th>Telefone</th><th>Tipo</th><th>A√ß√µes</th></tr></thead><tbody>';
            
            clientes.forEach(cliente => {
                html += `
                    <tr>
                        <td>${cliente.nome || '-'}</td>
                        <td>${cliente.cpf || cliente.cnpj || '-'}</td>
                        <td>${cliente.telefone || '-'}</td>
                        <td>${cliente.tipoCliente === 'fisica' ? 'Pessoa F√≠sica' : 'Pessoa Jur√≠dica'}</td>
                        <td class="action-buttons">
                            <button class="btn btn-secondary btn-small" onclick="editarCliente('${cliente.id}')">‚úèÔ∏è Editar</button>
                            <button class="btn btn-danger btn-small" onclick="excluirCliente('${cliente.id}')">üóëÔ∏è Excluir</button>
                        </td>
                    </tr>
                `;
            });
            
            html += '</tbody></table>';
            container.innerHTML = html;
        }

        function salvarServico(event) {
            event.preventDefault();
            
            const servico = {
                id: editingId || generateId(),
                type: 'servico',
                descricao: document.getElementById('descricaoServico').value.toUpperCase(),
                valor: parseFloat(document.getElementById('valorServico').value),
                createdAt: new Date().toISOString()
            };

            if (editingId) {
                const index = allData.findIndex(r => r.id === editingId);
                if (index !== -1) {
                    allData[index] = servico;
                    showMessage('‚úÖ Servi√ßo atualizado com sucesso!', 'success');
                }
            } else {
                allData.push(servico);
                showMessage('‚úÖ Servi√ßo cadastrado com sucesso!', 'success');
            }

            saveToLocalStorage();
            limparFormServico();
            atualizarTodasListas();
            closeEditPanel();
        }

        function limparFormServico() {
            document.getElementById('formServico').reset();
            editingId = null;
            document.getElementById('btnSalvarServico').textContent = 'üíæ Cadastrar Servi√ßo';
        }

        function editarServico(id) {
            const servico = allData.find(s => s.id === id);
            if (!servico) {
                showMessage('‚ùå Servi√ßo n√£o encontrado', 'error');
                return;
            }

            openEditPanel();
            
            const content = document.getElementById('editPanelContent');
            content.innerHTML = `
                <h2>Editar Servi√ßo</h2>
                <form id="formEditServico" onsubmit="salvarServicoEdit(event, '${id}')">
                    <div class="form-group">
                        <label>Descri√ß√£o *</label>
                        <input type="text" id="editDescricao" value="${servico.descricao || ''}" required>
                    </div>
                    <div class="form-group">
                        <label>Valor (R$) *</label>
                        <input type="number" id="editValor" value="${servico.valor || 0}" step="0.01" min="0" required>
                    </div>
                    <button type="submit" class="btn">üíæ Salvar Altera√ß√µes</button>
                    <button type="button" class="btn btn-secondary" onclick="closeEditPanel()">‚ùå Cancelar</button>
                </form>
            `;
        }

        function salvarServicoEdit(event, id) {
            event.preventDefault();
            const servico = allData.find(s => s.id === id);
            if (!servico) return;

            servico.descricao = document.getElementById('editDescricao').value.toUpperCase();
            servico.valor = parseFloat(document.getElementById('editValor').value);

            saveToLocalStorage();
            showMessage('‚úÖ Servi√ßo atualizado com sucesso!', 'success');
            atualizarTodasListas();
            closeEditPanel();
        }

        function excluirServico(id) {
            const servico = allData.find(s => s.id === id);
            if (!servico) return;

            const confirmDiv = document.createElement('div');
            confirmDiv.className = 'message info';
            confirmDiv.innerHTML = `
                ‚ö†Ô∏è Tem certeza que deseja excluir este servi√ßo?
                <div style="margin-top: 10px;">
                    <button class="btn btn-danger btn-small" onclick="confirmarExclusaoServico('${id}')">‚úì Confirmar</button>
                    <button class="btn btn-secondary btn-small" onclick="this.parentElement.parentElement.remove()">‚úó Cancelar</button>
                </div>
            `;
            document.getElementById('messageContainer').appendChild(confirmDiv);
        }

        function confirmarExclusaoServico(id) {
            allData = allData.filter(s => s.id !== id);
            saveToLocalStorage();
            showMessage('‚úÖ Servi√ßo exclu√≠do com sucesso!', 'success');
            atualizarTodasListas();
        }

        function filtrarServicos() {
            renderizarServicos();
        }

        function renderizarServicos() {
            const searchTerm = document.getElementById('searchServico').value.toLowerCase();
            
            const servicos = allData.filter(item => {
                if (item.type !== 'servico') return false;
                return !searchTerm || (item.descricao && item.descricao.toLowerCase().includes(searchTerm));
            });

            const container = document.getElementById('listaServicos');
            
            if (servicos.length === 0 && searchTerm) {
                container.innerHTML = '<div class="message info">‚ùå Nenhum servi√ßo encontrado</div>';
                return;
            }
            
            if (servicos.length === 0) {
                container.innerHTML = '';
                return;
            }

            let html = '<table><thead><tr><th>Descri√ß√£o</th><th>Valor</th><th>A√ß√µes</th></tr></thead><tbody>';
            
            servicos.forEach(servico => {
                html += `
                    <tr>
                        <td>${servico.descricao || '-'}</td>
                        <td>R$ ${(servico.valor || 0).toFixed(2)}</td>
                        <td class="action-buttons">
                            <button class="btn btn-secondary btn-small" onclick="editarServico('${servico.id}')">‚úèÔ∏è Editar</button>
                            <button class="btn btn-danger btn-small" onclick="excluirServico('${servico.id}')">üóëÔ∏è Excluir</button>
                        </td>
                    </tr>
                `;
            });
            
            html += '</tbody></table>';
            container.innerHTML = html;
        }

        function buscarClienteOS() {
            const searchTerm = document.getElementById('searchClienteOS').value.toLowerCase();
            const resultados = document.getElementById('resultadosClienteOS');
            
            if (searchTerm.length < 2) {
                resultados.style.display = 'none';
                return;
            }

            const clientes = allData.filter(item => {
                if (item.type !== 'cliente') return false;
                return (item.nome && item.nome.toLowerCase().includes(searchTerm)) ||
                       (item.cpf && item.cpf.includes(searchTerm)) ||
                       (item.cnpj && item.cnpj.includes(searchTerm)) ||
                       (item.razaoSocial && item.razaoSocial.toLowerCase().includes(searchTerm));
            });

            if (clientes.length === 0) {
                resultados.innerHTML = '<div class="search-result-item">‚ùå Nenhum cliente encontrado</div>';
                resultados.style.display = 'block';
                return;
            }

            let html = '';
            clientes.forEach(cliente => {
                html += `
                    <div class="search-result-item" onclick="selecionarClienteOS('${cliente.id}')">
                        <strong>${cliente.nome}</strong><br>
                        <small>${cliente.cpf || cliente.cnpj || 'Sem documento'}</small>
                        ${cliente.razaoSocial ? `<br><small>Raz√£o Social: ${cliente.razaoSocial}</small>` : ''}
                    </div>
                `;
            });

            resultados.innerHTML = html;
            resultados.style.display = 'block';
        }

        function selecionarClienteOS(id) {
            const cliente = allData.find(c => c.id === id);
            if (!cliente) return;

            selectedClienteOS = cliente;
            document.getElementById('resultadosClienteOS').style.display = 'none';
            document.getElementById('searchClienteOS').value = cliente.nome;

            const container = document.getElementById('clienteSelecionadoOS');
            container.innerHTML = `
                <div class="selected-client">
                    <h4>‚úì Cliente Selecionado</h4>
                    <p><strong>Nome:</strong> ${cliente.nome}</p>
                    <p><strong>${cliente.cpf ? 'CPF' : 'CNPJ'}:</strong> ${cliente.cpf || cliente.cnpj || '-'}</p>
                    ${cliente.telefone ? `<p><strong>Telefone:</strong> ${cliente.telefone}</p>` : ''}
                    ${cliente.razaoSocial ? `<p><strong>Raz√£o Social:</strong> ${cliente.razaoSocial}</p>` : ''}
                </div>
            `;
        }

        function buscarServicoOS() {
            const searchTerm = document.getElementById('searchServicoOS').value.toLowerCase();
            const resultados = document.getElementById('resultadosServicoOS');
            
            if (searchTerm.length < 2) {
                resultados.style.display = 'none';
                return;
            }

            const servicos = allData.filter(item => {
                if (item.type !== 'servico') return false;
                return item.descricao && item.descricao.toLowerCase().includes(searchTerm);
            });

            if (servicos.length === 0) {
                resultados.innerHTML = '<div class="search-result-item">‚ùå Nenhum servi√ßo encontrado</div>';
                resultados.style.display = 'block';
                return;
            }

            let html = '';
            servicos.forEach(servico => {
                html += `
                    <div class="search-result-item" onclick="adicionarServicoOS('${servico.id}')">
                        <strong>${servico.descricao}</strong><br>
                        <small>R$ ${(servico.valor || 0).toFixed(2)}</small>
                    </div>
                `;
            });

            resultados.innerHTML = html;
            resultados.style.display = 'block';
        }

        function adicionarServicoOS(id) {
            const servico = allData.find(s => s.id === id);
            if (!servico) return;

            const existente = currentOSItems.find(item => item.id === id);
            if (existente) {
                existente.quantidade++;
            } else {
                currentOSItems.push({
                    tipo: 'servico',
                    id: id,
                    descricao: servico.descricao,
                    valor: servico.valor,
                    quantidade: 1
                });
            }

            atualizarItensOS();
            document.getElementById('searchServicoOS').value = '';
            document.getElementById('resultadosServicoOS').style.display = 'none';
        }

        function atualizarItensOS() {
            const container = document.getElementById('itensOS');
            const totalContainer = document.getElementById('totalOS');
            const itensContainer = document.getElementById('itensOSContainer');
            
            if (currentOSItems.length === 0) {
                itensContainer.style.display = 'none';
                return;
            }

            itensContainer.style.display = 'block';

            let html = '<h4 style="color: #1e88e5; margin-bottom: 15px;">Itens Adicionados</h4>';
            let total = 0;

            currentOSItems.forEach((item, index) => {
                const subtotal = item.valor * item.quantidade;
                total += subtotal;
                
                html += `
                    <div class="os-item" style="flex-direction: column; align-items: flex-start; gap: 10px;">
                        <div style="width: 100%; display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <strong>üîß ${item.descricao}</strong><br>
                                <small>Subtotal: R$ ${subtotal.toFixed(2)}</small>
                            </div>
                            <button type="button" class="btn btn-danger btn-small" onclick="removerItemOS(${index})">üóëÔ∏è Remover</button>
                        </div>
                        <div style="width: 100%; display: flex; gap: 15px; align-items: center; flex-wrap: wrap;">
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <label style="margin: 0; font-size: 13px;">Valor Unit.:</label>
                                <input type="number" step="0.01" min="0" value="${item.valor.toFixed(2)}" 
                                    onchange="alterarValorItem(${index}, this.value)"
                                    style="width: 100px; padding: 6px; border-radius: 6px; border: 2px solid #3a3a5e; background: #2a2a3e; color: #e0e0e0;">
                            </div>
                            <div class="item-quantity">
                                <label style="margin: 0; font-size: 13px; margin-right: 8px;">Qtd:</label>
                                <button type="button" class="qty-btn" onclick="alterarQuantidadeItem(${index}, -1)">-</button>
                                <span class="qty-display">${item.quantidade}</span>
                                <button type="button" class="qty-btn" onclick="alterarQuantidadeItem(${index}, 1)">+</button>
                            </div>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
            totalContainer.textContent = `Total: R$ ${total.toFixed(2)}`;
        }

        function alterarValorItem(index, novoValor) {
            const valor = parseFloat(novoValor);
            if (isNaN(valor) || valor < 0) return;
            
            currentOSItems[index].valor = valor;
            atualizarItensOS();
        }

        function alterarQuantidadeItem(index, delta) {
            const item = currentOSItems[index];
            const novaQtd = item.quantidade + delta;

            if (novaQtd < 1) return;

            item.quantidade = novaQtd;
            atualizarItensOS();
        }

        function removerItemOS(index) {
            currentOSItems.splice(index, 1);
            atualizarItensOS();
        }

        function salvarOS(event) {
            event.preventDefault();

            if (!selectedClienteOS) {
                showMessage('‚ö†Ô∏è Selecione um cliente para a ordem de servi√ßo', 'error');
                return;
            }

            if (currentOSItems.length === 0) {
                showMessage('‚ö†Ô∏è Adicione pelo menos um servi√ßo', 'error');
                return;
            }

            const total = currentOSItems.reduce((sum, item) => sum + (item.valor * item.quantidade), 0);

            const os = {
                id: editingId || generateId(),
                type: 'os',
                numeroOS: `OS-${String(osCounter).padStart(6, '0')}`,
                dataEntrada: new Date().toISOString(),
                status: 'aberta',
                clienteId: selectedClienteOS.id,
                placa: document.getElementById('placaOS').value.toUpperCase(),
                marca: document.getElementById('marcaOS').value.toUpperCase(),
                modelo: document.getElementById('modeloOS').value.toUpperCase(),
                cor: document.getElementById('corOS').value.toUpperCase(),
                quilometragem: document.getElementById('kmOS').value,
                recebidoPor: document.getElementById('recebidoPorOS').value.toUpperCase(),
                autorizadoPor: document.getElementById('autorizadoPorOS').value.toUpperCase(),
                observacoes: document.getElementById('observacoesOS').value.toUpperCase(),
                servicos: JSON.stringify(currentOSItems),
                total: total,
                createdAt: new Date().toISOString()
            };

            if (!editingId) {
                osCounter++;
            }

            if (editingId) {
                const index = allData.findIndex(r => r.id === editingId);
                if (index !== -1) {
                    allData[index] = os;
                    showMessage('‚úÖ Ordem de servi√ßo atualizada com sucesso!', 'success');
                }
            } else {
                allData.push(os);
                showMessage(`‚úÖ Ordem de servi√ßo ${os.numeroOS} criada com sucesso!`, 'success');
            }

            saveToLocalStorage();
            limparFormOS();
            atualizarTodasListas();
            closeEditPanel();
        }

        function limparFormOS() {
            document.getElementById('formOS').reset();
            currentOSItems = [];
            selectedClienteOS = null;
            document.getElementById('clienteSelecionadoOS').innerHTML = '';
            atualizarItensOS();
            editingId = null;
            document.getElementById('btnSalvarOS').textContent = 'üíæ Criar Ordem de Servi√ßo';
        }

        function editarOS(id) {
            const os = allData.find(o => o.id === id);
            if (!os) {
                showMessage('‚ùå Ordem de servi√ßo n√£o encontrada', 'error');
                return;
            }

            openEditPanel();
            
            const cliente = allData.find(c => c.id === os.clienteId);
            const clienteNome = cliente ? cliente.nome : 'Cliente n√£o encontrado';
            const clienteCpfCnpj = cliente ? (cliente.cpf || cliente.cnpj || '-') : '-';

            let itensHTML = '';
            let total = 0;

            if (os.servicos) {
                try {
                    const servicos = JSON.parse(os.servicos);
                    servicos.forEach(s => {
                        const subtotal = s.valor * s.quantidade;
                        total += subtotal;
                        itensHTML += `<p>üîß ${s.descricao} - Qtd: ${s.quantidade} - R$ ${s.valor.toFixed(2)} cada - Subtotal: R$ ${subtotal.toFixed(2)}</p>`;
                    });
                } catch (e) {}
            }

            let editServicosArray = [];
            if (os.servicos) {
                try {
                    editServicosArray = JSON.parse(os.servicos);
                } catch (e) {}
            }

            const content = document.getElementById('editPanelContent');
            content.innerHTML = `
                <h2>Editar Ordem de Servi√ßo</h2>
                <form id="formEditOS" onsubmit="salvarEdicaoOS(event, '${id}')">
                    <div class="card">
                        <h3>Informa√ß√µes da OS</h3>
                        <p><strong>N√∫mero:</strong> ${os.numeroOS}</p>
                        <p><strong>Status:</strong> <span class="badge badge-${os.status === 'aberta' ? 'open' : 'closed'}">${os.status === 'aberta' ? 'Aberta' : 'Fechada'}</span></p>
                        <p><strong>Data de Entrada:</strong> ${new Date(os.dataEntrada).toLocaleDateString('pt-BR')}</p>
                        ${os.dataSaida ? `<p><strong>Data de Sa√≠da:</strong> ${new Date(os.dataSaida).toLocaleDateString('pt-BR')}</p>` : ''}
                    </div>
                    <div class="card">
                        <h3>Cliente</h3>
                        <div class="form-group">
                            <label>Nome do Cliente</label>
                            <input type="text" id="editClienteNome" value="${clienteNome}" required>
                        </div>
                        <div class="form-group">
                            <label>CPF/CNPJ</label>
                            <input type="text" id="editClienteCpfCnpj" value="${clienteCpfCnpj}">
                        </div>
                    </div>
                    <div class="card">
                        <h3>Ve√≠culo</h3>
                        <div class="form-group">
                            <label>Placa</label>
                            <input type="text" id="editPlaca" value="${os.placa || ''}" maxlength="8">
                        </div>
                        <div class="form-group">
                            <label>Modelo</label>
                            <input type="text" id="editModelo" value="${os.modelo || ''}">
                        </div>
                        <div class="form-group">
                            <label>Quilometragem</label>
                            <input type="text" id="editQuilometragem" value="${os.quilometragem || ''}" oninput="formatarQuilometragem(this)">
                        </div>
                        <p><strong>Marca:</strong> ${os.marca || '-'}</p>
                        <p><strong>Cor:</strong> ${os.cor || '-'}</p>
                    </div>
                    <div class="card">
                        <h3>Servi√ßos</h3>
                        <div id="editServicosOS"></div>
                        <p style="margin-top: 15px;"><strong>Total: <span id="editTotalOS">R$ ${total.toFixed(2)}</span></strong></p>
                    </div>
                    <div class="card">
                        <h3>Observa√ß√µes</h3>
                        <div class="form-group">
                            <textarea id="editObservacoes" rows="4">${os.observacoes || ''}</textarea>
                        </div>
                    </div>
                    <button type="submit" class="btn">üíæ Salvar Altera√ß√µes</button>
                    ${os.status === 'aberta' ? `
                        <button type="button" class="btn btn-secondary" onclick="fecharOS('${id}')">‚úì Fechar OS</button>
                    ` : ''}
                    <button type="button" class="btn btn-danger" onclick="closeEditPanel()">‚ùå Cancelar</button>
                </form>
            `;

            window.editServicosOSData = editServicosArray;
            renderizarServicosEditOS();
        }

        function renderizarServicosEditOS() {
            const container = document.getElementById('editServicosOS');
            if (!container) return;

            let html = '';
            let total = 0;

            window.editServicosOSData.forEach((servico, index) => {
                const subtotal = servico.valor * servico.quantidade;
                total += subtotal;

                html += `
                    <div class="os-item" style="flex-direction: column; align-items: flex-start; gap: 10px; margin-bottom: 10px;">
                        <div style="width: 100%; display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <strong>üîß ${servico.descricao}</strong><br>
                                <small>Subtotal: R$ ${subtotal.toFixed(2)}</small>
                            </div>
                            <button type="button" class="btn btn-danger btn-small" onclick="removerServicoEditOS(${index})">üóëÔ∏è Remover</button>
                        </div>
                        <div style="width: 100%; display: flex; gap: 15px; align-items: center; flex-wrap: wrap;">
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <label style="margin: 0; font-size: 13px;">Valor Unit.:</label>
                                <input type="number" step="0.01" min="0" value="${servico.valor.toFixed(2)}" 
                                    onchange="alterarValorServicoEditOS(${index}, this.value)"
                                    style="width: 100px; padding: 6px; border-radius: 6px; border: 2px solid #3a3a5e; background: #2a2a3e; color: #e0e0e0;">
                            </div>
                            <div class="item-quantity">
                                <label style="margin: 0; font-size: 13px; margin-right: 8px;">Qtd:</label>
                                <button type="button" class="qty-btn" onclick="alterarQtdServicoEditOS(${index}, -1)">-</button>
                                <span class="qty-display">${servico.quantidade}</span>
                                <button type="button" class="qty-btn" onclick="alterarQtdServicoEditOS(${index}, 1)">+</button>
                            </div>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
            document.getElementById('editTotalOS').textContent = `R$ ${total.toFixed(2)}`;
        }

        function alterarValorServicoEditOS(index, novoValor) {
            const valor = parseFloat(novoValor);
            if (isNaN(valor) || valor < 0) return;
            
            window.editServicosOSData[index].valor = valor;
            renderizarServicosEditOS();
        }

        function alterarQtdServicoEditOS(index, delta) {
            const servico = window.editServicosOSData[index];
            const novaQtd = servico.quantidade + delta;

            if (novaQtd < 1) return;

            servico.quantidade = novaQtd;
            renderizarServicosEditOS();
        }

        function removerServicoEditOS(index) {
            window.editServicosOSData.splice(index, 1);
            renderizarServicosEditOS();
        }

        function salvarEdicaoOS(event, id) {
            event.preventDefault();
            const os = allData.find(o => o.id === id);
            if (!os) return;

            const totalServicos = window.editServicosOSData.reduce((sum, item) => sum + (item.valor * item.quantidade), 0);

            os.placa = document.getElementById('editPlaca').value.toUpperCase();
            os.modelo = document.getElementById('editModelo').value.toUpperCase();
            os.quilometragem = document.getElementById('editQuilometragem').value;
            os.observacoes = document.getElementById('editObservacoes').value.toUpperCase();
            os.servicos = JSON.stringify(window.editServicosOSData);
            os.total = totalServicos;

            saveToLocalStorage();
            showMessage('‚úÖ Ordem de servi√ßo atualizada com sucesso!', 'success');
            atualizarTodasListas();
            closeEditPanel();
        }

        function excluirOS(id) {
            const os = allData.find(o => o.id === id);
            if (!os) return;

            const confirmDiv = document.createElement('div');
            confirmDiv.className = 'message info';
            confirmDiv.innerHTML = `
                ‚ö†Ô∏è Tem certeza que deseja excluir a OS ${os.numeroOS}?
                <div style="margin-top: 10px;">
                    <button class="btn btn-danger btn-small" onclick="confirmarExclusaoOS('${id}')">‚úì Confirmar</button>
                    <button class="btn btn-secondary btn-small" onclick="this.parentElement.parentElement.remove()">‚úó Cancelar</button>
                </div>
            `;
            document.getElementById('messageContainer').appendChild(confirmDiv);
        }

        function confirmarExclusaoOS(id) {
            allData = allData.filter(o => o.id !== id);
            saveToLocalStorage();
            showMessage('‚úÖ Ordem de servi√ßo exclu√≠da com sucesso!', 'success');
            atualizarTodasListas();
        }

        function fecharOS(id) {
            const os = allData.find(o => o.id === id);
            if (!os) return;

            os.status = 'fechada';
            os.dataSaida = new Date().toISOString();
            
            saveToLocalStorage();
            showMessage('‚úÖ Ordem de servi√ßo fechada com sucesso!', 'success');
            atualizarTodasListas();
            closeEditPanel();
        }

        function filtrarOS() {
            renderizarOS();
        }

        function renderizarOS() {
            const searchOS = document.getElementById('searchOS').value.toLowerCase();
            const searchPlaca = document.getElementById('searchPlacaOS').value.toLowerCase();
            const searchCpfCnpj = document.getElementById('searchCpfCnpjOS').value.toLowerCase();
            const dataEntrada = document.getElementById('dataEntradaOS').value;
            const dataSaida = document.getElementById('dataSaidaOS').value;
            const filterStatus = document.getElementById('filterStatusOS').value;
            
            const ordens = allData.filter(item => {
                if (item.type !== 'os') return false;
                
                const matchOS = !searchOS || (item.numeroOS && item.numeroOS.toLowerCase().includes(searchOS));
                
                const matchPlaca = !searchPlaca || (item.placa && item.placa.toLowerCase().includes(searchPlaca));
                
                const matchCpfCnpj = !searchCpfCnpj || (item.clienteId && (() => {
                    const cliente = allData.find(c => c.id === item.clienteId);
                    return cliente && (
                        (cliente.cpf && cliente.cpf.includes(searchCpfCnpj)) ||
                        (cliente.cnpj && cliente.cnpj.includes(searchCpfCnpj))
                    );
                })());
                
                const matchStatus = !filterStatus || item.status === filterStatus;
                
                let matchDataEntrada = true;
                if (dataEntrada) {
                    const osDate = new Date(item.dataEntrada).toISOString().split('T')[0];
                    matchDataEntrada = osDate === dataEntrada;
                }
                
                let matchDataSaida = true;
                if (dataSaida && item.dataSaida) {
                    const osDateSaida = new Date(item.dataSaida).toISOString().split('T')[0];
                    matchDataSaida = osDateSaida === dataSaida;
                }
                
                return matchOS && matchPlaca && matchCpfCnpj && matchStatus && matchDataEntrada && matchDataSaida;
            });

            const container = document.getElementById('listaOS');
            
            const hasSearchCriteria = searchOS || searchPlaca || searchCpfCnpj || dataEntrada || dataSaida || filterStatus;
            
            if (ordens.length === 0 && hasSearchCriteria) {
                container.innerHTML = '<div class="message info">‚ùå Nenhuma ordem de servi√ßo encontrada</div>';
                return;
            }
            
            if (ordens.length === 0) {
                container.innerHTML = '';
                return;
            }

            let html = '<table><thead><tr><th>N√∫mero</th><th>Cliente</th><th>Ve√≠culo</th><th>Data Entrada</th><th>Total</th><th>Status</th><th>A√ß√µes</th></tr></thead><tbody>';
            
            ordens.forEach(os => {
                const cliente = allData.find(c => c.id === os.clienteId);
                const clienteNome = cliente ? cliente.nome : 'Cliente n√£o encontrado';
                const dataFormatada = new Date(os.dataEntrada).toLocaleDateString('pt-BR');
                
                html += `
                    <tr>
                        <td><strong>${os.numeroOS || '-'}</strong></td>
                        <td>${clienteNome}</td>
                        <td>${os.marca || '-'} ${os.modelo || '-'}<br><small>${os.placa || '-'}</small></td>
                        <td>${dataFormatada}</td>
                        <td><strong>R$ ${(os.total || 0).toFixed(2)}</strong></td>
                        <td><span class="badge badge-${os.status === 'aberta' ? 'open' : 'closed'}">${os.status === 'aberta' ? 'Aberta' : 'Fechada'}</span></td>
                        <td class="action-buttons">
                            <button class="btn btn-secondary btn-small" onclick="gerarPDFOS('${os.id}')">üìÑ Gerar PDF</button>
                            <button class="btn btn-secondary btn-small" onclick="editarOS('${os.id}')">üëÅÔ∏è Ver Detalhes</button>
                            <button class="btn btn-danger btn-small" onclick="excluirOS('${os.id}')">üóëÔ∏è Excluir</button>
                        </td>
                    </tr>
                `;
            });
            
            html += '</tbody></table>';
            container.innerHTML = html;
        }

        function salvarContaPagar(event) {
            event.preventDefault();
            
            const conta = {
                id: editingId || generateId(),
                type: 'contaPagar',
                numeroDocumento: document.getElementById('numeroDocPagar').value.toUpperCase(),
                empresaNome: document.getElementById('empresaNomePagar').value.toUpperCase(),
                empresaCnpj: document.getElementById('empresaPagar').value,
                dataLancamento: document.getElementById('dataLancamentoPagar').value,
                dataVencimento: document.getElementById('dataVencimentoPagar').value,
                valor: parseFloat(document.getElementById('valorPagar').value),
                statusPagamento: document.getElementById('statusPagar').value,
                createdAt: new Date().toISOString()
            };

            if (editingId) {
                const index = allData.findIndex(r => r.id === editingId);
                if (index !== -1) {
                    allData[index] = conta;
                    showMessage('‚úÖ Conta atualizada com sucesso!', 'success');
                }
            } else {
                allData.push(conta);
                showMessage('‚úÖ Conta cadastrada com sucesso!', 'success');
            }

            saveToLocalStorage();
            limparFormContaPagar();
            atualizarTodasListas();
            closeEditPanel();
        }

        function limparFormContaPagar() {
            document.getElementById('formContaPagar').reset();
            editingId = null;
            document.getElementById('btnSalvarContaPagar').textContent = 'üíæ Cadastrar Conta';
            document.getElementById('empresaSelecionadaPagar').innerHTML = '';
        }

        function buscarEmpresaPagar() {
            const searchTerm = document.getElementById('searchEmpresaPagar').value.toLowerCase();
            const resultados = document.getElementById('resultadosEmpresaPagar');
            
            if (searchTerm.length < 2) {
                resultados.style.display = 'none';
                return;
            }

            const empresas = allData.filter(item => {
                if (item.type !== 'cliente' || item.tipoCliente !== 'juridica') return false;
                return (item.nome && item.nome.toLowerCase().includes(searchTerm)) ||
                       (item.cnpj && item.cnpj.includes(searchTerm)) ||
                       (item.razaoSocial && item.razaoSocial.toLowerCase().includes(searchTerm));
            });

            if (empresas.length === 0) {
                resultados.innerHTML = '<div class="search-result-item">‚ùå Nenhuma empresa encontrada</div>';
                resultados.style.display = 'block';
                return;
            }

            let html = '';
            empresas.forEach(empresa => {
                html += `
                    <div class="search-result-item" onclick="selecionarEmpresaPagar('${empresa.id}')">
                        <strong>${empresa.nome}</strong><br>
                        <small>CNPJ: ${empresa.cnpj || 'Sem CNPJ'}</small>
                        ${empresa.razaoSocial ? `<br><small>Raz√£o Social: ${empresa.razaoSocial}</small>` : ''}
                    </div>
                `;
            });

            resultados.innerHTML = html;
            resultados.style.display = 'block';
        }

        function selecionarEmpresaPagar(id) {
            const empresa = allData.find(c => c.id === id);
            if (!empresa) return;

            document.getElementById('resultadosEmpresaPagar').style.display = 'none';
            document.getElementById('searchEmpresaPagar').value = empresa.nome;
            document.getElementById('empresaNomePagar').value = empresa.nome;
            document.getElementById('empresaPagar').value = empresa.cnpj || '';

            const container = document.getElementById('empresaSelecionadaPagar');
            container.innerHTML = `
                <div class="selected-client">
                    <h4>‚úì Empresa Selecionada</h4>
                    <p><strong>Nome:</strong> ${empresa.nome}</p>
                    <p><strong>CNPJ:</strong> ${empresa.cnpj || '-'}</p>
                    ${empresa.razaoSocial ? `<p><strong>Raz√£o Social:</strong> ${empresa.razaoSocial}</p>` : ''}
                </div>
            `;
        }

        function editarContaPagar(id) {
            const conta = allData.find(c => c.id === id);
            if (!conta) {
                showMessage('‚ùå Conta n√£o encontrada', 'error');
                return;
            }

            openEditPanel();
            
            const content = document.getElementById('editPanelContent');
            content.innerHTML = `
                <h2>Editar Conta a Pagar</h2>
                <form id="formEditContaPagar" onsubmit="salvarContaPagarEdit(event, '${id}')">
                    <div class="form-group">
                        <label>N√∫mero do Documento/NF *</label>
                        <input type="text" id="editNumeroDoc" value="${conta.numeroDocumento || ''}" required>
                    </div>
                    <div class="form-group">
                        <label>Nome da Empresa *</label>
                        <input type="text" id="editEmpresaNome" value="${conta.empresaNome || ''}" required>
                    </div>
                    <div class="form-group">
                        <label>CNPJ da Empresa *</label>
                        <input type="text" id="editEmpresaCnpj" value="${conta.empresaCnpj || ''}" required maxlength="18" oninput="maskCNPJ(this)">
                    </div>
                    <div class="form-group">
                        <label>Data de Lan√ßamento *</label>
                        <input type="date" id="editDataLancamento" value="${conta.dataLancamento || ''}" required>
                    </div>
                    <div class="form-group">
                        <label>Data de Vencimento *</label>
                        <input type="date" id="editDataVencimento" value="${conta.dataVencimento || ''}" required>
                    </div>
                    <div class="form-group">
                        <label>Valor (R$) *</label>
                        <input type="number" id="editValor" value="${conta.valor || 0}" step="0.01" min="0" required>
                    </div>
                    <div class="form-group">
                        <label>Status *</label>
                        <select id="editStatus" required>
                            <option value="aberto" ${conta.statusPagamento === 'aberto' ? 'selected' : ''}>Em Aberto</option>
                            <option value="pago" ${conta.statusPagamento === 'pago' ? 'selected' : ''}>Pago</option>
                        </select>
                    </div>
                    <button type="submit" class="btn">üíæ Salvar Altera√ß√µes</button>
                    <button type="button" class="btn btn-secondary" onclick="closeEditPanel()">‚ùå Cancelar</button>
                </form>
            `;
        }

        function salvarContaPagarEdit(event, id) {
            event.preventDefault();
            const conta = allData.find(c => c.id === id);
            if (!conta) return;

            conta.numeroDocumento = document.getElementById('editNumeroDoc').value.toUpperCase();
            conta.empresaNome = document.getElementById('editEmpresaNome').value.toUpperCase();
            conta.empresaCnpj = document.getElementById('editEmpresaCnpj').value;
            conta.dataLancamento = document.getElementById('editDataLancamento').value;
            conta.dataVencimento = document.getElementById('editDataVencimento').value;
            conta.valor = parseFloat(document.getElementById('editValor').value);
            conta.statusPagamento = document.getElementById('editStatus').value;

            saveToLocalStorage();
            showMessage('‚úÖ Conta atualizada com sucesso!', 'success');
            atualizarTodasListas();
            closeEditPanel();
        }

        function excluirContaPagar(id) {
            const conta = allData.find(c => c.id === id);
            if (!conta) return;

            const confirmDiv = document.createElement('div');
            confirmDiv.className = 'message info';
            confirmDiv.innerHTML = `
                ‚ö†Ô∏è Tem certeza que deseja excluir esta conta?
                <div style="margin-top: 10px;">
                    <button class="btn btn-danger btn-small" onclick="confirmarExclusaoContaPagar('${id}')">‚úì Confirmar</button>
                    <button class="btn btn-secondary btn-small" onclick="this.parentElement.parentElement.remove()">‚úó Cancelar</button>
                </div>
            `;
            document.getElementById('messageContainer').appendChild(confirmDiv);
        }

        function confirmarExclusaoContaPagar(id) {
            allData = allData.filter(c => c.id !== id);
            saveToLocalStorage();
            showMessage('‚úÖ Conta exclu√≠da com sucesso!', 'success');
            atualizarTodasListas();
        }

        function filtrarContasPagar() {
            renderizarContasPagar();
        }

        function renderizarContasPagar() {
            const searchTerm = document.getElementById('searchContaPagar').value.toLowerCase();
            const filterStatus = document.getElementById('filterStatusPagar').value;
            const dataVencimentoBusca = document.getElementById('dataVencimentoBuscaPagar') ? document.getElementById('dataVencimentoBuscaPagar').value : '';
            
            const contas = allData.filter(item => {
                if (item.type !== 'contaPagar') return false;
                
                const matchSearch = !searchTerm || 
                    (item.numeroDocumento && item.numeroDocumento.toLowerCase().includes(searchTerm)) ||
                    (item.empresaNome && item.empresaNome.toLowerCase().includes(searchTerm)) ||
                    (item.empresaCnpj && item.empresaCnpj.includes(searchTerm));
                
                const matchStatus = !filterStatus || item.statusPagamento === filterStatus;
                
                let matchDataVencimento = true;
                if (dataVencimentoBusca && item.dataVencimento) {
                    matchDataVencimento = item.dataVencimento === dataVencimentoBusca;
                }
                
                return matchSearch && matchStatus && matchDataVencimento;
            });

            const container = document.getElementById('listaContasPagar');
            
            const hasSearchCriteria = searchTerm || filterStatus;
            
            if (contas.length === 0 && hasSearchCriteria) {
                container.innerHTML = '<div class="message info">‚ùå Nenhuma conta encontrada</div>';
                return;
            }
            
            if (contas.length === 0) {
                container.innerHTML = '';
                return;
            }

            let html = '<table><thead><tr><th>Documento</th><th>Empresa</th><th>CNPJ</th><th>Vencimento</th><th>Valor</th><th>Status</th><th>A√ß√µes</th></tr></thead><tbody>';
            
            contas.forEach(conta => {
                const dataVencimento = new Date(conta.dataVencimento).toLocaleDateString('pt-BR');
                
                html += `
                    <tr>
                        <td>${conta.numeroDocumento || '-'}</td>
                        <td>${conta.empresaNome || '-'}</td>
                        <td>${conta.empresaCnpj || '-'}</td>
                        <td>${dataVencimento}</td>
                        <td><strong>R$ ${(conta.valor || 0).toFixed(2)}</strong></td>
                        <td><span class="badge badge-${conta.statusPagamento === 'pago' ? 'paid' : 'pending'}">${conta.statusPagamento === 'pago' ? 'Pago' : 'Em Aberto'}</span></td>
                        <td class="action-buttons">
                            <button class="btn btn-secondary btn-small" onclick="editarContaPagar('${conta.id}')">‚úèÔ∏è Editar</button>
                            <button class="btn btn-danger btn-small" onclick="excluirContaPagar('${conta.id}')">üóëÔ∏è Excluir</button>
                        </td>
                    </tr>
                `;
            });
            
            html += '</tbody></table>';
            container.innerHTML = html;
        }

        function salvarContaReceber(event) {
            event.preventDefault();
            
            const conta = {
                id: editingId || generateId(),
                type: 'contaReceber',
                numeroDocumento: document.getElementById('numeroDocReceber').value.toUpperCase(),
                dataEmissao: document.getElementById('dataEmissaoReceber').value,
                dataVencimento: document.getElementById('dataVencimentoReceber').value,
                valor: parseFloat(document.getElementById('valorReceber').value),
                statusPagamento: document.getElementById('statusReceber').value,
                createdAt: new Date().toISOString()
            };

            if (editingId) {
                const index = allData.findIndex(r => r.id === editingId);
                if (index !== -1) {
                    allData[index] = conta;
                    showMessage('‚úÖ Conta atualizada com sucesso!', 'success');
                }
            } else {
                allData.push(conta);
                showMessage('‚úÖ Conta cadastrada com sucesso!', 'success');
            }

            saveToLocalStorage();
            limparFormContaReceber();
            atualizarTodasListas();
            closeEditPanel();
        }

        function limparFormContaReceber() {
            document.getElementById('formContaReceber').reset();
            editingId = null;
            document.getElementById('btnSalvarContaReceber').textContent = 'üíæ Cadastrar Conta';
        }

        function editarContaReceber(id) {
            const conta = allData.find(c => c.id === id);
            if (!conta) {
                showMessage('‚ùå Conta n√£o encontrada', 'error');
                return;
            }

            openEditPanel();
            
            const content = document.getElementById('editPanelContent');
            content.innerHTML = `
                <h2>Editar Conta a Receber</h2>
                <form id="formEditContaReceber" onsubmit="salvarContaReceberEdit(event, '${id}')">
                    <div class="form-group">
                        <label>N√∫mero do Documento/NF *</label>
                        <input type="text" id="editNumeroDoc" value="${conta.numeroDocumento || ''}" required>
                    </div>
                    <div class="form-group">
                        <label>Data de Emiss√£o/Lan√ßamento *</label>
                        <input type="date" id="editDataEmissao" value="${conta.dataEmissao || ''}" required>
                    </div>
                    <div class="form-group">
                        <label>Data de Vencimento *</label>
                        <input type="date" id="editDataVencimento" value="${conta.dataVencimento || ''}" required>
                    </div>
                    <div class="form-group">
                        <label>Valor (R$) *</label>
                        <input type="number" id="editValor" value="${conta.valor || 0}" step="0.01" min="0" required>
                    </div>
                    <div class="form-group">
                        <label>Status *</label>
                        <select id="editStatus" required>
                            <option value="aberto" ${conta.statusPagamento === 'aberto' ? 'selected' : ''}>Em Aberto</option>
                            <option value="pago" ${conta.statusPagamento === 'pago' ? 'selected' : ''}>Pago</option>
                        </select>
                    </div>
                    <button type="submit" class="btn">üíæ Salvar Altera√ß√µes</button>
                    <button type="button" class="btn btn-secondary" onclick="closeEditPanel()">‚ùå Cancelar</button>
                </form>
            `;
        }

        function salvarContaReceberEdit(event, id) {
            event.preventDefault();
            const conta = allData.find(c => c.id === id);
            if (!conta) return;

            conta.numeroDocumento = document.getElementById('editNumeroDoc').value.toUpperCase();
            conta.dataEmissao = document.getElementById('editDataEmissao').value;
            conta.dataVencimento = document.getElementById('editDataVencimento').value;
            conta.valor = parseFloat(document.getElementById('editValor').value);
            conta.statusPagamento = document.getElementById('editStatus').value;

            saveToLocalStorage();
            showMessage('‚úÖ Conta atualizada com sucesso!', 'success');
            atualizarTodasListas();
            closeEditPanel();
        }

        function excluirContaReceber(id) {
            const conta = allData.find(c => c.id === id);
            if (!conta) return;

            const confirmDiv = document.createElement('div');
            confirmDiv.className = 'message info';
            confirmDiv.innerHTML = `
                ‚ö†Ô∏è Tem certeza que deseja excluir esta conta?
                <div style="margin-top: 10px;">
                    <button class="btn btn-danger btn-small" onclick="confirmarExclusaoContaReceber('${id}')">‚úì Confirmar</button>
                    <button class="btn btn-secondary btn-small" onclick="this.parentElement.parentElement.remove()">‚úó Cancelar</button>
                </div>
            `;
            document.getElementById('messageContainer').appendChild(confirmDiv);
        }

        function confirmarExclusaoContaReceber(id) {
            allData = allData.filter(c => c.id !== id);
            saveToLocalStorage();
            showMessage('‚úÖ Conta exclu√≠da com sucesso!', 'success');
            atualizarTodasListas();
        }

        function filtrarContasReceber() {
            renderizarContasReceber();
        }

        function renderizarContasReceber() {
            const searchTerm = document.getElementById('searchContaReceber').value.toLowerCase();
            const filterStatus = document.getElementById('filterStatusReceber').value;
            
            const contas = allData.filter(item => {
                if (item.type !== 'contaReceber') return false;
                
                const matchSearch = !searchTerm || 
                    (item.numeroDocumento && item.numeroDocumento.toLowerCase().includes(searchTerm));
                
                const matchStatus = !filterStatus || item.statusPagamento === filterStatus;
                
                return matchSearch && matchStatus;
            });

            const container = document.getElementById('listaContasReceber');
            
            const hasSearchCriteria = searchTerm || filterStatus;
            
            if (contas.length === 0 && hasSearchCriteria) {
                container.innerHTML = '<div class="message info">‚ùå Nenhuma conta encontrada</div>';
                return;
            }
            
            if (contas.length === 0) {
                container.innerHTML = '';
                return;
            }

            let html = '<table><thead><tr><th>Documento</th><th>Emiss√£o</th><th>Vencimento</th><th>Valor</th><th>Status</th><th>A√ß√µes</th></tr></thead><tbody>';
            
            contas.forEach(conta => {
                const dataEmissao = new Date(conta.dataEmissao).toLocaleDateString('pt-BR');
                const dataVencimento = new Date(conta.dataVencimento).toLocaleDateString('pt-BR');
                
                html += `
                    <tr>
                        <td>${conta.numeroDocumento || '-'}</td>
                        <td>${dataEmissao}</td>
                        <td>${dataVencimento}</td>
                        <td><strong>R$ ${(conta.valor || 0).toFixed(2)}</strong></td>
                        <td><span class="badge badge-${conta.statusPagamento === 'pago' ? 'paid' : 'pending'}">${conta.statusPagamento === 'pago' ? 'Pago' : 'Em Aberto'}</span></td>
                        <td class="action-buttons">
                            <button class="btn btn-secondary btn-small" onclick="editarContaReceber('${conta.id}')">‚úèÔ∏è Editar</button>
                            <button class="btn btn-danger btn-small" onclick="excluirContaReceber('${conta.id}')">üóëÔ∏è Excluir</button>
                        </td>
                    </tr>
                `;
            });
            
            html += '</tbody></table>';
            container.innerHTML = html;
        }

        function atualizarEstatisticas() {
            const clientes = allData.filter(item => item.type === 'cliente');
            const clientesFisica = clientes.filter(c => c.tipoCliente === 'fisica').length;
            const clientesJuridica = clientes.filter(c => c.tipoCliente === 'juridica').length;
            
            const ordens = allData.filter(item => item.type === 'os');
            const osAbertas = ordens.filter(o => o.status === 'aberta').length;
            const osFechadas = ordens.filter(o => o.status === 'fechada').length;
            
            const faturamentoTotal = ordens.reduce((sum, os) => sum + (os.total || 0), 0);
            
            const hoje = new Date();
            const mesAtual = hoje.getMonth();
            const anoAtual = hoje.getFullYear();
            const faturamentoMensal = ordens
                .filter(os => {
                    const dataOS = new Date(os.dataEntrada);
                    return dataOS.getMonth() === mesAtual && dataOS.getFullYear() === anoAtual;
                })
                .reduce((sum, os) => sum + (os.total || 0), 0);

            const contasPagar = allData.filter(item => item.type === 'contaPagar');
            const contasPagarAbertas = contasPagar.filter(c => c.statusPagamento === 'aberto').length;

            const contasReceber = allData.filter(item => item.type === 'contaReceber');
            const contasReceberAbertas = contasReceber.filter(c => c.statusPagamento === 'aberto').length;

            const statsHTML = `
                <div class="stat-card">
                    <div class="stat-label">Total de Clientes</div>
                    <div class="stat-value">${clientes.length}</div>
                    <small>PF: ${clientesFisica} | PJ: ${clientesJuridica}</small>
                </div>
                <div class="stat-card">
                    <div class="stat-label">OS em Aberto</div>
                    <div class="stat-value">${osAbertas}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">OS Finalizadas</div>
                    <div class="stat-value">${osFechadas}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Faturamento Total</div>
                    <div class="stat-value">R$ ${faturamentoTotal.toFixed(2)}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Faturamento Mensal</div>
                    <div class="stat-value">R$ ${faturamentoMensal.toFixed(2)}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Contas a Pagar</div>
                    <div class="stat-value">${contasPagarAbertas}</div>
                    <small style="color: #e53935;">Em aberto</small>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Contas a Receber</div>
                    <div class="stat-value">${contasReceberAbertas}</div>
                    <small style="color: #43a047;">Em aberto</small>
                </div>
            `;

            document.getElementById('statsGrid').innerHTML = statsHTML;
        }

        function gerarRelatorio(tipo) {
            const container = document.getElementById('relatorioDetalhado');
            let html = '<div class="card" style="margin-top: 20px;">';

            switch(tipo) {
                case 'clientes':
                    const clientes = allData.filter(item => item.type === 'cliente');
                    html += '<h3>üìã Relat√≥rio de Clientes Cadastrados</h3>';
                    html += '<table><thead><tr><th>Nome</th><th>Tipo</th><th>CPF/CNPJ</th><th>Telefone</th><th>Endere√ßo</th></tr></thead><tbody>';
                    clientes.forEach(c => {
                        html += `<tr>
                            <td>${c.nome || '-'}</td>
                            <td>${c.tipoCliente === 'fisica' ? 'Pessoa F√≠sica' : 'Pessoa Jur√≠dica'}</td>
                            <td>${c.cpf || c.cnpj || '-'}</td>
                            <td>${c.telefone || '-'}</td>
                            <td>${c.endereco || '-'}</td>
                        </tr>`;
                    });
                    html += '</tbody></table>';
                    break;

                case 'osAbertas':
                    const osAbertas = allData.filter(item => item.type === 'os' && item.status === 'aberta');
                    html += '<h3>üìÇ Relat√≥rio de Ordens de Servi√ßo em Aberto</h3>';
                    html += '<table><thead><tr><th>N√∫mero</th><th>Data</th><th>Cliente</th><th>Ve√≠culo</th><th>Total</th></tr></thead><tbody>';
                    osAbertas.forEach(os => {
                        const cliente = allData.find(c => c.id === os.clienteId);
                        html += `<tr>
                            <td><strong>${os.numeroOS || '-'}</strong></td>
                            <td>${new Date(os.dataEntrada).toLocaleDateString('pt-BR')}</td>
                            <td>${cliente ? cliente.nome : 'N/A'}</td>
                            <td>${os.marca || '-'} ${os.modelo || '-'} (${os.placa || '-'})</td>
                            <td><strong>R$ ${(os.total || 0).toFixed(2)}</strong></td>
                        </tr>`;
                    });
                    html += '</tbody></table>';
                    break;

                case 'osFechadas':
                    const osFechadas = allData.filter(item => item.type === 'os' && item.status === 'fechada');
                    html += '<h3>‚úÖ Relat√≥rio de Ordens de Servi√ßo Finalizadas</h3>';
                    html += '<table><thead><tr><th>N√∫mero</th><th>Data Entrada</th><th>Data Sa√≠da</th><th>Cliente</th><th>Total</th></tr></thead><tbody>';
                    osFechadas.forEach(os => {
                        const cliente = allData.find(c => c.id === os.clienteId);
                        html += `<tr>
                            <td><strong>${os.numeroOS || '-'}</strong></td>
                            <td>${new Date(os.dataEntrada).toLocaleDateString('pt-BR')}</td>
                            <td>${os.dataSaida ? new Date(os.dataSaida).toLocaleDateString('pt-BR') : '-'}</td>
                            <td>${cliente ? cliente.nome : 'N/A'}</td>
                            <td><strong>R$ ${(os.total || 0).toFixed(2)}</strong></td>
                        </tr>`;
                    });
                    html += '</tbody></table>';
                    break;

                case 'servicosExecutados':
                    const todasOS = allData.filter(item => item.type === 'os');
                    const servicosCount = new Map();
                    todasOS.forEach(os => {
                        if (os.servicos) {
                            try {
                                const servicos = JSON.parse(os.servicos);
                                servicos.forEach(s => {
                                    const key = s.descricao;
                                    servicosCount.set(key, (servicosCount.get(key) || 0) + s.quantidade);
                                });
                            } catch (e) {}
                        }
                    });
                    const servicosArray = Array.from(servicosCount.entries())
                        .sort((a, b) => b[1] - a[1]);
                    
                    html += '<h3>üîß Relat√≥rio de Servi√ßos Mais Executados</h3>';
                    html += '<table><thead><tr><th>Servi√ßo</th><th>Quantidade Executada</th></tr></thead><tbody>';
                    servicosArray.forEach(([servico, qtd]) => {
                        html += `<tr>
                            <td>${servico}</td>
                            <td><strong>${qtd}</strong></td>
                        </tr>`;
                    });
                    html += '</tbody></table>';
                    break;

                case 'contasPagar':
                    const contasPagar = allData.filter(item => item.type === 'contaPagar');
                    html += '<h3>üí∞ Relat√≥rio de Contas a Pagar</h3>';
                    html += '<table><thead><tr><th>Documento</th><th>Empresa</th><th>Vencimento</th><th>Valor</th><th>Status</th></tr></thead><tbody>';
                    contasPagar.forEach(c => {
                        html += `<tr>
                            <td>${c.numeroDocumento || '-'}</td>
                            <td>${c.empresaNome || '-'}</td>
                            <td>${new Date(c.dataVencimento).toLocaleDateString('pt-BR')}</td>
                            <td><strong>R$ ${(c.valor || 0).toFixed(2)}</strong></td>
                            <td><span class="badge badge-${c.statusPagamento === 'pago' ? 'paid' : 'pending'}">${c.statusPagamento === 'pago' ? 'Pago' : 'Em Aberto'}</span></td>
                        </tr>`;
                    });
                    html += '</tbody></table>';
                    break;

                case 'contasReceber':
                    const contasReceber = allData.filter(item => item.type === 'contaReceber');
                    html += '<h3>üíµ Relat√≥rio de Contas a Receber</h3>';
                    html += '<table><thead><tr><th>Documento</th><th>Emiss√£o</th><th>Vencimento</th><th>Valor</th><th>Status</th></tr></thead><tbody>';
                    contasReceber.forEach(c => {
                        html += `<tr>
                            <td>${c.numeroDocumento || '-'}</td>
                            <td>${new Date(c.dataEmissao).toLocaleDateString('pt-BR')}</td>
                            <td>${new Date(c.dataVencimento).toLocaleDateString('pt-BR')}</td>
                            <td><strong>R$ ${(c.valor || 0).toFixed(2)}</strong></td>
                            <td><span class="badge badge-${c.statusPagamento === 'pago' ? 'paid' : 'pending'}">${c.statusPagamento === 'pago' ? 'Pago' : 'Em Aberto'}</span></td>
                        </tr>`;
                    });
                    html += '</tbody></table>';
                    break;

                case 'faturamentoPeriodo':
                    const dataInicial = document.getElementById('dataInicialRelatorio').value;
                    const dataFinal = document.getElementById('dataFinalRelatorio').value;
                    
                    if (!dataInicial || !dataFinal) {
                        showMessage('‚ö†Ô∏è Selecione as datas inicial e final', 'error');
                        return;
                    }

                    const ordensPeriodo = allData.filter(item => {
                        if (item.type !== 'os') return false;
                        const dataOS = item.dataEntrada.split('T')[0];
                        return dataOS >= dataInicial && dataOS <= dataFinal;
                    });

                    const faturamentoPeriodo = ordensPeriodo.reduce((sum, os) => sum + (os.total || 0), 0);

                    html += `<h3>üìä Faturamento por Per√≠odo</h3>`;
                    html += `<p><strong>Per√≠odo:</strong> ${new Date(dataInicial).toLocaleDateString('pt-BR')} a ${new Date(dataFinal).toLocaleDateString('pt-BR')}</p>`;
                    html += `<p style="font-size: 24px; color: #1e88e5;"><strong>Total: R$ ${faturamentoPeriodo.toFixed(2)}</strong></p>`;
                    html += '<table><thead><tr><th>N√∫mero OS</th><th>Data</th><th>Cliente</th><th>Valor</th></tr></thead><tbody>';
                    ordensPeriodo.forEach(os => {
                        const cliente = allData.find(c => c.id === os.clienteId);
                        html += `<tr>
                            <td><strong>${os.numeroOS || '-'}</strong></td>
                            <td>${new Date(os.dataEntrada).toLocaleDateString('pt-BR')}</td>
                            <td>${cliente ? cliente.nome : 'N/A'}</td>
                            <td><strong>R$ ${(os.total || 0).toFixed(2)}</strong></td>
                        </tr>`;
                    });
                    html += '</tbody></table>';
                    break;
            }

            html += '</div>';
            container.innerHTML = html;
        }

        function gerarPDFOS(id) {
            const os = allData.find(o => o.id === id);
            if (!os) {
                showMessage('‚ùå Ordem de servi√ßo n√£o encontrada', 'error');
                return;
            }

            const cliente = allData.find(c => c.id === os.clienteId);
            const clienteNome = cliente ? cliente.nome : 'Cliente n√£o encontrado';
            const clienteCpfCnpj = cliente ? (cliente.cpf || cliente.cnpj || '-') : '-';
            const clienteTelefone = cliente ? (cliente.telefone || '-') : '-';
            const clienteEndereco = cliente ? (cliente.endereco || '-') : '-';

            let servicosHTML = '';
            let total = 0;

            if (os.servicos) {
                try {
                    const servicos = JSON.parse(os.servicos);
                    servicos.forEach(s => {
                        const subtotal = s.valor * s.quantidade;
                        total += subtotal;
                        servicosHTML += `
                            <tr>
                                <td style="padding: 10px; border: 1px solid #333;">${s.descricao}</td>
                                <td style="padding: 10px; border: 1px solid #333; text-align: center;">${s.quantidade}</td>
                                <td style="padding: 10px; border: 1px solid #333; text-align: right;">R$ ${s.valor.toFixed(2)}</td>
                                <td style="padding: 10px; border: 1px solid #333; text-align: right;">R$ ${subtotal.toFixed(2)}</td>
                            </tr>
                        `;
                    });
                } catch (e) {}
            }

            const dataEntrada = new Date(os.dataEntrada).toLocaleDateString('pt-BR');
            const dataSaida = os.dataSaida ? new Date(os.dataSaida).toLocaleDateString('pt-BR') : '-';

            const pdfWindow = window.open('', '_blank');
            pdfWindow.document.write(`
                <!DOCTYPE html>
                <html lang="pt-BR">
                <head>
                    <meta charset="UTF-8">
                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                    <title>Ordem de Servi√ßo - ${os.numeroOS}</title>
                    <style>
                        * {
                            margin: 0;
                            padding: 0;
                            box-sizing: border-box;
                        }
                        @page {
                            size: A4;
                            margin: 10mm;
                        }
                        body {
                            font-family: Arial, sans-serif;
                            padding: 15px;
                            background: white;
                            color: #000;
                            font-size: 10px;
                        }
                        .container {
                            max-width: 100%;
                            margin: 0 auto;
                            border: 2px solid #000;
                            padding: 12px;
                        }
                        .header {
                            text-align: center;
                            border-bottom: 2px solid #000;
                            padding-bottom: 8px;
                            margin-bottom: 12px;
                        }
                        .header h1 {
                            font-size: 18px;
                            margin-bottom: 3px;
                            color: #000;
                        }
                        .header h2 {
                            font-size: 14px;
                            color: #333;
                        }
                        .os-number {
                            background: #000;
                            color: white;
                            padding: 6px;
                            text-align: center;
                            font-size: 14px;
                            font-weight: bold;
                            margin-bottom: 12px;
                        }
                        .section {
                            margin-bottom: 10px;
                            border: 1px solid #333;
                            padding: 8px;
                            page-break-inside: avoid;
                        }
                        .section-title {
                            font-size: 11px;
                            font-weight: bold;
                            background: #f0f0f0;
                            padding: 5px;
                            margin: -8px -8px 8px -8px;
                            border-bottom: 1px solid #333;
                        }
                        .info-row {
                            display: flex;
                            margin-bottom: 4px;
                            line-height: 1.3;
                        }
                        .info-label {
                            font-weight: bold;
                            min-width: 120px;
                        }
                        .info-value {
                            flex: 1;
                        }
                        table {
                            width: 100%;
                            border-collapse: collapse;
                            margin-top: 5px;
                            font-size: 9px;
                        }
                        th {
                            background: #333;
                            color: white;
                            padding: 5px;
                            text-align: left;
                            border: 1px solid #333;
                        }
                        td {
                            padding: 5px;
                            border: 1px solid #333;
                        }
                        .total-section {
                            background: #000;
                            color: white;
                            padding: 8px;
                            text-align: right;
                            font-size: 14px;
                            font-weight: bold;
                            margin-top: 10px;
                        }
                        .observacoes {
                            min-height: 50px;
                            border: 1px solid #333;
                            padding: 6px;
                            margin-top: 5px;
                            font-size: 9px;
                        }
                        .footer {
                            margin-top: 15px;
                            padding-top: 10px;
                            border-top: 2px solid #000;
                            display: flex;
                            justify-content: space-between;
                            page-break-inside: avoid;
                        }
                        .assinatura {
                            text-align: center;
                            flex: 1;
                        }
                        .assinatura-linha {
                            border-top: 1px solid #000;
                            margin-top: 30px;
                            padding-top: 3px;
                            font-size: 9px;
                        }
                        .status-badge {
                            display: inline-block;
                            padding: 3px 10px;
                            border-radius: 3px;
                            font-weight: bold;
                            font-size: 10px;
                        }
                        .status-aberta {
                            background: #fff3cd;
                            color: #856404;
                            border: 1px solid #856404;
                        }
                        .status-fechada {
                            background: #d4edda;
                            color: #155724;
                            border: 1px solid #155724;
                        }
                        @media print {
                            body {
                                padding: 0;
                            }
                            .no-print {
                                display: none !important;
                            }
                            .container {
                                border: 2px solid #000;
                                padding: 12px;
                            }
                        }
                        .print-button {
                            position: fixed;
                            top: 20px;
                            right: 20px;
                            padding: 15px 30px;
                            background: #1e88e5;
                            color: white;
                            border: none;
                            border-radius: 8px;
                            font-size: 16px;
                            font-weight: bold;
                            cursor: pointer;
                            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
                            z-index: 1000;
                        }
                        .print-button:hover {
                            background: #1565c0;
                        }
                        @media screen {
                            body {
                                padding: 20px;
                            }
                            .container {
                                max-width: 800px;
                            }
                        }
                    </style>
                </head>
                <body>
                    <button class="print-button no-print" onclick="window.print()">üñ®Ô∏è Imprimir / Salvar PDF</button>
                    
                    <div class="container">
                        <div class="header">
                            <h1>AUTO MEC√ÇNICA PREMIUM</h1>
                            <h2>Ordem de Servi√ßo</h2>
                        </div>

                        <div class="os-number">
                            ${os.numeroOS} - <span class="status-badge status-${os.status === 'aberta' ? 'aberta' : 'fechada'}">${os.status === 'aberta' ? 'ABERTA' : 'FECHADA'}</span>
                        </div>

                        <div class="section">
                            <div class="section-title">üìÖ INFORMA√á√ïES DA ORDEM</div>
                            <div class="info-row">
                                <div class="info-label">Data de Entrada:</div>
                                <div class="info-value">${dataEntrada}</div>
                            </div>
                            <div class="info-row">
                                <div class="info-label">Data de Sa√≠da:</div>
                                <div class="info-value">${dataSaida}</div>
                            </div>
                            ${os.recebidoPor ? `
                            <div class="info-row">
                                <div class="info-label">Recebido Por:</div>
                                <div class="info-value">${os.recebidoPor}</div>
                            </div>
                            ` : ''}
                            ${os.autorizadoPor ? `
                            <div class="info-row">
                                <div class="info-label">Autorizado Por:</div>
                                <div class="info-value">${os.autorizadoPor}</div>
                            </div>
                            ` : ''}
                        </div>

                        <div class="section">
                            <div class="section-title">üë§ DADOS DO CLIENTE</div>
                            <div class="info-row">
                                <div class="info-label">Nome:</div>
                                <div class="info-value">${clienteNome}</div>
                            </div>
                            <div class="info-row">
                                <div class="info-label">CPF/CNPJ:</div>
                                <div class="info-value">${clienteCpfCnpj}</div>
                            </div>
                            <div class="info-row">
                                <div class="info-label">Telefone:</div>
                                <div class="info-value">${clienteTelefone}</div>
                            </div>
                            <div class="info-row">
                                <div class="info-label">Endere√ßo:</div>
                                <div class="info-value">${clienteEndereco}</div>
                            </div>
                        </div>

                        <div class="section">
                            <div class="section-title">üöó DADOS DO VE√çCULO</div>
                            <div class="info-row">
                                <div class="info-label">Placa:</div>
                                <div class="info-value">${os.placa || '-'}</div>
                            </div>
                            <div class="info-row">
                                <div class="info-label">Marca:</div>
                                <div class="info-value">${os.marca || '-'}</div>
                            </div>
                            <div class="info-row">
                                <div class="info-label">Modelo:</div>
                                <div class="info-value">${os.modelo || '-'}</div>
                            </div>
                            <div class="info-row">
                                <div class="info-label">Cor:</div>
                                <div class="info-value">${os.cor || '-'}</div>
                            </div>
                            <div class="info-row">
                                <div class="info-label">Quilometragem:</div>
                                <div class="info-value">${os.quilometragem || '-'}</div>
                            </div>
                        </div>

                        <div class="section">
                            <div class="section-title">üîß SERVI√áOS EXECUTADOS</div>
                            <table>
                                <thead>
                                    <tr>
                                        <th>Descri√ß√£o</th>
                                        <th style="text-align: center; width: 80px;">Qtd</th>
                                        <th style="text-align: right; width: 120px;">Valor Unit.</th>
                                        <th style="text-align: right; width: 120px;">Subtotal</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${servicosHTML}
                                </tbody>
                            </table>
                        </div>

                        <div class="total-section">
                            VALOR TOTAL: R$ ${total.toFixed(2)}
                        </div>

                        ${os.observacoes ? `
                        <div class="section">
                            <div class="section-title">üìù OBSERVA√á√ïES</div>
                            <div class="observacoes">${os.observacoes}</div>
                        </div>
                        ` : ''}

                        <div class="footer">
                            <div class="assinatura">
                                <div class="assinatura-linha">Assinatura do Cliente</div>
                            </div>
                            <div class="assinatura">
                                <div class="assinatura-linha">Assinatura do Respons√°vel</div>
                            </div>
                        </div>
                    </div>
                </body>
                </html>
            `);
            pdfWindow.document.close();
        }

        function atualizarTodasListas() {
            renderizarClientes();
            renderizarServicos();
            renderizarOS();
            renderizarContasPagar();
            renderizarContasReceber();
        }

        function openEditPanel() {
            document.getElementById('editPanel').classList.add('open');
            document.getElementById('overlay').classList.add('active');
        }

        function closeEditPanel() {
            document.getElementById('editPanel').classList.remove('open');
            document.getElementById('overlay').classList.remove('active');
            editingId = null;
        }

        // Carregar dados ao iniciar - usando m√∫ltiplas estrat√©gias para garantir execu√ß√£o
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', loadFromLocalStorage);
        } else {
            loadFromLocalStorage();
        }
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'99c1ed8744aff390',t:'MTc2MjczOTcyOC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>