<!doctype html>
<html lang="pt-BR">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sistema de Gestão de Oficina</title>
  <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            box-sizing: border-box;
            font-family: Arial, 'Times New Roman', serif;
            min-height: 100%;
            transition: all 0.3s ease;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            color: #2d3748;
        }

        html, body {
            height: 100%;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100%;
            border-radius: 15px;
        }

        header {
            padding: 30px;
            border-radius: 20px;
            margin-bottom: 30px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
            transition: all 0.3s ease;
            position: relative;
            background: rgba(255, 255, 255, 0.98);
            border: 2px solid rgba(30, 136, 229, 0.1);
        }

        header:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.2);
        }

        h1 {
            font-size: 42px;
            background: linear-gradient(135deg, #1e88e5 0%, #00acc1 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-align: center;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .subtitle {
            text-align: center;
            color: #4a5568;
            font-size: 18px;
            font-style: italic;
        }

        nav {
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            justify-content: center;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.1);
            background: rgba(255, 255, 255, 0.98);
            border: 2px solid rgba(30, 136, 229, 0.2);
        }

        .nav-btn {
            color: #1e88e5;
            border: 2px solid #1e88e5;
            background: transparent;
            padding: 14px 28px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 15px;
            font-family: Arial, sans-serif;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(30, 136, 229, 0.2);
        }

        .nav-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(30, 136, 229, 0.3);
            background: rgba(30, 136, 229, 0.1);
        }

        .nav-btn.active {
            background: linear-gradient(135deg, #1e88e5 0%, #00acc1 100%);
            color: white;
            box-shadow: 0 6px 25px rgba(30, 136, 229, 0.4);
        }

        .content-section {
            padding: 35px;
            border-radius: 20px;
            margin: 0 auto 20px auto;
            max-width: 1000px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            display: none;
            animation: fadeIn 0.5s ease;
            background: rgba(255, 255, 255, 0.98);
            color: #2d3748;
            border: 2px solid rgba(30, 136, 229, 0.1);
        }

        /* Seção de cadastro de clientes mais compacta e centralizada */
        .content-section#clientes .tab-content#cadastroCliente {
            max-width: 700px;
            margin: 0 auto;
            padding: 25px;
            background: rgba(248, 250, 252, 0.98);
            border-radius: 15px;
            border: 2px solid rgba(30, 136, 229, 0.3);
        }

        /* Seção de cadastro de serviços centralizada */
        .content-section#servicos .tab-content#cadastroServico {
            max-width: 500px;
            margin: 0 auto;
            padding: 25px;
            background: rgba(248, 250, 252, 0.98);
            border-radius: 15px;
            border: 2px solid rgba(30, 136, 229, 0.3);
        }

        /* Seção de cadastro de OS ajustada para acompanhar conteúdo */
        .content-section#ordens .tab-content#cadastroOS {
            max-width: none;
            width: 100%;
            padding: 20px;
        }

        /* Seções com tabelas se expandem para acompanhar o conteúdo */
        .content-section:has(table) {
            max-width: none;
            width: 100%;
        }

        /* Fallback para navegadores que não suportam :has() */
        .content-section.with-table {
            max-width: none;
            width: 100%;
        }

        /* Tabelas de resultados ocupam tela inteira */
        .content-section table {
            max-width: none;
            width: 100%;
        }

        .content-section .tab-content {
            max-width: none;
        }

        #listaClientes, #listaServicos, #listaOS, #listaContasPagar, #listaContasReceber {
            max-width: none;
            width: 100%;
            overflow-x: auto;
            background: rgba(255, 255, 255, 0.98);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            border: 2px solid rgba(30, 136, 229, 0.1);
        }

        /* Scroll horizontal direto nas tabelas */
        .content-section table {
            width: 100%;
            min-width: 800px; /* Largura mínima para manter colunas legíveis */
            border-collapse: collapse;
            table-layout: fixed;
        }

        /* Container das listas com scroll */
        #listaClientes, #listaServicos, #listaOS, #listaContasPagar, #listaContasReceber {
            max-width: none;
            width: 100%;
            overflow-x: auto;
            margin-top: 20px;
        }

        .content-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        h2 {
            color: #1e88e5;
            margin-bottom: 25px;
            font-size: 48px;
            font-weight: bold;
            border-bottom: 3px solid #00acc1;
            padding-bottom: 12px;
            text-align: center;
        }

        /* Garantir que TODOS os H2 tenham o mesmo tamanho grande */
        .content-section h2,
        .tab-content h2,
        .edit-panel h2,
        .modal h2,
        .modal-title {
            font-size: 48px !important;
            font-weight: bold !important;
            color: #1e88e5 !important;
        }

        h3 {
            color: #00acc1;
            margin-bottom: 15px;
            font-size: 20px;
            font-weight: 600;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            font-size: 18px;
            color: #4a5568;
        }

        input, select, textarea {
            width: 100%;
            padding: 8px 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            font-family: Arial, sans-serif;
            transition: all 0.3s ease;
            background: #ffffff;
            color: #2d3748;
        }

        /* Campos com tamanho específico baseado no conteúdo */
        input[maxlength="14"] { /* CPF */
            max-width: 160px;
        }

        input[maxlength="18"] { /* CNPJ */
            max-width: 200px;
        }

        input[maxlength="15"] { /* Telefone */
            max-width: 180px;
        }

        input[maxlength="9"] { /* CEP */
            max-width: 120px;
        }

        input[maxlength="8"] { /* Placa */
            max-width: 120px;
        }

        input[type="date"] {
            max-width: 160px;
        }

        input[type="number"] {
            max-width: 140px;
        }

        /* Campos de texto curtos */
        #marcaOS, #modeloOS, #corOS {
            max-width: 200px;
        }

        #kmOS {
            max-width: 140px;
        }

        /* Campos de texto padrão mais compactos */
        input[type="text"]:not([maxlength]):not(#searchClienteOS):not(#searchServicoOS):not(#searchEmpresaPagar):not(#searchCliente):not(#searchServico):not(#searchContaPagar):not(#searchContaReceber):not(#searchOS):not(#searchPlacaOS):not(#searchCpfCnpjOS) {
            max-width: 300px;
        }

        /* Campos de busca mantêm largura total */
        #searchClienteOS, #searchServicoOS, #searchEmpresaPagar, #searchCliente, #searchServico, #searchContaPagar, #searchContaReceber, #searchOS, #searchPlacaOS, #searchCpfCnpjOS {
            max-width: none;
        }

        /* Campos específicos que devem manter largura total */
        #enderecoCliente, #enderecoEmpresa, #observacoesOS {
            max-width: none;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #1e88e5;
            box-shadow: 0 0 0 3px rgba(30, 136, 229, 0.1);
        }

        textarea {
            resize: vertical;
            min-height: 100px;
        }

        .btn {
            color: white;
            border: none;
            padding: 14px 32px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-family: Arial, sans-serif;
            font-weight: 600;
            transition: all 0.3s ease;
            margin-right: 10px;
            margin-top: 10px;
            box-shadow: 0 4px 15px rgba(30, 136, 229, 0.3);
            background: linear-gradient(135deg, #1e88e5 0%, #00acc1 100%);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(30, 136, 229, 0.4);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-danger {
            background: linear-gradient(135deg, #e53935 0%, #c62828 100%);
            box-shadow: 0 4px 15px rgba(229, 57, 53, 0.3);
        }

        .btn-danger:hover {
            box-shadow: 0 6px 25px rgba(229, 57, 53, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #43a047 0%, #2e7d32 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(67, 160, 71, 0.3);
        }

        .btn-secondary:hover {
            box-shadow: 0 6px 25px rgba(67, 160, 71, 0.4);
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 13px;
            min-width: 85px;
        }

        .message {
            padding: 16px 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            font-size: 15px;
            animation: slideDown 0.5s ease;
            border-left: 5px solid;
            font-weight: 500;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.success {
            background: #d4edda;
            border-color: #28a745;
            color: #155724;
        }

        .message.error {
            background: #f8d7da;
            border-color: #dc3545;
            color: #721c24;
        }

        .message.info {
            background: #d1ecf1;
            border-color: #17a2b8;
            color: #0c5460;
        }

        .radio-group {
            display: flex;
            gap: 25px;
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(30, 136, 229, 0.05);
            border-radius: 10px;
        }

        .radio-group label {
            display: flex;
            align-items: center;
            cursor: pointer;
            font-weight: 600;
            font-size: 18px;
        }

        .radio-group input[type="radio"] {
            width: auto;
            margin-right: 8px;
            cursor: pointer;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
            table-layout: fixed;
        }

        th, td {
            padding: 16px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            position: relative;
        }

        /* Estilos para redimensionamento de colunas */
        .resizable-table th {
            position: relative;
            user-select: none;
        }

        .resizable-table th:not(:last-child)::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 4px;
            height: 100%;
            cursor: col-resize;
            background: transparent;
            z-index: 10;
        }

        .resizable-table th:not(:last-child):hover::after {
            background: rgba(30, 136, 229, 0.3);
        }

        .resizable-table th.resizing::after {
            background: rgba(30, 136, 229, 0.6);
        }

        .resizable-table td {
            word-wrap: break-word;
            word-break: break-word;
        }

        /* Indicador visual durante redimensionamento */
        .resize-line {
            position: absolute;
            top: 0;
            width: 2px;
            background: #1e88e5;
            pointer-events: none;
            z-index: 1000;
            opacity: 0.8;
        }

        /* Larguras específicas para tabelas de clientes */
        #listaClientes table th:nth-child(1), #listaClientes table td:nth-child(1) { /* Nome */
            min-width: 200px;
            width: 25%;
        }
        
        #listaClientes table th:nth-child(2), #listaClientes table td:nth-child(2) { /* CPF/CNPJ */
            min-width: 150px;
            width: 18%;
        }
        
        #listaClientes table th:nth-child(3), #listaClientes table td:nth-child(3) { /* Telefone */
            min-width: 140px;
            width: 17%;
        }
        
        #listaClientes table th:nth-child(4), #listaClientes table td:nth-child(4) { /* Tipo */
            min-width: 120px;
            width: 15%;
        }
        
        #listaClientes table th:nth-child(5), #listaClientes table td:nth-child(5) { /* Ações */
            min-width: 220px;
            width: 25%;
            text-align: center;
        }

        /* Larguras específicas para tabelas de serviços */
        #listaServicos table th:nth-child(1), #listaServicos table td:nth-child(1) { /* Código */
            min-width: 140px;
            width: 18%;
        }
        
        #listaServicos table th:nth-child(2), #listaServicos table td:nth-child(2) { /* Descrição */
            min-width: 220px;
            width: 32%;
        }
        
        #listaServicos table th:nth-child(3), #listaServicos table td:nth-child(3) { /* Tipo */
            min-width: 130px;
            width: 16%;
        }
        
        #listaServicos table th:nth-child(4), #listaServicos table td:nth-child(4) { /* Valor */
            min-width: 140px;
            width: 16%;
            text-align: right;
            padding-right: 20px;
        }
        
        #listaServicos table th:nth-child(5), #listaServicos table td:nth-child(5) { /* Ações */
            min-width: 240px;
            width: 24%;
            text-align: center;
            padding-left: 20px;
        }

        /* Garantir que todas as colunas de ações fiquem centralizadas */
        table th:last-child, table td:last-child {
            text-align: center;
        }

        /* Larguras específicas para tabelas de contas a pagar */
        #listaContasPagar table th:nth-child(1), #listaContasPagar table td:nth-child(1) { /* Documento */
            min-width: 120px;
            width: 15%;
        }
        
        #listaContasPagar table th:nth-child(2), #listaContasPagar table td:nth-child(2) { /* Empresa */
            min-width: 200px;
            width: 25%;
        }
        
        #listaContasPagar table th:nth-child(3), #listaContasPagar table td:nth-child(3) { /* CNPJ */
            min-width: 150px;
            width: 18%;
        }
        
        #listaContasPagar table th:nth-child(4), #listaContasPagar table td:nth-child(4) { /* Vencimento */
            min-width: 110px;
            width: 12%;
        }
        
        #listaContasPagar table th:nth-child(5), #listaContasPagar table td:nth-child(5) { /* Valor */
            min-width: 120px;
            width: 15%;
        }
        
        #listaContasPagar table th:nth-child(6), #listaContasPagar table td:nth-child(6) { /* Status */
            min-width: 100px;
            width: 10%;
        }
        
        #listaContasPagar table th:nth-child(7), #listaContasPagar table td:nth-child(7) { /* Ações */
            min-width: 220px;
            width: 20%;
            text-align: center;
        }

        /* Larguras específicas para tabelas de contas a receber */
        #listaContasReceber table th:nth-child(1), #listaContasReceber table td:nth-child(1) { /* Documento */
            min-width: 150px;
            width: 20%;
        }
        
        #listaContasReceber table th:nth-child(2), #listaContasReceber table td:nth-child(2) { /* Emissão */
            min-width: 110px;
            width: 15%;
        }
        
        #listaContasReceber table th:nth-child(3), #listaContasReceber table td:nth-child(3) { /* Vencimento */
            min-width: 110px;
            width: 15%;
        }
        
        #listaContasReceber table th:nth-child(4), #listaContasReceber table td:nth-child(4) { /* Valor */
            min-width: 120px;
            width: 20%;
        }
        
        #listaContasReceber table th:nth-child(5), #listaContasReceber table td:nth-child(5) { /* Status */
            min-width: 100px;
            width: 15%;
        }
        
        #listaContasReceber table th:nth-child(6), #listaContasReceber table td:nth-child(6) { /* Ações */
            min-width: 220px;
            width: 25%;
            text-align: center;
        }

        th {
            color: white;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 13px;
            letter-spacing: 0.5px;
            background: linear-gradient(135deg, #1e88e5 0%, #00acc1 100%);
        }

        td {
            color: #2d3748;
            background: rgba(255, 255, 255, 0.8);
        }

        /* Efeito zebrado - linhas alternadas */
        tbody tr:nth-child(even) td {
            background: rgba(248, 250, 252, 0.9) !important;
        }

        tbody tr:nth-child(odd) td {
            background: rgba(255, 255, 255, 0.9) !important;
        }

        tr:hover td {
            transition: all 0.3s ease;
            background: rgba(30, 136, 229, 0.15) !important;
        }

        tr:last-child td {
            border-bottom: none;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: nowrap;
            align-items: center;
            justify-content: center;
            white-space: nowrap;
        }

        .search-box {
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 25px;
            border: 2px solid rgba(30, 136, 229, 0.2);
            background: rgba(248, 250, 252, 0.98);
        }

        .card {
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            border: 2px solid rgba(30, 136, 229, 0.2);
            transition: all 0.3s ease;
            background: rgba(248, 250, 252, 0.98);
        }

        /* Cards específicos da OS com espaçamento reduzido */
        #cadastroOS .card {
            padding: 12px;
            margin-bottom: 12px;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }

        #cadastroOS .form-group {
            margin-bottom: 8px;
        }

        #cadastroOS h3 {
            margin-bottom: 8px;
            font-size: 18px;
        }

        #cadastroOS label {
            margin-bottom: 4px;
            font-size: 17px;
        }

        #cadastroOS input, #cadastroOS select, #cadastroOS textarea {
            padding: 6px 10px;
            font-size: 13px;
        }

        #cadastroOS .form-row {
            gap: 15px;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .stat-card {
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            border: 2px solid rgba(30, 136, 229, 0.4);
            transition: all 0.3s ease;
            background: linear-gradient(135deg, rgba(30, 136, 229, 0.15) 0%, rgba(0, 172, 193, 0.15) 100%);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 30px rgba(30, 136, 229, 0.2);
        }

        .stat-value {
            font-size: 40px;
            font-weight: bold;
            background: linear-gradient(135deg, #1e88e5 0%, #00acc1 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: 10px 0;
        }

        .stat-label {
            font-size: 16px;
            font-weight: 600;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .os-items {
            padding: 20px;
            border-radius: 12px;
            margin-top: 20px;
            border: 2px solid rgba(30, 136, 229, 0.2);
            background: rgba(248, 250, 252, 0.8);
        }

        .os-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid rgba(226, 232, 240, 0.8);
            transition: all 0.3s ease;
            color: #2d3748;
        }

        .os-item:hover {
            background: rgba(30, 136, 229, 0.05);
        }

        .os-item:last-child {
            border-bottom: none;
        }

        .total-section {
            background: linear-gradient(135deg, #1e88e5 0%, #00acc1 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin-top: 20px;
            text-align: right;
            font-size: 24px;
            font-weight: bold;
            box-shadow: 0 4px 20px rgba(30, 136, 229, 0.3);
        }

        .badge {
            display: inline-block;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .badge-open {
            background: #fff3cd;
            color: #856404;
        }

        .badge-closed {
            background: #d4edda;
            color: #155724;
        }

        .badge-paid {
            background: #d4edda;
            color: #155724;
        }

        .badge-pending {
            background: #fff3cd;
            color: #856404;
        }

        .search-results {
            border: 2px solid rgba(30, 136, 229, 0.3);
            border-radius: 10px;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 10px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            background: white;
        }

        .search-result-item {
            padding: 15px;
            cursor: pointer;
            border-bottom: 1px solid rgba(226, 232, 240, 0.8);
            transition: all 0.3s ease;
            color: #2d3748;
        }

        .search-result-item:hover {
            background: rgba(30, 136, 229, 0.1);
        }

        .search-result-item:last-child {
            border-bottom: none;
        }

        .selected-client {
            padding: 20px;
            border-radius: 12px;
            margin-top: 15px;
            border: 2px solid #1e88e5;
            background: linear-gradient(135deg, rgba(30, 136, 229, 0.1) 0%, rgba(0, 172, 193, 0.1) 100%);
            color: #2d3748;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            border-bottom: 2px solid rgba(30, 136, 229, 0.2);
            padding-bottom: 10px;
        }

        .tab {
            padding: 12px 24px;
            background: transparent;
            border: none;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            border-radius: 8px 8px 0 0;
            transition: all 0.3s ease;
            color: #4a5568;
        }

        .tab:hover {
            background: rgba(30, 136, 229, 0.1);
        }

        .tab.active {
            background: linear-gradient(135deg, #1e88e5 0%, #00acc1 100%);
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .edit-panel {
            position: fixed;
            top: 0;
            right: -600px;
            width: 600px;
            height: 100%;
            box-shadow: -5px 0 30px rgba(0, 0, 0, 0.3);
            transition: right 0.4s ease;
            z-index: 1000;
            overflow-y: auto;
            padding: 30px;
            background: #ffffff;
        }

        .edit-panel input, .edit-panel select, .edit-panel textarea {
            background: #ffffff;
            color: #2d3748;
            border: 2px solid #e2e8f0;
        }

        .edit-panel input:focus, .edit-panel select:focus, .edit-panel textarea:focus {
            border-color: #1e88e5;
            background: #ffffff;
            color: #2d3748;
        }

        .edit-panel label {
            color: #4a5568;
            font-size: 18px;
        }

        .edit-panel h2 {
            color: #1e88e5;
        }

        .edit-panel.open {
            right: 0;
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            z-index: 999;
            transition: opacity 0.3s ease;
        }

        .overlay.active {
            display: block;
        }

        .close-panel {
            position: absolute;
            top: 20px;
            right: 20px;
            background: #e53935;
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 20px;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .close-panel:hover {
            transform: rotate(90deg);
            background: #c62828;
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            z-index: 2000;
            align-items: flex-start;
            justify-content: center;
            padding: 0;
            box-sizing: border-box;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: #ffffff;
            border-radius: 0;
            padding: 30px;
            width: 100%;
            height: 100%;
            overflow-y: auto;
            position: relative;
            box-shadow: none;
            animation: modalSlideIn 0.4s ease;
            color: #2d3748;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #1e88e5;
        }

        .modal-title {
            font-size: 28px;
            font-weight: bold;
            background: linear-gradient(135deg, #1e88e5 0%, #00acc1 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: 0;
        }

        .modal-close {
            background: #e53935;
            color: white;
            border: none;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 24px;
            font-weight: bold;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-close:hover {
            transform: rotate(90deg) scale(1.1);
            background: #c62828;
            box-shadow: 0 4px 15px rgba(229, 57, 53, 0.4);
        }

        /* Modal de Confirmação */
        .confirm-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            z-index: 3000;
            align-items: center;
            justify-content: center;
            padding: 20px;
            box-sizing: border-box;
        }

        .confirm-modal.active {
            display: flex;
        }

        /* Modal de Sucesso */
        .success-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            z-index: 3500;
            align-items: center;
            justify-content: center;
            padding: 20px;
            box-sizing: border-box;
        }

        .success-modal.active {
            display: flex;
        }

        .confirm-modal-content {
            background: #ffffff;
            border-radius: 20px;
            padding: 40px;
            max-width: 500px;
            width: 100%;
            position: relative;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            animation: confirmModalSlideIn 0.4s ease;
            color: #2d3748;
            border: 2px solid rgba(229, 57, 53, 0.3);
        }

        .success-modal-content {
            background: #ffffff;
            border-radius: 20px;
            padding: 40px;
            max-width: 500px;
            width: 100%;
            position: relative;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            animation: confirmModalSlideIn 0.4s ease;
            color: #2d3748;
            border: 2px solid rgba(67, 160, 71, 0.3);
        }

        @keyframes confirmModalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .confirm-modal-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .confirm-modal-icon {
            font-size: 60px;
            margin-bottom: 15px;
            display: block;
        }

        .confirm-modal-title {
            font-size: 24px;
            font-weight: bold;
            color: #e53935;
            margin-bottom: 10px;
        }

        .confirm-modal-message {
            font-size: 16px;
            color: #4a5568;
            line-height: 1.5;
            text-align: center;
            margin-bottom: 30px;
        }

        .success-modal-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .success-modal-icon {
            font-size: 60px;
            margin-bottom: 15px;
            display: block;
        }

        .success-modal-title {
            font-size: 24px;
            font-weight: bold;
            color: #43a047;
            margin-bottom: 10px;
        }

        .success-modal-message {
            font-size: 16px;
            color: #4a5568;
            line-height: 1.5;
            text-align: center;
            margin-bottom: 30px;
        }

        .success-modal-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .success-btn {
            padding: 14px 32px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 140px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .success-btn-primary {
            background: linear-gradient(135deg, #43a047 0%, #2e7d32 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(67, 160, 71, 0.3);
        }

        .success-btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(67, 160, 71, 0.4);
        }

        .confirm-modal-item-info {
            background: rgba(30, 136, 229, 0.1);
            border: 2px solid rgba(30, 136, 229, 0.3);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
            text-align: center;
        }

        .confirm-modal-item-name {
            font-size: 18px;
            font-weight: bold;
            color: #1e88e5;
            margin-bottom: 8px;
        }

        .confirm-modal-item-details {
            font-size: 14px;
            color: #4a5568;
            line-height: 1.4;
        }

        .confirm-modal-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .confirm-btn {
            padding: 14px 32px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 140px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .confirm-btn-danger {
            background: linear-gradient(135deg, #e53935 0%, #c62828 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(229, 57, 53, 0.3);
        }

        .confirm-btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(229, 57, 53, 0.4);
        }

        .confirm-btn-secondary {
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(108, 117, 125, 0.3);
        }

        .confirm-btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(108, 117, 125, 0.4);
        }

        @media (max-width: 768px) {
            .confirm-modal-content {
                padding: 30px 20px;
                margin: 20px;
            }

            .confirm-modal-title {
                font-size: 20px;
            }

            .confirm-modal-icon {
                font-size: 50px;
            }

            .confirm-modal-actions {
                flex-direction: column;
            }

            .confirm-btn {
                width: 100%;
            }

            .success-modal-content {
                padding: 30px 20px;
                margin: 20px;
            }

            .success-modal-title {
                font-size: 20px;
            }

            .success-modal-icon {
                font-size: 50px;
            }

            .success-modal-actions {
                flex-direction: column;
            }

            .success-btn {
                width: 100%;
            }
        }

        .modal-body {
            color: #2d3748;
        }

        .modal-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
            padding: 25px;
            background: linear-gradient(135deg, rgba(30, 136, 229, 0.15) 0%, rgba(0, 172, 193, 0.15) 100%);
            border-radius: 15px;
            border: 2px solid rgba(30, 136, 229, 0.3);
        }

        .modal-summary-item {
            text-align: center;
            padding: 15px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 12px;
            border: 1px solid rgba(30, 136, 229, 0.2);
        }

        .modal-summary-label {
            font-size: 14px;
            color: #4a5568;
            margin-bottom: 8px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .modal-summary-value {
            font-size: 24px;
            font-weight: bold;
            background: linear-gradient(135deg, #1e88e5 0%, #00acc1 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .modal-summary-value.success {
            background: linear-gradient(135deg, #43a047 0%, #2e7d32 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .modal-summary-value.warning {
            background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .modal-summary-value.danger {
            background: linear-gradient(135deg, #e53935 0%, #c62828 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .modal-table-container {
            background: rgba(248, 250, 252, 0.8);
            border-radius: 15px;
            padding: 20px;
            border: 2px solid rgba(30, 136, 229, 0.2);
        }

        .modal table {
            width: 100%;
            border-collapse: collapse;
            margin: 0;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        .modal th {
            background: linear-gradient(135deg, #1e88e5 0%, #00acc1 100%);
            color: white;
            padding: 16px;
            text-align: left;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 13px;
            letter-spacing: 0.5px;
            border: none;
        }

        .modal td {
            padding: 16px;
            border-bottom: 1px solid rgba(226, 232, 240, 0.8);
            background: rgba(255, 255, 255, 0.8);
            color: #2d3748;
        }

        /* Efeito zebrado nos modais */
        .modal tbody tr:nth-child(even) td {
            background: rgba(248, 250, 252, 0.9);
        }

        .modal tbody tr:nth-child(odd) td {
            background: rgba(255, 255, 255, 0.9);
        }

        .modal tr:hover td {
            background: rgba(30, 136, 229, 0.15) !important;
            transition: all 0.3s ease;
        }

        .modal tr:last-child td {
            border-bottom: none;
        }

        /* Larguras específicas para colunas dos relatórios */
        .modal table th:first-child,
        .modal table td:first-child {
            width: 120px;
            min-width: 120px;
            max-width: 120px;
        }

        /* Para tabelas de contas a pagar/receber - coluna documento */
        .modal table th:nth-child(1),
        .modal table td:nth-child(1) {
            width: 120px;
            min-width: 120px;
            max-width: 120px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* Para tabelas de OS - coluna número */
        .modal table th:first-child,
        .modal table td:first-child {
            width: 100px;
            min-width: 100px;
            max-width: 100px;
        }

        /* Colunas de data */
        .modal table th:nth-child(2),
        .modal table td:nth-child(2),
        .modal table th:nth-child(3),
        .modal table td:nth-child(3) {
            width: 110px;
            min-width: 110px;
            max-width: 110px;
            white-space: nowrap;
        }

        /* Colunas de valor */
        .modal table th:last-child,
        .modal table td:last-child {
            width: 120px;
            min-width: 120px;
            max-width: 120px;
            text-align: right;
            white-space: nowrap;
        }

        /* Coluna de status */
        .modal table th:nth-last-child(2),
        .modal table td:nth-last-child(2) {
            width: 100px;
            min-width: 100px;
            max-width: 100px;
            text-align: center;
        }

        @media (max-width: 768px) {
            .modal-content {
                max-width: 98%;
                max-height: 95%;
                padding: 20px;
            }

            .modal-title {
                font-size: 22px;
            }

            .modal-summary {
                grid-template-columns: 1fr;
                gap: 15px;
                padding: 20px;
            }

            .modal-summary-value {
                font-size: 20px;
            }
        }

        .item-quantity {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .qty-btn {
            background: #1e88e5;
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .qty-btn:hover {
            background: #1565c0;
            transform: scale(1.1);
        }

        .qty-display {
            min-width: 40px;
            text-align: center;
            font-weight: bold;
            font-size: 16px;
        }

        /* Estilos para os cards das OS */
        .os-cards-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .os-card {
            background: rgba(255, 255, 255, 0.95);
            border: 2px solid rgba(30, 136, 229, 0.2);
            border-radius: 15px;
            padding: 20px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .os-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(30, 136, 229, 0.2);
            border-color: rgba(30, 136, 229, 0.4);
        }

        .os-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(30, 136, 229, 0.1);
        }

        .os-number {
            font-size: 18px;
            font-weight: bold;
            color: #1e88e5;
            background: linear-gradient(135deg, rgba(30, 136, 229, 0.1) 0%, rgba(0, 172, 193, 0.1) 100%);
            padding: 8px 15px;
            border-radius: 8px;
            border: 1px solid rgba(30, 136, 229, 0.3);
        }

        .os-card-body {
            margin-bottom: 15px;
        }

        .os-info-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            padding: 5px 0;
        }

        .os-label {
            font-weight: 600;
            color: #4a5568;
            font-size: 14px;
            min-width: 100px;
        }

        .os-value {
            color: #2d3748;
            font-size: 14px;
            text-align: right;
            flex: 1;
            margin-left: 10px;
        }

        .os-total {
            font-weight: bold;
            font-size: 16px;
            color: #1e88e5;
        }

        .os-card-actions {
            display: flex;
            gap: 8px;
            justify-content: center;
            padding-top: 10px;
            border-top: 1px solid rgba(30, 136, 229, 0.1);
        }

        .os-card-actions .btn {
            flex: 1;
            margin: 0;
            padding: 10px;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: auto;
        }

        /* Estilos para Configurações */
        .theme-toggle-container {
            margin-top: 10px;
        }

        .theme-toggle {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 15px 25px;
            border: 2px solid #1e88e5;
            border-radius: 12px;
            background: transparent;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            color: #1e88e5;
            min-width: 200px;
        }

        .theme-toggle:hover {
            background: rgba(30, 136, 229, 0.1);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(30, 136, 229, 0.2);
        }

        .theme-icon {
            font-size: 20px;
            transition: transform 0.3s ease;
        }

        .theme-toggle:hover .theme-icon {
            transform: rotate(15deg);
        }

        .font-size-container {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-top: 10px;
            padding: 20px;
            background: rgba(30, 136, 229, 0.05);
            border-radius: 12px;
            border: 2px solid rgba(30, 136, 229, 0.1);
        }

        .font-size-label {
            font-weight: bold;
            color: #1e88e5;
            font-size: 16px;
            min-width: 20px;
            text-align: center;
        }

        .font-size-label.large {
            font-size: 24px;
        }

        #fontSizeSlider {
            flex: 1;
            height: 8px;
            border-radius: 5px;
            background: #e2e8f0;
            outline: none;
            cursor: pointer;
            -webkit-appearance: none;
        }

        #fontSizeSlider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: linear-gradient(135deg, #1e88e5 0%, #00acc1 100%);
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(30, 136, 229, 0.3);
            transition: all 0.3s ease;
        }

        #fontSizeSlider::-webkit-slider-thumb:hover {
            transform: scale(1.2);
            box-shadow: 0 4px 15px rgba(30, 136, 229, 0.4);
        }

        #fontSizeSlider::-moz-range-thumb {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: linear-gradient(135deg, #1e88e5 0%, #00acc1 100%);
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 8px rgba(30, 136, 229, 0.3);
        }

        .font-size-value {
            font-weight: bold;
            color: #1e88e5;
            font-size: 16px;
            min-width: 50px;
            text-align: center;
            background: rgba(30, 136, 229, 0.1);
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid rgba(30, 136, 229, 0.2);
        }

        .font-size-description {
            color: #666;
            font-style: italic;
            margin-top: 8px;
            display: block;
        }

        /* Modo Escuro */
        body.dark-theme {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            color: #e0e0e0;
        }

        .dark-theme .container {
            background: rgba(45, 45, 45, 0.95);
        }

        .dark-theme header {
            background: rgba(45, 45, 45, 0.98);
            border-color: rgba(30, 136, 229, 0.3);
            color: #e0e0e0;
        }

        .dark-theme nav {
            background: rgba(45, 45, 45, 0.98);
            border-color: rgba(30, 136, 229, 0.3);
        }

        .dark-theme .content-section {
            background: rgba(45, 45, 45, 0.98);
            border-color: rgba(30, 136, 229, 0.2);
            color: #e0e0e0;
        }

        .dark-theme .card {
            background: rgba(55, 55, 55, 0.98);
            border-color: rgba(30, 136, 229, 0.3);
            color: #e0e0e0;
        }

        .dark-theme .search-box {
            background: rgba(55, 55, 55, 0.98);
            border-color: rgba(30, 136, 229, 0.3);
            color: #e0e0e0;
        }

        .dark-theme input, .dark-theme select, .dark-theme textarea {
            background: #3a3a3a;
            border-color: #555;
            color: #e0e0e0;
        }

        .dark-theme input:focus, .dark-theme select:focus, .dark-theme textarea:focus {
            background: #404040;
            border-color: #1e88e5;
            color: #e0e0e0;
        }

        .dark-theme label {
            color: #c0c0c0;
        }

        .dark-theme th {
            background: linear-gradient(135deg, #1e88e5 0%, #00acc1 100%);
            color: white;
        }

        .dark-theme td {
            background: rgba(55, 55, 55, 0.8);
            color: #e0e0e0;
        }

        .dark-theme tbody tr:nth-child(even) td {
            background: rgba(65, 65, 65, 0.9) !important;
        }

        .dark-theme tbody tr:nth-child(odd) td {
            background: rgba(55, 55, 55, 0.9) !important;
        }

        .dark-theme tr:hover td {
            background: rgba(30, 136, 229, 0.25) !important;
        }

        .dark-theme .selected-client {
            background: linear-gradient(135deg, rgba(30, 136, 229, 0.2) 0%, rgba(0, 172, 193, 0.2) 100%);
            border-color: #1e88e5;
            color: #e0e0e0;
        }

        .dark-theme .os-items {
            background: rgba(55, 55, 55, 0.8);
            border-color: rgba(30, 136, 229, 0.3);
            color: #e0e0e0;
        }

        .dark-theme .os-item {
            color: #e0e0e0;
        }

        .dark-theme .os-item:hover {
            background: rgba(30, 136, 229, 0.15);
        }

        .dark-theme .stat-card {
            background: linear-gradient(135deg, rgba(30, 136, 229, 0.25) 0%, rgba(0, 172, 193, 0.25) 100%);
            border-color: rgba(30, 136, 229, 0.5);
            color: #e0e0e0;
        }

        .dark-theme .os-card {
            background: rgba(55, 55, 55, 0.95);
            border-color: rgba(30, 136, 229, 0.3);
            color: #e0e0e0;
        }

        .dark-theme .os-card:hover {
            border-color: rgba(30, 136, 229, 0.5);
        }

        .dark-theme .edit-panel {
            background: #2d2d2d;
            color: #e0e0e0;
        }

        .dark-theme .edit-panel input, .dark-theme .edit-panel select, .dark-theme .edit-panel textarea {
            background: #3a3a3a;
            border-color: #555;
            color: #e0e0e0;
        }

        .dark-theme .edit-panel input:focus, .dark-theme .edit-panel select:focus, .dark-theme .edit-panel textarea:focus {
            background: #404040;
            border-color: #1e88e5;
            color: #e0e0e0;
        }

        .dark-theme .edit-panel label {
            color: #c0c0c0;
        }

        .dark-theme .modal-content {
            background: #2d2d2d;
            color: #e0e0e0;
        }

        .dark-theme .modal-table-container {
            background: rgba(55, 55, 55, 0.8);
            border-color: rgba(30, 136, 229, 0.3);
        }

        .dark-theme .confirm-modal-content {
            background: #2d2d2d;
            color: #e0e0e0;
        }

        .dark-theme .success-modal-content {
            background: #2d2d2d;
            color: #e0e0e0;
        }

        .dark-theme .search-results {
            background: #3a3a3a;
            border-color: rgba(30, 136, 229, 0.4);
        }

        .dark-theme .search-result-item {
            color: #e0e0e0;
        }

        .dark-theme .search-result-item:hover {
            background: rgba(30, 136, 229, 0.2);
        }

        .dark-theme .message.info {
            background: rgba(23, 162, 184, 0.2);
            border-color: #17a2b8;
            color: #b8e6f0;
        }

        .dark-theme .font-size-container {
            background: rgba(30, 136, 229, 0.15);
            border-color: rgba(30, 136, 229, 0.3);
        }

        .dark-theme .font-size-description {
            color: #aaa;
        }

        .dark-theme .theme-toggle {
            color: #e0e0e0;
            border-color: #1e88e5;
        }

        .dark-theme .theme-toggle:hover {
            background: rgba(30, 136, 229, 0.2);
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }

            nav {
                flex-direction: column;
            }

            .nav-btn {
                width: 100%;
            }

            h1 {
                font-size: 28px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .edit-panel {
                width: 100%;
                right: -100%;
            }

            .tabs {
                flex-wrap: wrap;
            }

            .os-cards-container {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .os-card {
                padding: 15px;
            }

            .os-info-row {
                flex-direction: column;
                align-items: flex-start;
                gap: 3px;
            }

            .os-label {
                min-width: auto;
            }

            .os-value {
                text-align: left;
                margin-left: 0;
            }

            .os-card-actions {
                flex-direction: column;
                gap: 10px;
            }

            .os-card-actions .btn {
                width: 100%;
            }

            .font-size-container {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }

            .theme-toggle {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="/_sdk/element_sdk.js" type="text/javascript"></script>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
  <div class="overlay" id="overlay" onclick="closeEditPanel()"></div>
  <div class="container">
   <header>
    <h1 id="systemTitle">Sistema de Gestão de Oficina</h1>
    <p class="subtitle" id="companyName">Auto Mecânica Premium</p>
   </header>
   <nav><button class="nav-btn active" onclick="showSection('clientes', event)">👥 Clientes</button> <button class="nav-btn" onclick="showSection('servicos', event)">🔧 Serviços/Peças</button> <button class="nav-btn" onclick="showSection('ordens', event)">📋 Ordens de Serviço</button> <button class="nav-btn" onclick="showSection('contasPagar', event)">💰 Contas a Pagar</button> <button class="nav-btn" onclick="showSection('contasReceber', event)">💵 Contas a Receber</button> <button class="nav-btn" onclick="showSection('relatorios', event)">📊 Relatórios</button> <button class="nav-btn" onclick="showSection('configuracoes', event)">⚙️ Configurações</button>
   </nav>
   <div id="messageContainer"></div><!-- Seção Clientes -->
   <section id="clientes" class="content-section active">
    <div class="tabs"><button class="tab active" onclick="showTab('cadastroCliente', event)">Cadastrar</button> <button class="tab" onclick="showTab('pesquisaCliente', event)">Pesquisar</button>
    </div>
    <div id="cadastroCliente" class="tab-content active">
     <h2>Cadastro de Clientes</h2>
     <div class="radio-group"><label> <input type="radio" name="tipoCliente" value="fisica" checked onchange="toggleClienteForm()"> Pessoa Física </label> <label> <input type="radio" name="tipoCliente" value="juridica" onchange="toggleClienteForm()"> Pessoa Jurídica </label>
     </div>
     <form id="formCliente" onsubmit="salvarCliente(event)">
      <div id="camposFisica">
       <div class="form-row">
        <div class="form-group"><label for="nomeCliente">Nome *</label> <input type="text" id="nomeCliente" required>
        </div>
        <div class="form-group"><label for="cpfCliente">CPF</label> <input type="text" id="cpfCliente" maxlength="14" placeholder="000.000.000-00" oninput="maskCPF(this)">
        </div>
       </div>
       <div class="form-row">
        <div class="form-group"><label for="telefoneCliente">Telefone *</label> <input type="text" id="telefoneCliente" required maxlength="15" placeholder="(00) 00000-0000" oninput="maskPhone(this)">
        </div>
        <div class="form-group"><label for="cepCliente">CEP</label> <input type="text" id="cepCliente" maxlength="9" placeholder="00000-000" oninput="maskCEP(this)">
        </div>
       </div>
       <div class="form-group"><label for="enderecoCliente">Endereço</label> <input type="text" id="enderecoCliente">
       </div>
      </div>
      <div id="camposJuridica" style="display: none;">
       <div class="form-row">
        <div class="form-group"><label for="nomeEmpresa">Nome *</label> <input type="text" id="nomeEmpresa">
        </div>
        <div class="form-group"><label for="cnpjEmpresa">CNPJ *</label> <input type="text" id="cnpjEmpresa" maxlength="18" placeholder="00.000.000/0000-00" oninput="maskCNPJ(this)">
        </div>
       </div>
       <div class="form-row">
        <div class="form-group"><label for="razaoSocial">Razão Social *</label> <input type="text" id="razaoSocial">
        </div>
        <div class="form-group"><label for="nomeFantasia">Nome Fantasia</label> <input type="text" id="nomeFantasia">
        </div>
       </div>
       <div class="form-row">
        <div class="form-group"><label for="inscricaoEstadual">Inscrição Estadual *</label> <input type="text" id="inscricaoEstadual">
        </div>
        <div class="form-group"><label for="inscricaoMunicipal">Inscrição Municipal</label> <input type="text" id="inscricaoMunicipal">
        </div>
       </div>
       <div class="form-row">
        <div class="form-group"><label for="emailEmpresa">E-mail</label> <input type="email" id="emailEmpresa">
        </div>
        <div class="form-group"><label for="telefoneEmpresa">Telefone</label> <input type="text" id="telefoneEmpresa" maxlength="15" placeholder="(00) 00000-0000" oninput="maskPhone(this)">
        </div>
       </div>
       <div class="form-row">
        <div class="form-group"><label for="cepEmpresa">CEP</label> <input type="text" id="cepEmpresa" maxlength="9" placeholder="00000-000" oninput="maskCEP(this)">
        </div>
        <div class="form-group"><label for="enderecoEmpresa">Endereço</label> <input type="text" id="enderecoEmpresa">
        </div>
       </div>
      </div>
      <div style="text-align: center; margin-top: 30px; padding-top: 20px; border-top: 2px solid rgba(30, 136, 229, 0.2);"><button type="submit" class="btn" id="btnSalvarCliente">💾 Cadastrar Cliente</button> <button type="button" class="btn btn-secondary" onclick="limparFormCliente()">🔄 Limpar</button>
      </div>
     </form>
    </div>
    <div id="pesquisaCliente" class="tab-content">
     <h2>Pesquisar Clientes</h2>
     <div class="search-box">
      <div class="form-row">
       <div class="form-group"><label for="tipoBuscaCliente">Buscar por</label> <select id="tipoBuscaCliente" onchange="limparCampoBuscaCliente()"> <option value="nome">Nome</option> <option value="cpf">CPF</option> <option value="cnpj">CNPJ</option> </select>
       </div>
       <div class="form-group"><label for="searchCliente">Digite para buscar</label> <input type="text" id="searchCliente" placeholder="Digite para buscar..." oninput="aplicarMascaraBusca()" onkeypress="if(event.key==='Enter') filtrarClientes()">
       </div>
       <div class="form-group"><label for="filterTipo">Filtrar por Tipo</label> <select id="filterTipo"> <option value="">Todos</option> <option value="fisica">Pessoa Física</option> <option value="juridica">Pessoa Jurídica</option> </select>
       </div>
      </div><button class="btn" onclick="filtrarClientes()">🔍 Pesquisar</button>
     </div>
     <div id="listaClientes"></div>
    </div>
   </section><!-- Seção Serviços -->
   <section id="servicos" class="content-section">
    <div class="tabs"><button class="tab active" onclick="showTab('cadastroServico', event)">Cadastrar</button> <button class="tab" onclick="showTab('pesquisaServico', event)">Pesquisar</button>
    </div>
    <div id="cadastroServico" class="tab-content active">
     <h2>Cadastro de Serviços/Peças</h2>
     <div class="radio-group"><label> <input type="radio" name="tipoItem" value="servico" checked onchange="toggleItemForm()"> Serviço </label> <label> <input type="radio" name="tipoItem" value="peca" onchange="toggleItemForm()"> Peça </label>
     </div>
     <form id="formServico" onsubmit="salvarServico(event)">
      <div id="camposServico">
       <div class="form-row">
        <div class="form-group"><label for="descricaoServico">Descrição do Serviço *</label> <input type="text" id="descricaoServico" required>
        </div>
        <div class="form-group"><label for="codigoServico">Código do Serviço</label> <input type="text" id="codigoServico">
        </div>
       </div>
       <div class="form-group"><label for="valorServico">Valor (R$) *</label> <input type="number" id="valorServico" step="0.01" min="0" required>
       </div>
      </div>
      <div id="camposPeca" style="display: none;">
       <div class="form-row">
        <div class="form-group"><label for="descricaoPeca">Descrição da Peça *</label> <input type="text" id="descricaoPeca">
        </div>
        <div class="form-group"><label for="codigoPeca">Código da Peça</label> <input type="text" id="codigoPeca">
        </div>
       </div>
       <div class="form-group"><label for="valorPeca">Valor (R$) *</label> <input type="number" id="valorPeca" step="0.01" min="0">
       </div>
      </div>
      <div style="text-align: center; margin-top: 30px; padding-top: 20px; border-top: 2px solid rgba(30, 136, 229, 0.2);"><button type="submit" class="btn" id="btnSalvarServico">💾 Cadastrar Serviço</button> <button type="button" class="btn btn-secondary" onclick="limparFormServico()">🔄 Limpar</button>
      </div>
     </form>
    </div>
    <div id="pesquisaServico" class="tab-content">
     <h2>Pesquisar Serviços/Peças</h2>
     <div class="search-box">
      <div class="form-row">
       <div class="form-group"><label for="searchServico">Digite para buscar</label> <input type="text" id="searchServico" placeholder="Digite para buscar..." onkeypress="if(event.key==='Enter') filtrarServicos()">
       </div>
       <div class="form-group"><label for="filterTipoItem">Filtrar por Tipo</label> <select id="filterTipoItem"> <option value="">Todos</option> <option value="servico">Serviços</option> <option value="peca">Peças</option> </select>
       </div>
      </div><button class="btn" onclick="filtrarServicos()">🔍 Pesquisar</button>
     </div>
     <div id="listaServicos"></div>
    </div>
   </section><!-- Seção Ordens de Serviço -->
   <section id="ordens" class="content-section">
    <div class="tabs"><button class="tab active" onclick="showTab('cadastroOS', event)">Cadastrar</button> <button class="tab" onclick="showTab('pesquisaOS', event)">Pesquisar</button>
    </div>
    <div id="cadastroOS" class="tab-content active">
     <h2>Nova Ordem de Serviço</h2>
     <form id="formOS" onsubmit="salvarOS(event)">
      <div class="card">
       <h3>🔍 Buscar Cliente</h3>
       <div class="form-group"><label for="searchClienteOS">Pesquisar por Nome, CPF, CNPJ ou Razão Social</label> <input type="text" id="searchClienteOS" placeholder="Digite para buscar cliente..." oninput="buscarClienteOS()">
        <div id="resultadosClienteOS" class="search-results" style="display: none;"></div>
       </div>
       <div id="clienteSelecionadoOS"></div>
      </div>
      <div class="card">
       <h3>🚗 Dados do Veículo (Opcional)</h3>
       <div class="form-row">
        <div class="form-group"><label for="placaOS">Placa</label> <input type="text" id="placaOS" maxlength="8" placeholder="ABC-1234">
        </div>
        <div class="form-group"><label for="marcaOS">Marca</label> <input type="text" id="marcaOS">
        </div>
        <div class="form-group"><label for="modeloOS">Modelo</label> <input type="text" id="modeloOS">
        </div>
       </div>
       <div class="form-row">
        <div class="form-group"><label for="corOS">Cor</label> <input type="text" id="corOS">
        </div>
        <div class="form-group"><label for="kmOS">Quilometragem</label> <input type="text" id="kmOS" placeholder="Ex: 50000" oninput="formatarQuilometragem(this)">
        </div>
       </div>
      </div>
      <div class="card">
       <h3>👤 Responsáveis (Opcional)</h3>
       <div class="form-row">
        <div class="form-group"><label for="recebidoPorOS">Recebido Por</label> <input type="text" id="recebidoPorOS">
        </div>
        <div class="form-group"><label for="autorizadoPorOS">Autorizado Por</label> <input type="text" id="autorizadoPorOS">
        </div>
       </div>
      </div>
      <div class="card">
       <h3>🔧 Serviços e Peças</h3>
       <div class="form-row">
        <div class="form-group"><label for="searchServicoOS">Pesquisar Serviço ou Peça</label> <input type="text" id="searchServicoOS" placeholder="Digite para buscar serviços ou peças..." oninput="buscarServicoOS()">
         <div id="resultadosServicoOS" class="search-results" style="display: none;"></div>
        </div>
       </div>
      </div>
      <div id="itensOSContainer" style="display: none;">
       <div class="os-items" id="itensOS"></div>
       <div class="total-section" id="totalOS">
        Total: R$ 0,00
       </div>
      </div>
      <div class="card">
       <h3>📝 Observações</h3>
       <div class="form-group"><label for="observacoesOS">Observações</label> <textarea id="observacoesOS" rows="4"></textarea>
       </div>
      </div>
      <div style="text-align: center; margin-top: 30px; padding-top: 20px; border-top: 2px solid rgba(30, 136, 229, 0.2);"><button type="submit" class="btn" id="btnSalvarOS">💾 Criar Ordem de Serviço</button> <button type="button" class="btn btn-secondary" onclick="limparFormOS()">🔄 Limpar</button>
      </div>
     </form>
    </div>
    <div id="pesquisaOS" class="tab-content">
     <h2 style="text-align: center; font-size: 36px; margin-bottom: 30px;">Pesquisar Ordens de Serviço</h2>
     <div class="search-box">
      <div class="form-row">
       <div class="form-group"><label for="searchOS">Número da OS</label> <input type="text" id="searchOS" placeholder="Digite o número..." onkeypress="if(event.key==='Enter') filtrarOS()">
       </div>
       <div class="form-group"><label for="searchPlacaOS">Placa</label> <input type="text" id="searchPlacaOS" placeholder="Digite a placa..." onkeypress="if(event.key==='Enter') filtrarOS()">
       </div>
       <div class="form-group"><label for="searchCpfCnpjOS">CPF/CNPJ</label> <input type="text" id="searchCpfCnpjOS" placeholder="Digite CPF/CNPJ..." onkeypress="if(event.key==='Enter') filtrarOS()">
       </div>
      </div>
      <div class="form-row">
       <div class="form-group"><label for="dataEntradaOS">Data de Entrada</label> <input type="date" id="dataEntradaOS">
       </div>
       <div class="form-group"><label for="dataSaidaOS">Data de Saída</label> <input type="date" id="dataSaidaOS">
       </div>
       <div class="form-group"><label for="filterStatusOS">Status</label> <select id="filterStatusOS"> <option value="">Todos</option> <option value="aberta">Aberta</option> <option value="fechada">Fechada</option> </select>
       </div>
      </div><button class="btn" onclick="filtrarOS()">🔍 Pesquisar</button>
     </div>
     <div id="listaOS"></div>
    </div>
   </section><!-- Seção Contas a Pagar -->
   <section id="contasPagar" class="content-section">
    <div class="tabs"><button class="tab active" onclick="showTab('cadastroContaPagar', event)">Cadastrar</button> <button class="tab" onclick="showTab('pesquisaContaPagar', event)">Pesquisar</button>
    </div>
    <div id="cadastroContaPagar" class="tab-content active">
     <h2>Cadastro de Contas a Pagar</h2>
     <form id="formContaPagar" onsubmit="salvarContaPagar(event)">
      <div class="card">
       <h3>🔍 Buscar Empresa</h3>
       <div class="form-group"><label for="searchEmpresaPagar">Pesquisar por Nome, CNPJ ou Código</label> <input type="text" id="searchEmpresaPagar" placeholder="Digite para buscar empresa..." oninput="buscarEmpresaPagar()">
        <div id="resultadosEmpresaPagar" class="search-results" style="display: none;"></div>
       </div>
       <div id="empresaSelecionadaPagar"></div>
      </div>
      <div class="form-row">
       <div class="form-group"><label for="numeroDocPagar">Número do Documento/NF *</label> <input type="text" id="numeroDocPagar" required>
       </div>
       <div class="form-group"><label for="empresaNomePagar">Nome da Empresa *</label> <input type="text" id="empresaNomePagar" required>
       </div>
      </div>
      <div class="form-row">
       <div class="form-group"><label for="empresaPagar">CNPJ da Empresa *</label> <input type="text" id="empresaPagar" required maxlength="18" placeholder="00.000.000/0000-00" oninput="maskCNPJ(this)">
       </div>
       <div class="form-group"><label for="dataLancamentoPagar">Data de Lançamento *</label> <input type="date" id="dataLancamentoPagar" required>
       </div>
      </div>
      <div class="form-row">
       <div class="form-group"><label for="dataVencimentoPagar">Data de Vencimento *</label> <input type="date" id="dataVencimentoPagar" required>
       </div>
       <div class="form-group"><label for="valorPagar">Valor (R$) *</label> <input type="number" id="valorPagar" step="0.01" min="0" required>
       </div>
      </div>
      <div class="form-group"><label for="statusPagar">Status *</label> <select id="statusPagar" required> <option value="aberto">Em Aberto</option> <option value="pago">Pago</option> </select>
      </div>
      <div style="text-align: center; margin-top: 30px; padding-top: 20px; border-top: 2px solid rgba(30, 136, 229, 0.2);"><button type="submit" class="btn" id="btnSalvarContaPagar">💾 Cadastrar Conta</button> <button type="button" class="btn btn-secondary" onclick="limparFormContaPagar()">🔄 Limpar</button>
      </div>
     </form>
    </div>
    <div id="pesquisaContaPagar" class="tab-content">
     <h2>Pesquisar Contas a Pagar</h2>
     <div class="search-box">
      <div class="form-row">
       <div class="form-group"><label for="searchContaPagar">Número do Documento ou Nome da Empresa</label> <input type="text" id="searchContaPagar" placeholder="Digite para buscar..." onkeypress="if(event.key==='Enter') filtrarContasPagar()">
       </div>
       <div class="form-group"><label for="dataVencimentoBuscaPagar">Data de Vencimento</label> <input type="date" id="dataVencimentoBuscaPagar">
       </div>
       <div class="form-group"><label for="filterStatusPagar">Status</label> <select id="filterStatusPagar"> <option value="">Todos</option> <option value="aberto">Em Aberto</option> <option value="pago">Pago</option> </select>
       </div>
      </div><button class="btn" onclick="filtrarContasPagar()">🔍 Pesquisar</button>
     </div>
     <div id="listaContasPagar"></div>
    </div>
   </section><!-- Seção Contas a Receber -->
   <section id="contasReceber" class="content-section">
    <div class="tabs"><button class="tab active" onclick="showTab('cadastroContaReceber', event)">Cadastrar</button> <button class="tab" onclick="showTab('pesquisaContaReceber', event)">Pesquisar</button>
    </div>
    <div id="cadastroContaReceber" class="tab-content active">
     <h2>Cadastro de Contas a Receber</h2>
     <form id="formContaReceber" onsubmit="salvarContaReceber(event)">
      <div class="form-row">
       <div class="form-group"><label for="numeroDocReceber">Número do Documento/NF *</label> <input type="text" id="numeroDocReceber" required>
       </div>
       <div class="form-group"><label for="dataEmissaoReceber">Data de Emissão/Lançamento *</label> <input type="date" id="dataEmissaoReceber" required>
       </div>
      </div>
      <div class="form-row">
       <div class="form-group"><label for="dataVencimentoReceber">Data de Vencimento *</label> <input type="date" id="dataVencimentoReceber" required>
       </div>
       <div class="form-group"><label for="valorReceber">Valor (R$) *</label> <input type="number" id="valorReceber" step="0.01" min="0" required>
       </div>
      </div>
      <div class="form-group"><label for="statusReceber">Status *</label> <select id="statusReceber" required> <option value="aberto">Em Aberto</option> <option value="pago">Pago</option> </select>
      </div>
      <div style="text-align: center; margin-top: 30px; padding-top: 20px; border-top: 2px solid rgba(30, 136, 229, 0.2);"><button type="submit" class="btn" id="btnSalvarContaReceber">💾 Cadastrar Conta</button> <button type="button" class="btn btn-secondary" onclick="limparFormContaReceber()">🔄 Limpar</button>
      </div>
     </form>
    </div>
    <div id="pesquisaContaReceber" class="tab-content">
     <h2>Pesquisar Contas a Receber</h2>
     <div class="search-box">
      <div class="form-row">
       <div class="form-group"><label for="searchContaReceber">Número do Documento</label> <input type="text" id="searchContaReceber" placeholder="Digite para buscar..." onkeypress="if(event.key==='Enter') filtrarContasReceber()">
       </div>
       <div class="form-group"><label for="filterStatusReceber">Status</label> <select id="filterStatusReceber"> <option value="">Todos</option> <option value="aberto">Em Aberto</option> <option value="pago">Pago</option> </select>
       </div>
      </div><button class="btn" onclick="filtrarContasReceber()">🔍 Pesquisar</button>
     </div>
     <div id="listaContasReceber"></div>
    </div>
   </section><!-- Seção Relatórios -->
   <section id="relatorios" class="content-section">
    <h2>📊 Relatórios e Estatísticas</h2>
    <div class="stats-grid" id="statsGrid"></div>
    <div class="card">
     <h3>Relatórios Detalhados</h3>
     <div class="form-row"><button class="btn" onclick="gerarRelatorio('osAbertas')">📂 OS em Aberto</button> <button class="btn" onclick="gerarRelatorio('osFechadas')">✅ OS Finalizadas</button> <button class="btn" onclick="gerarRelatorio('servicosExecutados')">🔧 Serviços Executados</button>
     </div>
    </div>
    <div class="card">
     <h3>💰 Contas a Pagar por Período</h3>
     <div class="form-row">
      <div class="form-group"><label for="dataInicialContasPagar">Data Inicial (Vencimento)</label> <input type="date" id="dataInicialContasPagar">
      </div>
      <div class="form-group"><label for="dataFinalContasPagar">Data Final (Vencimento)</label> <input type="date" id="dataFinalContasPagar">
      </div>
     </div><button class="btn" onclick="gerarRelatorio('contasPagar')">💰 Gerar Relatório de Contas a Pagar</button>
    </div>
    <div class="card">
     <h3>💵 Contas a Receber por Período</h3>
     <div class="form-row">
      <div class="form-group"><label for="dataInicialContasReceber">Data Inicial (Vencimento)</label> <input type="date" id="dataInicialContasReceber">
      </div>
      <div class="form-group"><label for="dataFinalContasReceber">Data Final (Vencimento)</label> <input type="date" id="dataFinalContasReceber">
      </div>
     </div><button class="btn" onclick="gerarRelatorio('contasReceber')">💵 Gerar Relatório de Contas a Receber</button>
    </div>
    <div class="card">
     <h3>Faturamento por Período</h3>
     <div class="form-row">
      <div class="form-group"><label for="dataInicialRelatorio">Data Inicial</label> <input type="date" id="dataInicialRelatorio">
      </div>
      <div class="form-group"><label for="dataFinalRelatorio">Data Final</label> <input type="date" id="dataFinalRelatorio">
      </div>
     </div><button class="btn" onclick="gerarRelatorio('faturamentoPeriodo')">📊 Gerar Relatório</button>
    </div>
    <div id="relatorioDetalhado"></div>
   </section><!-- Seção Configurações -->
   <section id="configuracoes" class="content-section">
    <h2>⚙️ Configurações do Sistema</h2>
    <div class="card">
     <h3>🎨 Aparência</h3>
     <div class="form-group"><label for="themeToggle">Tema do Sistema</label>
      <div class="theme-toggle-container"><button class="theme-toggle" id="themeToggle" onclick="toggleTheme()"> <span class="theme-icon" id="themeIcon">☀️</span> <span class="theme-text" id="themeText">Modo Claro</span> </button>
      </div>
     </div>
    </div>
    <div class="card">
     <h3>🔤 Acessibilidade</h3>
     <div class="form-group"><label for="fontSizeSlider">Tamanho da Fonte</label>
      <div class="font-size-container"><span class="font-size-label">A</span> <input type="range" id="fontSizeSlider" min="85" max="130" value="100" step="5" oninput="adjustFontSize(this.value)"> <span class="font-size-label large">A</span> <span class="font-size-value" id="fontSizeValue">100%</span>
      </div><small class="font-size-description">Ajuste o tamanho do texto para melhor legibilidade</small>
     </div>
     <div class="form-group"><button class="btn btn-secondary" onclick="resetFontSize()">🔄 Restaurar Padrão</button>
     </div>
    </div>
    <div class="card">
     <h3>💾 Dados do Sistema</h3>
     <div class="form-row"><button class="btn btn-secondary" onclick="exportarDados()">📤 Exportar Dados</button> <button class="btn btn-secondary" onclick="importarDados()">📥 Importar Dados</button>
     </div><input type="file" id="importFile" accept=".json" style="display: none;" onchange="processarImportacao(event)"> <small style="color: #666; margin-top: 10px; display: block;"> 📤 Exportar: Salva todos os dados em arquivo JSON para backup<br>
       📥 Importar: Carrega dados de arquivo JSON (substitui dados atuais) </small>
    </div>
   </section>
  </div><!-- Modal para Relatórios -->
  <div class="modal" id="relatorioModal">
   <div class="modal-content">
    <div class="modal-header">
     <h2 class="modal-title" id="modalTitle">Relatório</h2><button class="modal-close" onclick="fecharModal()">×</button>
    </div>
    <div class="modal-body">
     <div id="modalSummary" class="modal-summary"></div>
     <div id="modalTableContainer" class="modal-table-container"></div>
    </div>
   </div>
  </div><!-- Modal de Confirmação -->
  <div class="confirm-modal" id="confirmModal">
   <div class="confirm-modal-content">
    <div class="confirm-modal-header"><span class="confirm-modal-icon" id="confirmIcon">⚠️</span>
     <h3 class="confirm-modal-title" id="confirmTitle">Confirmar Exclusão</h3>
    </div>
    <div class="confirm-modal-message" id="confirmMessage">
     Esta ação não pode ser desfeita.
    </div>
    <div class="confirm-modal-item-info" id="confirmItemInfo">
     <div class="confirm-modal-item-name" id="confirmItemName"></div>
     <div class="confirm-modal-item-details" id="confirmItemDetails"></div>
    </div>
    <div class="confirm-modal-actions"><button class="confirm-btn confirm-btn-danger" id="confirmDeleteBtn"> 🗑️ Confirmar Exclusão </button> <button class="confirm-btn confirm-btn-secondary" onclick="fecharConfirmModal()"> ❌ Fechar </button>
    </div>
   </div>
  </div><!-- Modal de Sucesso -->
  <div class="success-modal" id="successModal">
   <div class="success-modal-content">
    <div class="success-modal-header"><span class="success-modal-icon" id="successIcon">✅</span>
     <h3 class="success-modal-title" id="successTitle">Operação Realizada</h3>
    </div>
    <div class="success-modal-message" id="successMessage">
     Operação realizada com sucesso!
    </div>
    <div class="success-modal-actions"><button class="success-btn success-btn-primary" onclick="fecharSuccessModal()"> 👍 OK </button>
    </div>
   </div>
  </div><!-- Painel de Edição -->
  <div class="edit-panel" id="editPanel"><button class="close-panel" onclick="closeEditPanel()">×</button>
   <div id="editPanelContent"></div>
  </div>
  <script>
        // Sistema de armazenamento usando localStorage
        let allData = [];
        let editingId = null;
        let currentOSItems = [];
        let osCounter = 1;
        let selectedClienteOS = null;
        let columnWidths = {};
        let currentTheme = 'light';
        let currentFontSize = 100;

        // Funções de armazenamento local
        function saveToLocalStorage() {
            localStorage.setItem('oficinaData', JSON.stringify(allData));
            localStorage.setItem('columnWidths', JSON.stringify(columnWidths));
            localStorage.setItem('userTheme', currentTheme);
            localStorage.setItem('userFontSize', currentFontSize.toString());
        }

        function loadFromLocalStorage() {
            const data = localStorage.getItem('oficinaData');
            if (data) {
                allData = JSON.parse(data);
                const maxOS = Math.max(0, ...allData
                    .filter(item => item.type === 'os' && item.numeroOS)
                    .map(os => parseInt(os.numeroOS.replace('OS-', '')) || 0)
                );
                osCounter = maxOS + 1;
                atualizarTodasListas();
                atualizarEstatisticas();
            }
            
            const widths = localStorage.getItem('columnWidths');
            if (widths) {
                columnWidths = JSON.parse(widths);
            }

            // Carregar configurações de tema e fonte
            const savedTheme = localStorage.getItem('userTheme');
            if (savedTheme) {
                currentTheme = savedTheme;
                applyTheme(currentTheme);
            }

            const savedFontSize = localStorage.getItem('userFontSize');
            if (savedFontSize) {
                currentFontSize = parseInt(savedFontSize);
                applyFontSize(currentFontSize);
            }
            
            console.log('Sistema inicializado com sucesso!');
        }

        function generateId() {
            return 'id_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }

        // Funções para redimensionamento de colunas
        function makeTableResizable(table, tableId) {
            if (!table) return;
            
            table.classList.add('resizable-table');
            const headers = table.querySelectorAll('th');
            
            headers.forEach((header, index) => {
                if (index === headers.length - 1) return; // Não redimensionar última coluna
                
                const columnKey = `${tableId}_col_${index}`;
                
                // Aplicar largura salva se existir
                if (columnWidths[columnKey]) {
                    header.style.width = columnWidths[columnKey] + 'px';
                }
                
                let isResizing = false;
                let startX = 0;
                let startWidth = 0;
                let resizeLine = null;
                
                const onMouseDown = (e) => {
                    const rect = header.getBoundingClientRect();
                    if (e.clientX >= rect.right - 4) {
                        isResizing = true;
                        startX = e.clientX;
                        startWidth = header.offsetWidth;
                        header.classList.add('resizing');
                        
                        // Criar linha de redimensionamento
                        resizeLine = document.createElement('div');
                        resizeLine.className = 'resize-line';
                        resizeLine.style.left = e.clientX + 'px';
                        resizeLine.style.height = table.offsetHeight + 'px';
                        document.body.appendChild(resizeLine);
                        
                        document.addEventListener('mousemove', onMouseMove);
                        document.addEventListener('mouseup', onMouseUp);
                        e.preventDefault();
                    }
                };
                
                const onMouseMove = (e) => {
                    if (!isResizing) return;
                    
                    const diff = e.clientX - startX;
                    const newWidth = Math.max(50, startWidth + diff); // Largura mínima de 50px
                    
                    header.style.width = newWidth + 'px';
                    
                    // Atualizar linha de redimensionamento
                    if (resizeLine) {
                        resizeLine.style.left = e.clientX + 'px';
                    }
                    
                    // Aplicar largura para todas as células da coluna
                    const rows = table.querySelectorAll('tr');
                    rows.forEach(row => {
                        const cell = row.children[index];
                        if (cell) {
                            cell.style.width = newWidth + 'px';
                        }
                    });
                };
                
                const onMouseUp = () => {
                    if (!isResizing) return;
                    
                    isResizing = false;
                    header.classList.remove('resizing');
                    
                    // Remover linha de redimensionamento
                    if (resizeLine) {
                        document.body.removeChild(resizeLine);
                        resizeLine = null;
                    }
                    
                    // Salvar largura
                    columnWidths[columnKey] = header.offsetWidth;
                    saveToLocalStorage();
                    
                    document.removeEventListener('mousemove', onMouseMove);
                    document.removeEventListener('mouseup', onMouseUp);
                };
                
                header.addEventListener('mousedown', onMouseDown);
            });
        }

        function applyColumnWidths(table, tableId) {
            if (!table) return;
            
            const headers = table.querySelectorAll('th');
            const rows = table.querySelectorAll('tr');
            
            headers.forEach((header, index) => {
                const columnKey = `${tableId}_col_${index}`;
                
                if (columnWidths[columnKey]) {
                    const width = columnWidths[columnKey];
                    header.style.width = width + 'px';
                    
                    // Aplicar para todas as células da coluna
                    rows.forEach(row => {
                        const cell = row.children[index];
                        if (cell) {
                            cell.style.width = width + 'px';
                        }
                    });
                }
            });
        }

        // Máscaras de entrada
        function maskCPF(input) {
            let value = input.value.replace(/\D/g, '');
            if (value.length <= 11) {
                value = value.replace(/(\d{3})(\d)/, '$1.$2');
                value = value.replace(/(\d{3})(\d)/, '$1.$2');
                value = value.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
                input.value = value;
            }
        }

        function maskCNPJ(input) {
            let value = input.value.replace(/\D/g, '');
            if (value.length <= 14) {
                value = value.replace(/^(\d{2})(\d)/, '$1.$2');
                value = value.replace(/^(\d{2})\.(\d{3})(\d)/, '$1.$2.$3');
                value = value.replace(/\.(\d{3})(\d)/, '.$1/$2');
                value = value.replace(/(\d{4})(\d)/, '$1-$2');
                input.value = value;
            }
        }

        function maskPhone(input) {
            let value = input.value.replace(/\D/g, '');
            if (value.length <= 11) {
                if (value.length <= 10) {
                    value = value.replace(/^(\d{2})(\d)/, '($1) $2');
                    value = value.replace(/(\d{4})(\d)/, '$1-$2');
                } else {
                    value = value.replace(/^(\d{2})(\d)/, '($1) $2');
                    value = value.replace(/(\d{5})(\d)/, '$1-$2');
                }
                input.value = value;
            }
        }

        function maskCEP(input) {
            let value = input.value.replace(/\D/g, '');
            if (value.length <= 8) {
                value = value.replace(/^(\d{5})(\d)/, '$1-$2');
                input.value = value;
            }
        }

        function aplicarMascaraBusca() {
            const tipoBusca = document.getElementById('tipoBuscaCliente').value;
            const input = document.getElementById('searchCliente');
            
            if (tipoBusca === 'cpf') {
                maskCPF(input);
            } else if (tipoBusca === 'cnpj') {
                maskCNPJ(input);
            }
        }

        function limparCampoBuscaCliente() {
            document.getElementById('searchCliente').value = '';
        }

        function formatarQuilometragem(input) {
            let value = input.value.replace(/\D/g, '');
            if (value) {
                input.value = value + ' km';
                input.setSelectionRange(value.length, value.length);
            }
        }

        function showSection(sectionId, event) {
            const sections = document.querySelectorAll('.content-section');
            sections.forEach(section => section.classList.remove('active'));
            
            const buttons = document.querySelectorAll('.nav-btn');
            buttons.forEach(btn => btn.classList.remove('active'));
            
            document.getElementById(sectionId).classList.add('active');
            
            // Ativar o botão clicado
            if (event && event.target) {
                event.target.classList.add('active');
            }

            if (sectionId === 'relatorios') {
                atualizarEstatisticas();
            }
        }

        function showTab(tabId, event) {
            // Pegar o elemento clicado
            const clickedElement = event ? event.target : null;
            
            if (!clickedElement) return;
            
            const section = clickedElement.closest('.content-section');
            if (!section) return;
            
            const tabs = section.querySelectorAll('.tab');
            const contents = section.querySelectorAll('.tab-content');
            
            tabs.forEach(tab => tab.classList.remove('active'));
            contents.forEach(content => content.classList.remove('active'));
            
            clickedElement.classList.add('active');
            
            const targetContent = document.getElementById(tabId);
            if (targetContent) {
                targetContent.classList.add('active');
            }
        }

        function showMessage(message, type = 'success') {
            if (type === 'success') {
                abrirSuccessModal({
                    icon: '✅',
                    title: 'Sucesso!',
                    message: message
                });
            } else {
                // Para mensagens de erro e info, manter o comportamento original
                const container = document.getElementById('messageContainer');
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${type}`;
                messageDiv.textContent = message;
                
                container.innerHTML = '';
                container.appendChild(messageDiv);
                
                setTimeout(() => {
                    messageDiv.style.opacity = '0';
                    setTimeout(() => messageDiv.remove(), 500);
                }, 4000);
            }
        }

        // Funções do Modal de Sucesso
        function abrirSuccessModal(config) {
            document.getElementById('successIcon').textContent = config.icon || '✅';
            document.getElementById('successTitle').textContent = config.title || 'Sucesso!';
            document.getElementById('successMessage').textContent = config.message || 'Operação realizada com sucesso!';
            
            document.getElementById('successModal').classList.add('active');
        }

        function fecharSuccessModal() {
            document.getElementById('successModal').classList.remove('active');
        }

        // Fechar modal de sucesso clicando fora
        document.getElementById('successModal').addEventListener('click', function(e) {
            if (e.target === this) {
                fecharSuccessModal();
            }
        });

        function toggleClienteForm() {
            const tipo = document.querySelector('input[name="tipoCliente"]:checked').value;
            const camposFisica = document.getElementById('camposFisica');
            const camposJuridica = document.getElementById('camposJuridica');
            
            if (tipo === 'fisica') {
                camposFisica.style.display = 'block';
                camposJuridica.style.display = 'none';
                document.getElementById('nomeCliente').required = true;
                document.getElementById('telefoneCliente').required = true;
                document.getElementById('nomeEmpresa').required = false;
                document.getElementById('cnpjEmpresa').required = false;
                document.getElementById('razaoSocial').required = false;
                document.getElementById('inscricaoEstadual').required = false;
            } else {
                camposFisica.style.display = 'none';
                camposJuridica.style.display = 'block';
                document.getElementById('nomeCliente').required = false;
                document.getElementById('telefoneCliente').required = false;
                document.getElementById('nomeEmpresa').required = true;
                document.getElementById('cnpjEmpresa').required = true;
                document.getElementById('razaoSocial').required = true;
                document.getElementById('inscricaoEstadual').required = true;
            }
        }

        function toggleItemForm() {
            const tipo = document.querySelector('input[name="tipoItem"]:checked').value;
            const camposServico = document.getElementById('camposServico');
            const camposPeca = document.getElementById('camposPeca');
            const btnSalvar = document.getElementById('btnSalvarServico');
            
            if (tipo === 'servico') {
                camposServico.style.display = 'block';
                camposPeca.style.display = 'none';
                document.getElementById('descricaoServico').required = true;
                document.getElementById('valorServico').required = true;
                document.getElementById('descricaoPeca').required = false;
                document.getElementById('valorPeca').required = false;
                btnSalvar.textContent = '💾 Cadastrar Serviço';
            } else {
                camposServico.style.display = 'none';
                camposPeca.style.display = 'block';
                document.getElementById('descricaoServico').required = false;
                document.getElementById('valorServico').required = false;
                document.getElementById('descricaoPeca').required = true;
                document.getElementById('valorPeca').required = true;
                btnSalvar.textContent = '💾 Cadastrar Peça';
            }
        }

        function salvarCliente(event) {
            event.preventDefault();
            
            const tipo = document.querySelector('input[name="tipoCliente"]:checked').value;
            
            const cliente = {
                id: editingId || generateId(),
                type: 'cliente',
                tipoCliente: tipo,
                createdAt: new Date().toISOString()
            };

            if (tipo === 'fisica') {
                cliente.nome = document.getElementById('nomeCliente').value.toUpperCase() || '-';
                cliente.cpf = document.getElementById('cpfCliente').value || '-';
                cliente.telefone = document.getElementById('telefoneCliente').value || '-';
                cliente.endereco = document.getElementById('enderecoCliente').value.toUpperCase() || '-';
                cliente.cep = document.getElementById('cepCliente').value || '-';
            } else {
                cliente.nome = document.getElementById('nomeEmpresa').value.toUpperCase() || '-';
                cliente.cnpj = document.getElementById('cnpjEmpresa').value || '-';
                cliente.razaoSocial = document.getElementById('razaoSocial').value.toUpperCase() || '-';
                cliente.nomeFantasia = document.getElementById('nomeFantasia').value.toUpperCase() || '-';
                cliente.inscricaoEstadual = document.getElementById('inscricaoEstadual').value.toUpperCase() || '-';
                cliente.inscricaoMunicipal = document.getElementById('inscricaoMunicipal').value.toUpperCase() || '-';
                cliente.email = document.getElementById('emailEmpresa').value.toUpperCase() || '-';
                cliente.telefone = document.getElementById('telefoneEmpresa').value || '-';
                cliente.endereco = document.getElementById('enderecoEmpresa').value.toUpperCase() || '-';
                cliente.cep = document.getElementById('cepEmpresa').value || '-';
            }

            if (editingId) {
                const index = allData.findIndex(r => r.id === editingId);
                if (index !== -1) {
                    allData[index] = cliente;
                    showMessage('✅ Cliente atualizado com sucesso!', 'success');
                }
            } else {
                allData.push(cliente);
                showMessage('✅ Cliente cadastrado com sucesso!', 'success');
            }

            saveToLocalStorage();
            limparFormCliente();
            atualizarTodasListas();
            closeEditPanel();
        }

        function limparFormCliente() {
            document.getElementById('formCliente').reset();
            document.querySelector('input[name="tipoCliente"][value="fisica"]').checked = true;
            toggleClienteForm();
            editingId = null;
            document.getElementById('btnSalvarCliente').textContent = '💾 Cadastrar Cliente';
        }

        function editarCliente(id) {
            const cliente = allData.find(c => c.id === id);
            if (!cliente) {
                showMessage('❌ Cliente não encontrado', 'error');
                return;
            }

            openEditPanel();
            
            const content = document.getElementById('editPanelContent');
            content.innerHTML = `
                <h2>Editar Cliente</h2>
                <form id="formEditCliente" onsubmit="salvarClienteEdit(event, '${id}')">
                    ${cliente.tipoCliente === 'fisica' ? `
                        <div class="form-group">
                            <label>Nome *</label>
                            <input type="text" id="editNome" value="${cliente.nome || ''}" required>
                        </div>
                        <div class="form-group">
                            <label>CPF</label>
                            <input type="text" id="editCpf" value="${cliente.cpf || ''}" maxlength="14" oninput="maskCPF(this)">
                        </div>
                        <div class="form-group">
                            <label>Telefone *</label>
                            <input type="text" id="editTelefone" value="${cliente.telefone || ''}" required maxlength="15" oninput="maskPhone(this)">
                        </div>
                        <div class="form-group">
                            <label>CEP</label>
                            <input type="text" id="editCep" value="${cliente.cep || ''}" maxlength="9" oninput="maskCEP(this)">
                        </div>
                        <div class="form-group">
                            <label>Endereço</label>
                            <input type="text" id="editEndereco" value="${cliente.endereco || ''}">
                        </div>
                    ` : `
                        <div class="form-group">
                            <label>Nome *</label>
                            <input type="text" id="editNome" value="${cliente.nome || ''}" required>
                        </div>
                        <div class="form-group">
                            <label>CNPJ *</label>
                            <input type="text" id="editCnpj" value="${cliente.cnpj || ''}" required maxlength="18" oninput="maskCNPJ(this)">
                        </div>
                        <div class="form-group">
                            <label>Razão Social *</label>
                            <input type="text" id="editRazaoSocial" value="${cliente.razaoSocial || ''}" required>
                        </div>
                        <div class="form-group">
                            <label>Nome Fantasia</label>
                            <input type="text" id="editNomeFantasia" value="${cliente.nomeFantasia || ''}">
                        </div>
                        <div class="form-group">
                            <label>Inscrição Estadual *</label>
                            <input type="text" id="editInscricaoEstadual" value="${cliente.inscricaoEstadual || ''}" required>
                        </div>
                        <div class="form-group">
                            <label>Inscrição Municipal</label>
                            <input type="text" id="editInscricaoMunicipal" value="${cliente.inscricaoMunicipal || ''}">
                        </div>
                        <div class="form-group">
                            <label>E-mail</label>
                            <input type="email" id="editEmail" value="${cliente.email || ''}">
                        </div>
                        <div class="form-group">
                            <label>Telefone</label>
                            <input type="text" id="editTelefone" value="${cliente.telefone || ''}" maxlength="15" oninput="maskPhone(this)">
                        </div>
                        <div class="form-group">
                            <label>CEP</label>
                            <input type="text" id="editCep" value="${cliente.cep || ''}" maxlength="9" oninput="maskCEP(this)">
                        </div>
                        <div class="form-group">
                            <label>Endereço</label>
                            <input type="text" id="editEndereco" value="${cliente.endereco || ''}">
                        </div>
                    `}
                    <button type="submit" class="btn">💾 Salvar Alterações</button>
                    <button type="button" class="btn btn-secondary" onclick="closeEditPanel()">❌ Fechar</button>
                </form>
            `;
        }

        function salvarClienteEdit(event, id) {
            event.preventDefault();
            const cliente = allData.find(c => c.id === id);
            if (!cliente) return;

            cliente.nome = document.getElementById('editNome').value.toUpperCase() || '-';
            cliente.telefone = document.getElementById('editTelefone').value || '-';
            cliente.cep = document.getElementById('editCep').value || '-';
            cliente.endereco = document.getElementById('editEndereco').value.toUpperCase() || '-';

            if (cliente.tipoCliente === 'fisica') {
                cliente.cpf = document.getElementById('editCpf').value || '-';
            } else {
                cliente.cnpj = document.getElementById('editCnpj').value || '-';
                cliente.razaoSocial = document.getElementById('editRazaoSocial').value.toUpperCase() || '-';
                cliente.nomeFantasia = document.getElementById('editNomeFantasia').value.toUpperCase() || '-';
                cliente.inscricaoEstadual = document.getElementById('editInscricaoEstadual').value.toUpperCase() || '-';
                cliente.inscricaoMunicipal = document.getElementById('editInscricaoMunicipal').value.toUpperCase() || '-';
                cliente.email = document.getElementById('editEmail').value.toUpperCase() || '-';
            }

            saveToLocalStorage();
            showMessage('✅ Cliente atualizado com sucesso!', 'success');
            atualizarTodasListas();
            closeEditPanel();
        }

        // Funções do Modal de Confirmação
        function abrirConfirmModal(config) {
            document.getElementById('confirmIcon').textContent = config.icon || '⚠️';
            document.getElementById('confirmTitle').textContent = config.title || 'Confirmar Exclusão';
            document.getElementById('confirmMessage').textContent = config.message || 'Esta ação não pode ser desfeita.';
            document.getElementById('confirmItemName').textContent = config.itemName || '';
            document.getElementById('confirmItemDetails').innerHTML = config.itemDetails || '';
            
            const confirmBtn = document.getElementById('confirmDeleteBtn');
            confirmBtn.textContent = config.buttonText || '🗑️ Confirmar Exclusão';
            confirmBtn.onclick = config.onConfirm;
            
            document.getElementById('confirmModal').classList.add('active');
        }

        function fecharConfirmModal() {
            document.getElementById('confirmModal').classList.remove('active');
        }

        // Fechar modal clicando fora
        document.getElementById('confirmModal').addEventListener('click', function(e) {
            if (e.target === this) {
                fecharConfirmModal();
            }
        });

        function excluirCliente(id) {
            const cliente = allData.find(c => c.id === id);
            if (!cliente) return;

            const tipoCliente = cliente.tipoCliente === 'fisica' ? 'Pessoa Física' : 'Pessoa Jurídica';
            const documento = cliente.cpf || cliente.cnpj || 'Sem documento';
            
            abrirConfirmModal({
                icon: '👤',
                title: 'Excluir Cliente',
                message: 'Tem certeza que deseja excluir este cliente? Esta ação não pode ser desfeita.',
                itemName: cliente.nome,
                itemDetails: `
                    <strong>Tipo:</strong> ${tipoCliente}<br>
                    <strong>Documento:</strong> ${documento}<br>
                    ${cliente.telefone ? `<strong>Telefone:</strong> ${cliente.telefone}<br>` : ''}
                    ${cliente.razaoSocial ? `<strong>Razão Social:</strong> ${cliente.razaoSocial}` : ''}
                `,
                buttonText: '🗑️ Excluir Cliente',
                onConfirm: () => confirmarExclusaoCliente(id)
            });
        }

        function confirmarExclusaoCliente(id) {
            allData = allData.filter(c => c.id !== id);
            saveToLocalStorage();
            showMessage('✅ Cliente excluído com sucesso!', 'success');
            atualizarTodasListas();
            fecharConfirmModal();
        }

        function filtrarClientes() {
            renderizarClientes();
        }

        function renderizarClientes() {
            const searchTerm = document.getElementById('searchCliente').value.toLowerCase();
            const filterTipo = document.getElementById('filterTipo').value;
            const tipoBusca = document.getElementById('tipoBuscaCliente').value;
            
            const clientes = allData.filter(item => {
                if (item.type !== 'cliente') return false;
                
                let matchSearch = !searchTerm;
                
                if (searchTerm) {
                    if (tipoBusca === 'nome') {
                        matchSearch = item.nome && item.nome.toLowerCase().includes(searchTerm);
                    } else if (tipoBusca === 'cpf') {
                        matchSearch = item.cpf && item.cpf.includes(searchTerm);
                    } else if (tipoBusca === 'cnpj') {
                        matchSearch = item.cnpj && item.cnpj.includes(searchTerm);
                    }
                }
                
                const matchTipo = !filterTipo || item.tipoCliente === filterTipo;
                
                return matchSearch && matchTipo;
            });

            const container = document.getElementById('listaClientes');
            
            if (clientes.length === 0 && (searchTerm || filterTipo)) {
                container.innerHTML = '<div class="message info">❌ Nenhum cliente encontrado</div>';
                return;
            }
            
            if (clientes.length === 0) {
                container.innerHTML = '';
                return;
            }

            let html = '<table><thead><tr><th>Nome</th><th>CPF/CNPJ</th><th>Telefone</th><th>Tipo</th><th>Ações</th></tr></thead><tbody>';
            
            clientes.forEach(cliente => {
                html += `
                    <tr>
                        <td>${cliente.nome || '-'}</td>
                        <td>${cliente.cpf || cliente.cnpj || '-'}</td>
                        <td>${cliente.telefone || '-'}</td>
                        <td>${cliente.tipoCliente === 'fisica' ? 'Pessoa Física' : 'Pessoa Jurídica'}</td>
                        <td class="action-buttons">
                            <button class="btn btn-secondary btn-small" onclick="editarCliente('${cliente.id}')">✏️ Editar</button>
                            <button class="btn btn-danger btn-small" onclick="excluirCliente('${cliente.id}')">🗑️ Excluir</button>
                        </td>
                    </tr>
                `;
            });
            
            html += '</tbody></table>';
            container.innerHTML = html;
            
            // Aplicar redimensionamento de colunas
            const table = container.querySelector('table');
            if (table) {
                makeTableResizable(table, 'contasReceber');
            }
            
            // Adicionar classe para expandir seção
            const section = container.closest('.content-section');
            if (section) section.classList.add('with-table');
        }

        function salvarServico(event) {
            event.preventDefault();
            
            const tipo = document.querySelector('input[name="tipoItem"]:checked').value;
            
            const item = {
                id: editingId || generateId(),
                type: 'servico',
                tipoItem: tipo,
                createdAt: new Date().toISOString()
            };

            if (tipo === 'servico') {
                item.descricao = document.getElementById('descricaoServico').value.toUpperCase() || '-';
                item.codigo = document.getElementById('codigoServico').value.toUpperCase() || '-';
                item.valor = parseFloat(document.getElementById('valorServico').value) || 0;
            } else {
                item.descricao = document.getElementById('descricaoPeca').value.toUpperCase() || '-';
                item.codigo = document.getElementById('codigoPeca').value.toUpperCase() || '-';
                item.valor = parseFloat(document.getElementById('valorPeca').value) || 0;
            }

            if (editingId) {
                const index = allData.findIndex(r => r.id === editingId);
                if (index !== -1) {
                    allData[index] = item;
                    showMessage(`✅ ${tipo === 'servico' ? 'Serviço' : 'Peça'} atualizado com sucesso!`, 'success');
                }
            } else {
                allData.push(item);
                showMessage(`✅ ${tipo === 'servico' ? 'Serviço' : 'Peça'} cadastrado com sucesso!`, 'success');
            }

            saveToLocalStorage();
            limparFormServico();
            atualizarTodasListas();
            closeEditPanel();
        }

        function limparFormServico() {
            document.getElementById('formServico').reset();
            document.querySelector('input[name="tipoItem"][value="servico"]').checked = true;
            toggleItemForm();
            editingId = null;
        }

        function editarServico(id) {
            const item = allData.find(s => s.id === id);
            if (!item) {
                showMessage('❌ Item não encontrado', 'error');
                return;
            }

            openEditPanel();
            
            const tipoItem = item.tipoItem || 'servico';
            const tituloTipo = tipoItem === 'servico' ? 'Serviço' : 'Peça';
            
            const content = document.getElementById('editPanelContent');
            
            if (tipoItem === 'servico') {
                content.innerHTML = `
                    <h2>Editar Serviço</h2>
                    <form id="formEditServico" onsubmit="salvarServicoEdit(event, '${id}')">
                        <div class="form-group">
                            <label>Descrição *</label>
                            <input type="text" id="editDescricao" value="${item.descricao || ''}" required>
                        </div>
                        <div class="form-group">
                            <label>Código do Serviço</label>
                            <input type="text" id="editCodigo" value="${item.codigo || ''}">
                        </div>
                        <div class="form-group">
                            <label>Valor (R$) *</label>
                            <input type="number" id="editValor" value="${item.valor || 0}" step="0.01" min="0" required>
                        </div>
                        <button type="submit" class="btn">💾 Salvar Alterações</button>
                        <button type="button" class="btn btn-secondary" onclick="closeEditPanel()">❌ Fechar</button>
                    </form>
                `;
            } else {
                content.innerHTML = `
                    <h2>Editar Peça</h2>
                    <form id="formEditServico" onsubmit="salvarServicoEdit(event, '${id}')">
                        <div class="form-group">
                            <label>Descrição *</label>
                            <input type="text" id="editDescricao" value="${item.descricao || ''}" required>
                        </div>
                        <div class="form-group">
                            <label>Código da Peça</label>
                            <input type="text" id="editCodigo" value="${item.codigo || ''}">
                        </div>
                        <div class="form-group">
                            <label>Valor (R$) *</label>
                            <input type="number" id="editValor" value="${item.valor || 0}" step="0.01" min="0" required>
                        </div>
                        <button type="submit" class="btn">💾 Salvar Alterações</button>
                        <button type="button" class="btn btn-secondary" onclick="closeEditPanel()">❌ Fechar</button>
                    </form>
                `;
            }
        }

        function salvarServicoEdit(event, id) {
            event.preventDefault();
            const item = allData.find(s => s.id === id);
            if (!item) return;

            const tipoItem = item.tipoItem || 'servico';

            item.descricao = document.getElementById('editDescricao').value.toUpperCase() || '-';
            item.valor = parseFloat(document.getElementById('editValor').value) || 0;

            if (tipoItem === 'servico') {
                item.codigo = document.getElementById('editCodigo').value.toUpperCase() || '-';
            } else if (tipoItem === 'peca') {
                item.codigo = document.getElementById('editCodigo').value.toUpperCase() || '-';
            }

            saveToLocalStorage();
            showMessage(`✅ ${tipoItem === 'servico' ? 'Serviço' : 'Peça'} atualizado com sucesso!`, 'success');
            atualizarTodasListas();
            closeEditPanel();
        }

        function excluirServico(id) {
            const item = allData.find(s => s.id === id);
            if (!item) return;

            const tipoItem = item.tipoItem || 'servico';
            const tituloTipo = tipoItem === 'servico' ? 'Serviço' : 'Peça';
            const iconeTipo = tipoItem === 'servico' ? '🔧' : '🔩';

            let detalhes = `
                <strong>Valor:</strong> R$ ${(item.valor || 0).toFixed(2)}<br>
                <strong>Cadastrado em:</strong> ${new Date(item.createdAt).toLocaleDateString('pt-BR')}
            `;

            if (tipoItem === 'peca') {
                detalhes += `<br><strong>Código:</strong> ${item.codigo || 'Não informado'}`;
            }

            abrirConfirmModal({
                icon: iconeTipo,
                title: `Excluir ${tituloTipo}`,
                message: `Tem certeza que deseja excluir este ${tipoItem}? Esta ação não pode ser desfeita.`,
                itemName: item.descricao,
                itemDetails: detalhes,
                buttonText: `🗑️ Excluir ${tituloTipo}`,
                onConfirm: () => confirmarExclusaoServico(id)
            });
        }

        function confirmarExclusaoServico(id) {
            const item = allData.find(s => s.id === id);
            const tipoItem = item ? (item.tipoItem || 'servico') : 'item';
            const tituloTipo = tipoItem === 'servico' ? 'Serviço' : 'Peça';
            
            allData = allData.filter(s => s.id !== id);
            saveToLocalStorage();
            showMessage(`✅ ${tituloTipo} excluído com sucesso!`, 'success');
            atualizarTodasListas();
            fecharConfirmModal();
        }

        function filtrarServicos() {
            renderizarServicos();
        }

        function renderizarServicos() {
            const searchTerm = document.getElementById('searchServico').value.toLowerCase();
            const filterTipo = document.getElementById('filterTipoItem').value;
            
            const itens = allData.filter(item => {
                if (item.type !== 'servico') return false;
                
                const matchSearch = !searchTerm || (item.descricao && item.descricao.toLowerCase().includes(searchTerm)) ||
                                   (item.codigo && item.codigo.toLowerCase().includes(searchTerm)) ||
                                   (item.marca && item.marca.toLowerCase().includes(searchTerm));
                
                const matchTipo = !filterTipo || (item.tipoItem === filterTipo);
                
                return matchSearch && matchTipo;
            });

            const container = document.getElementById('listaServicos');
            
            const hasSearchCriteria = searchTerm || filterTipo;
            
            if (itens.length === 0 && hasSearchCriteria) {
                container.innerHTML = '<div class="message info">❌ Nenhum item encontrado</div>';
                return;
            }
            
            if (itens.length === 0) {
                container.innerHTML = '';
                return;
            }

            let html = '<table><thead><tr><th>Código</th><th>Descrição</th><th>Tipo</th><th style="text-align: right;">Valor</th><th style="text-align: center;">Ações</th></tr></thead><tbody>';
            
            itens.forEach(item => {
                const tipoItem = item.tipoItem || 'servico';
                const tipoIcon = tipoItem === 'servico' ? '🔧' : '🔩';
                const tipoLabel = tipoItem === 'servico' ? 'Serviço' : 'Peça';
                const codigo = item.codigo && item.codigo !== '-' ? item.codigo : '-';
                
                html += `
                    <tr>
                        <td>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <span style="font-size: 14px;">${tipoIcon}</span>
                                <strong>${codigo}</strong>
                            </div>
                        </td>
                        <td><strong>${item.descricao || '-'}</strong></td>
                        <td>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <span style="font-size: 16px;">${tipoIcon}</span>
                                <strong>${tipoLabel}</strong>
                            </div>
                        </td>
                        <td><strong>R$ ${(item.valor || 0).toFixed(2)}</strong></td>
                        <td class="action-buttons">
                            <button class="btn btn-secondary btn-small" onclick="editarServico('${item.id}')" title="Editar">✏️ Editar</button>
                            <button class="btn btn-danger btn-small" onclick="excluirServico('${item.id}')" title="Excluir">🗑️ Excluir</button>
                        </td>
                    </tr>
                `;
            });
            
            html += '</tbody></table>';
            container.innerHTML = html;
            
            // Aplicar redimensionamento de colunas
            const table = container.querySelector('table');
            if (table) {
                makeTableResizable(table, 'servicos');
            }
            
            // Adicionar classe para expandir seção
            const section = container.closest('.content-section');
            if (section) section.classList.add('with-table');
        }

        function buscarClienteOS() {
            const searchTerm = document.getElementById('searchClienteOS').value.toLowerCase();
            const resultados = document.getElementById('resultadosClienteOS');
            
            if (searchTerm.length < 2) {
                resultados.style.display = 'none';
                return;
            }

            const clientes = allData.filter(item => {
                if (item.type !== 'cliente') return false;
                return (item.nome && item.nome.toLowerCase().includes(searchTerm)) ||
                       (item.cpf && item.cpf.includes(searchTerm)) ||
                       (item.cnpj && item.cnpj.includes(searchTerm)) ||
                       (item.razaoSocial && item.razaoSocial.toLowerCase().includes(searchTerm));
            });

            if (clientes.length === 0) {
                resultados.innerHTML = '<div class="search-result-item">❌ Nenhum cliente encontrado</div>';
                resultados.style.display = 'block';
                return;
            }

            let html = '';
            clientes.forEach(cliente => {
                html += `
                    <div class="search-result-item" onclick="selecionarClienteOS('${cliente.id}')">
                        <strong>${cliente.nome}</strong><br>
                        <small>${cliente.cpf || cliente.cnpj || 'Sem documento'}</small>
                        ${cliente.razaoSocial ? `<br><small>Razão Social: ${cliente.razaoSocial}</small>` : ''}
                    </div>
                `;
            });

            resultados.innerHTML = html;
            resultados.style.display = 'block';
        }

        function selecionarClienteOS(id) {
            const cliente = allData.find(c => c.id === id);
            if (!cliente) return;

            selectedClienteOS = cliente;
            document.getElementById('resultadosClienteOS').style.display = 'none';
            document.getElementById('searchClienteOS').value = cliente.nome;

            const container = document.getElementById('clienteSelecionadoOS');
            container.innerHTML = `
                <div class="selected-client">
                    <h4>✓ Cliente Selecionado</h4>
                    <p><strong>Nome:</strong> ${cliente.nome}</p>
                    <p><strong>${cliente.cpf ? 'CPF' : 'CNPJ'}:</strong> ${cliente.cpf || cliente.cnpj || '-'}</p>
                    ${cliente.telefone ? `<p><strong>Telefone:</strong> ${cliente.telefone}</p>` : ''}
                    ${cliente.razaoSocial ? `<p><strong>Razão Social:</strong> ${cliente.razaoSocial}</p>` : ''}
                </div>
            `;
        }

        function buscarServicoOS() {
            const searchTerm = document.getElementById('searchServicoOS').value.toLowerCase();
            const resultados = document.getElementById('resultadosServicoOS');
            
            if (searchTerm.length < 2) {
                resultados.style.display = 'none';
                return;
            }

            const itens = allData.filter(item => {
                if (item.type !== 'servico') return false;
                return item.descricao && item.descricao.toLowerCase().includes(searchTerm);
            });

            if (itens.length === 0) {
                resultados.innerHTML = '<div class="search-result-item">❌ Nenhum item encontrado</div>';
                resultados.style.display = 'block';
                return;
            }

            let html = '';
            itens.forEach(item => {
                const tipoIcon = item.tipoItem === 'servico' ? '🔧' : '🔩';
                const tipoLabel = item.tipoItem === 'servico' ? 'Serviço' : 'Peça';
                
                html += `
                    <div class="search-result-item" onclick="adicionarServicoOS('${item.id}')">
                        <strong>${tipoIcon} ${item.descricao}</strong><br>
                        <small>${tipoLabel} - R$ ${(item.valor || 0).toFixed(2)}</small>
                    </div>
                `;
            });

            resultados.innerHTML = html;
            resultados.style.display = 'block';
        }

        function adicionarServicoOS(id) {
            const item = allData.find(s => s.id === id);
            if (!item) return;

            const existente = currentOSItems.find(osItem => osItem.id === id);
            if (existente) {
                existente.quantidade++;
            } else {
                currentOSItems.push({
                    tipo: item.tipoItem || 'servico',
                    id: id,
                    descricao: item.descricao,
                    valor: item.valor,
                    quantidade: 1
                });
            }

            atualizarItensOS();
            document.getElementById('searchServicoOS').value = '';
            document.getElementById('resultadosServicoOS').style.display = 'none';
        }

        function atualizarItensOS() {
            const container = document.getElementById('itensOS');
            const totalContainer = document.getElementById('totalOS');
            const itensContainer = document.getElementById('itensOSContainer');
            
            if (currentOSItems.length === 0) {
                itensContainer.style.display = 'none';
                return;
            }

            itensContainer.style.display = 'block';

            let html = '<h4 style="color: #1e88e5; margin-bottom: 15px;">Itens Adicionados</h4>';
            let total = 0;

            currentOSItems.forEach((item, index) => {
                const subtotal = item.valor * item.quantidade;
                total += subtotal;
                const tipoIcon = item.tipo === 'servico' ? '🔧' : '🔩';
                
                html += `
                    <div class="os-item" style="flex-direction: column; align-items: flex-start; gap: 10px;">
                        <div style="width: 100%; display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <strong>${tipoIcon} ${item.descricao}</strong><br>
                                <small>Subtotal: R$ ${subtotal.toFixed(2)}</small>
                            </div>
                            <button type="button" class="btn btn-danger btn-small" onclick="removerItemOS(${index})">🗑️ Remover</button>
                        </div>
                        <div style="width: 100%; display: flex; gap: 15px; align-items: center; flex-wrap: wrap;">
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <label style="margin: 0; font-size: 15px;">Valor Unit.:</label>
                                <input type="number" step="0.01" min="0" value="${item.valor.toFixed(2)}" 
                                    onchange="alterarValorItem(${index}, this.value)"
                                    style="width: 100px; padding: 6px; border-radius: 6px; border: 2px solid #e2e8f0; background: #ffffff; color: #2d3748;">
                            </div>
                            <div class="item-quantity">
                                <label style="margin: 0; font-size: 15px; margin-right: 8px;">Qtd:</label>
                                <button type="button" class="qty-btn" onclick="alterarQuantidadeItem(${index}, -1)">-</button>
                                <span class="qty-display">${item.quantidade}</span>
                                <button type="button" class="qty-btn" onclick="alterarQuantidadeItem(${index}, 1)">+</button>
                            </div>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
            totalContainer.textContent = `Total: R$ ${total.toFixed(2)}`;
        }

        function alterarValorItem(index, novoValor) {
            const valor = parseFloat(novoValor);
            if (isNaN(valor) || valor < 0) return;
            
            currentOSItems[index].valor = valor;
            atualizarItensOS();
        }

        function alterarQuantidadeItem(index, delta) {
            const item = currentOSItems[index];
            const novaQtd = item.quantidade + delta;

            if (novaQtd < 1) return;

            item.quantidade = novaQtd;
            atualizarItensOS();
        }

        function removerItemOS(index) {
            currentOSItems.splice(index, 1);
            atualizarItensOS();
        }

        function salvarOS(event) {
            event.preventDefault();

            if (!selectedClienteOS) {
                showMessage('⚠️ Selecione um cliente para a ordem de serviço', 'error');
                return;
            }

            if (currentOSItems.length === 0) {
                showMessage('⚠️ Adicione pelo menos um serviço', 'error');
                return;
            }

            const total = currentOSItems.reduce((sum, item) => sum + (item.valor * item.quantidade), 0);

            const os = {
                id: editingId || generateId(),
                type: 'os',
                numeroOS: `OS-${String(osCounter).padStart(6, '0')}`,
                dataEntrada: new Date().toISOString(),
                status: 'aberta',
                clienteId: selectedClienteOS.id,
                placa: document.getElementById('placaOS').value.toUpperCase() || '-',
                marca: document.getElementById('marcaOS').value.toUpperCase() || '-',
                modelo: document.getElementById('modeloOS').value.toUpperCase() || '-',
                cor: document.getElementById('corOS').value.toUpperCase() || '-',
                quilometragem: document.getElementById('kmOS').value || '-',
                recebidoPor: document.getElementById('recebidoPorOS').value.toUpperCase() || '-',
                autorizadoPor: document.getElementById('autorizadoPorOS').value.toUpperCase() || '-',
                observacoes: document.getElementById('observacoesOS').value.toUpperCase() || '-',
                servicos: JSON.stringify(currentOSItems),
                total: total,
                createdAt: new Date().toISOString()
            };

            if (!editingId) {
                osCounter++;
            }

            if (editingId) {
                const index = allData.findIndex(r => r.id === editingId);
                if (index !== -1) {
                    allData[index] = os;
                    showMessage('✅ Ordem de serviço atualizada com sucesso!', 'success');
                }
            } else {
                allData.push(os);
                showMessage(`✅ Ordem de serviço ${os.numeroOS} criada com sucesso!`, 'success');
            }

            saveToLocalStorage();
            limparFormOS();
            atualizarTodasListas();
            closeEditPanel();
        }

        function limparFormOS() {
            document.getElementById('formOS').reset();
            currentOSItems = [];
            selectedClienteOS = null;
            document.getElementById('clienteSelecionadoOS').innerHTML = '';
            atualizarItensOS();
            editingId = null;
            document.getElementById('btnSalvarOS').textContent = '💾 Criar Ordem de Serviço';
        }

        function editarOS(id) {
            const os = allData.find(o => o.id === id);
            if (!os) {
                showMessage('❌ Ordem de serviço não encontrada', 'error');
                return;
            }

            openEditPanel();
            
            const cliente = allData.find(c => c.id === os.clienteId);
            const clienteNome = cliente ? cliente.nome : 'Cliente não encontrado';
            const clienteCpfCnpj = cliente ? (cliente.cpf || cliente.cnpj || '-') : '-';

            let editServicosArray = [];
            if (os.servicos) {
                try {
                    editServicosArray = JSON.parse(os.servicos);
                } catch (e) {}
            }

            const total = editServicosArray.reduce((sum, item) => sum + (item.valor * item.quantidade), 0);

            // Formatar datas para input date
            const dataEntradaFormatada = os.dataEntrada ? os.dataEntrada.split('T')[0] : '';
            const dataSaidaFormatada = os.dataSaida ? os.dataSaida.split('T')[0] : '';

            const content = document.getElementById('editPanelContent');
            content.innerHTML = `
                <h2>Editar Ordem de Serviço</h2>
                
                <div class="os-card" style="margin-bottom: 20px;">
                    <div class="os-card-header">
                        <div class="os-number">${os.numeroOS}</div>
                        <span class="badge badge-${os.status === 'aberta' ? 'open' : 'closed'}">${os.status === 'aberta' ? 'Aberta' : 'Fechada'}</span>
                    </div>
                    <div class="os-card-body">
                        <div class="os-info-row">
                            <span class="os-label">💰 Total Atual:</span>
                            <span class="os-value os-total" id="editTotalOSDisplay">R$ ${total.toFixed(2)}</span>
                        </div>
                    </div>
                </div>

                <form id="formEditOS" onsubmit="salvarEdicaoOS(event, '${id}')">
                    <div class="card">
                        <h3>📅 Datas da Ordem de Serviço</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Data de Entrada *</label>
                                <input type="date" id="editDataEntrada" value="${dataEntradaFormatada}" required>
                            </div>
                            <div class="form-group">
                                <label>Data de Saída</label>
                                <input type="date" id="editDataSaida" value="${dataSaidaFormatada}">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Status da OS *</label>
                            <select id="editStatusOS" required>
                                <option value="aberta" ${os.status === 'aberta' ? 'selected' : ''}>Aberta</option>
                                <option value="fechada" ${os.status === 'fechada' ? 'selected' : ''}>Fechada</option>
                            </select>
                        </div>
                    </div>

                    <div class="card">
                        <h3>👤 Alterar Cliente</h3>
                        <div class="form-group">
                            <label>Cliente Atual: <strong>${clienteNome}</strong></label>
                            <input type="text" id="searchClienteEditOS" placeholder="Digite para buscar outro cliente..." oninput="buscarClienteEditOS()">
                            <div id="resultadosClienteEditOS" class="search-results" style="display: none;"></div>
                        </div>
                        <div id="clienteSelecionadoEditOS">
                            <div class="selected-client">
                                <h4>✓ Cliente Atual</h4>
                                <p><strong>Nome:</strong> ${clienteNome}</p>
                                <p><strong>Documento:</strong> ${clienteCpfCnpj}</p>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <h3>🚗 Dados do Veículo</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Placa</label>
                                <input type="text" id="editPlaca" value="${os.placa || ''}" maxlength="8" placeholder="ABC-1234">
                            </div>
                            <div class="form-group">
                                <label>Marca</label>
                                <input type="text" id="editMarca" value="${os.marca || ''}">
                            </div>
                            <div class="form-group">
                                <label>Modelo</label>
                                <input type="text" id="editModelo" value="${os.modelo || ''}">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Cor</label>
                                <input type="text" id="editCor" value="${os.cor || ''}">
                            </div>
                            <div class="form-group">
                                <label>Quilometragem</label>
                                <input type="text" id="editQuilometragem" value="${os.quilometragem || ''}" placeholder="Ex: 50000 km" oninput="formatarQuilometragem(this)">
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <h3>👥 Responsáveis</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Recebido Por</label>
                                <input type="text" id="editRecebidoPor" value="${os.recebidoPor || ''}">
                            </div>
                            <div class="form-group">
                                <label>Autorizado Por</label>
                                <input type="text" id="editAutorizadoPor" value="${os.autorizadoPor || ''}">
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h3>🔧 Serviços e Peças</h3>
                        <div class="form-group">
                            <label for="searchServicoEditOS">Adicionar Novo Serviço ou Peça</label>
                            <input type="text" id="searchServicoEditOS" placeholder="Digite para buscar e adicionar..." oninput="buscarServicoEditOS()">
                            <div id="resultadosServicoEditOS" class="search-results" style="display: none;"></div>
                        </div>
                        <div id="editServicosOS"></div>
                    </div>
                    
                    <div class="card">
                        <h3>📝 Observações</h3>
                        <div class="form-group">
                            <textarea id="editObservacoes" rows="4" placeholder="Digite observações sobre a ordem de serviço...">${os.observacoes || ''}</textarea>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-top: 20px;">
                        <button type="submit" class="btn">💾 Salvar Todas as Alterações</button>
                        ${os.status === 'aberta' ? `
                            <button type="button" class="btn btn-secondary" onclick="fecharOSRapido('${id}')">✓ Fechar OS Rapidamente</button>
                        ` : `
                            <button type="button" class="btn btn-secondary" onclick="reabrirOS('${id}')">🔄 Reabrir OS</button>
                        `}
                        <button type="button" class="btn btn-danger" onclick="closeEditPanel()">❌ Fechar</button>
                    </div>
                </form>
            `;

            window.editServicosOSData = editServicosArray;
            window.editClienteOSData = cliente; // Armazenar cliente atual
            renderizarServicosEditOS();
        }

        function renderizarServicosEditOS() {
            const container = document.getElementById('editServicosOS');
            if (!container) return;

            let html = '';
            let total = 0;

            if (window.editServicosOSData.length === 0) {
                html = '<div class="message info" style="margin: 10px 0;">Nenhum serviço adicionado</div>';
            } else {
                window.editServicosOSData.forEach((item, index) => {
                    const subtotal = item.valor * item.quantidade;
                    total += subtotal;
                    const tipoIcon = item.tipo === 'servico' ? '🔧' : '🔩';

                    html += `
                        <div class="os-item" style="flex-direction: column; align-items: flex-start; gap: 10px; margin-bottom: 10px;">
                            <div style="width: 100%; display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <strong>${tipoIcon} ${item.descricao}</strong><br>
                                    <small>Subtotal: R$ ${subtotal.toFixed(2)}</small>
                                </div>
                                <button type="button" class="btn btn-danger btn-small" onclick="removerServicoEditOS(${index})">🗑️ Remover</button>
                            </div>
                            <div style="width: 100%; display: flex; gap: 15px; align-items: center; flex-wrap: wrap;">
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <label style="margin: 0; font-size: 15px;">Valor Unit.:</label>
                                    <input type="number" step="0.01" min="0" value="${item.valor.toFixed(2)}" 
                                        onchange="alterarValorServicoEditOS(${index}, this.value)"
                                        style="width: 100px; padding: 6px; border-radius: 6px; border: 2px solid #e2e8f0; background: #ffffff; color: #2d3748;">
                                </div>
                                <div class="item-quantity">
                                    <label style="margin: 0; font-size: 15px; margin-right: 8px;">Qtd:</label>
                                    <button type="button" class="qty-btn" onclick="alterarQtdServicoEditOS(${index}, -1)">-</button>
                                    <span class="qty-display">${item.quantidade}</span>
                                    <button type="button" class="qty-btn" onclick="alterarQtdServicoEditOS(${index}, 1)">+</button>
                                </div>
                            </div>
                        </div>
                    `;
                });
            }

            container.innerHTML = html;
            
            // Atualizar o total no card principal
            const totalDisplay = document.getElementById('editTotalOSDisplay');
            if (totalDisplay) {
                totalDisplay.textContent = `R$ ${total.toFixed(2)}`;
            }
        }

        function alterarValorServicoEditOS(index, novoValor) {
            const valor = parseFloat(novoValor);
            if (isNaN(valor) || valor < 0) return;
            
            window.editServicosOSData[index].valor = valor;
            renderizarServicosEditOS();
        }

        function alterarQtdServicoEditOS(index, delta) {
            const servico = window.editServicosOSData[index];
            const novaQtd = servico.quantidade + delta;

            if (novaQtd < 1) return;

            servico.quantidade = novaQtd;
            renderizarServicosEditOS();
        }

        function removerServicoEditOS(index) {
            window.editServicosOSData.splice(index, 1);
            renderizarServicosEditOS();
        }

        function buscarServicoEditOS() {
            const searchTerm = document.getElementById('searchServicoEditOS').value.toLowerCase();
            const resultados = document.getElementById('resultadosServicoEditOS');
            
            if (searchTerm.length < 2) {
                resultados.style.display = 'none';
                return;
            }

            const itens = allData.filter(item => {
                if (item.type !== 'servico') return false;
                return item.descricao && item.descricao.toLowerCase().includes(searchTerm);
            });

            if (itens.length === 0) {
                resultados.innerHTML = '<div class="search-result-item">❌ Nenhum item encontrado</div>';
                resultados.style.display = 'block';
                return;
            }

            let html = '';
            itens.forEach(item => {
                const tipoIcon = item.tipoItem === 'servico' ? '🔧' : '🔩';
                const tipoLabel = item.tipoItem === 'servico' ? 'Serviço' : 'Peça';
                
                html += `
                    <div class="search-result-item" onclick="adicionarServicoEditOS('${item.id}')">
                        <strong>${tipoIcon} ${item.descricao}</strong><br>
                        <small>${tipoLabel} - R$ ${(item.valor || 0).toFixed(2)}</small>
                    </div>
                `;
            });

            resultados.innerHTML = html;
            resultados.style.display = 'block';
        }

        function adicionarServicoEditOS(id) {
            const item = allData.find(s => s.id === id);
            if (!item) return;

            const existente = window.editServicosOSData.find(osItem => osItem.id === id);
            if (existente) {
                existente.quantidade++;
            } else {
                window.editServicosOSData.push({
                    tipo: item.tipoItem || 'servico',
                    id: id,
                    descricao: item.descricao,
                    valor: item.valor,
                    quantidade: 1
                });
            }

            renderizarServicosEditOS();
            document.getElementById('searchServicoEditOS').value = '';
            document.getElementById('resultadosServicoEditOS').style.display = 'none';
        }

        function buscarClienteEditOS() {
            const searchTerm = document.getElementById('searchClienteEditOS').value.toLowerCase();
            const resultados = document.getElementById('resultadosClienteEditOS');
            
            if (searchTerm.length < 2) {
                resultados.style.display = 'none';
                return;
            }

            const clientes = allData.filter(item => {
                if (item.type !== 'cliente') return false;
                return (item.nome && item.nome.toLowerCase().includes(searchTerm)) ||
                       (item.cpf && item.cpf.includes(searchTerm)) ||
                       (item.cnpj && item.cnpj.includes(searchTerm)) ||
                       (item.razaoSocial && item.razaoSocial.toLowerCase().includes(searchTerm));
            });

            if (clientes.length === 0) {
                resultados.innerHTML = '<div class="search-result-item">❌ Nenhum cliente encontrado</div>';
                resultados.style.display = 'block';
                return;
            }

            let html = '';
            clientes.forEach(cliente => {
                html += `
                    <div class="search-result-item" onclick="selecionarClienteEditOS('${cliente.id}')">
                        <strong>${cliente.nome}</strong><br>
                        <small>${cliente.cpf || cliente.cnpj || 'Sem documento'}</small>
                        ${cliente.razaoSocial ? `<br><small>Razão Social: ${cliente.razaoSocial}</small>` : ''}
                    </div>
                `;
            });

            resultados.innerHTML = html;
            resultados.style.display = 'block';
        }

        function selecionarClienteEditOS(id) {
            const cliente = allData.find(c => c.id === id);
            if (!cliente) return;

            window.editClienteOSData = cliente;
            document.getElementById('resultadosClienteEditOS').style.display = 'none';
            document.getElementById('searchClienteEditOS').value = cliente.nome;

            const container = document.getElementById('clienteSelecionadoEditOS');
            container.innerHTML = `
                <div class="selected-client">
                    <h4>✓ Novo Cliente Selecionado</h4>
                    <p><strong>Nome:</strong> ${cliente.nome}</p>
                    <p><strong>${cliente.cpf ? 'CPF' : 'CNPJ'}:</strong> ${cliente.cpf || cliente.cnpj || '-'}</p>
                    ${cliente.telefone ? `<p><strong>Telefone:</strong> ${cliente.telefone}</p>` : ''}
                    ${cliente.razaoSocial ? `<p><strong>Razão Social:</strong> ${cliente.razaoSocial}</p>` : ''}
                </div>
            `;
        }

        function fecharOSRapido(id) {
            const os = allData.find(o => o.id === id);
            if (!os) return;

            os.status = 'fechada';
            if (!os.dataSaida) {
                os.dataSaida = new Date().toISOString();
            }
            
            saveToLocalStorage();
            showMessage('✅ Ordem de serviço fechada rapidamente!', 'success');
            atualizarTodasListas();
            closeEditPanel();
        }

        function reabrirOS(id) {
            const os = allData.find(o => o.id === id);
            if (!os) return;

            os.status = 'aberta';
            os.dataSaida = null;
            
            saveToLocalStorage();
            showMessage('✅ Ordem de serviço reaberta com sucesso!', 'success');
            atualizarTodasListas();
            closeEditPanel();
        }

        function salvarEdicaoOS(event, id) {
            event.preventDefault();
            const os = allData.find(o => o.id === id);
            if (!os) return;

            const totalServicos = window.editServicosOSData.reduce((sum, item) => sum + (item.valor * item.quantidade), 0);

            // Atualizar datas
            const dataEntrada = document.getElementById('editDataEntrada').value;
            const dataSaida = document.getElementById('editDataSaida').value;
            
            os.dataEntrada = dataEntrada ? new Date(dataEntrada + 'T00:00:00').toISOString() : os.dataEntrada;
            os.dataSaida = dataSaida ? new Date(dataSaida + 'T00:00:00').toISOString() : null;
            
            // Atualizar status
            os.status = document.getElementById('editStatusOS').value || 'aberta';
            
            // Atualizar cliente (se foi alterado)
            if (window.editClienteOSData) {
                os.clienteId = window.editClienteOSData.id;
            }
            
            // Atualizar dados do veículo
            os.placa = document.getElementById('editPlaca').value.toUpperCase() || '-';
            os.marca = document.getElementById('editMarca').value.toUpperCase() || '-';
            os.modelo = document.getElementById('editModelo').value.toUpperCase() || '-';
            os.cor = document.getElementById('editCor').value.toUpperCase() || '-';
            os.quilometragem = document.getElementById('editQuilometragem').value || '-';
            
            // Atualizar responsáveis
            os.recebidoPor = document.getElementById('editRecebidoPor').value.toUpperCase() || '-';
            os.autorizadoPor = document.getElementById('editAutorizadoPor').value.toUpperCase() || '-';
            
            // Atualizar observações e serviços
            os.observacoes = document.getElementById('editObservacoes').value.toUpperCase() || '-';
            os.servicos = JSON.stringify(window.editServicosOSData);
            os.total = totalServicos;

            saveToLocalStorage();
            showMessage('✅ Ordem de serviço atualizada completamente!', 'success');
            atualizarTodasListas();
            closeEditPanel();
        }

        function excluirOS(id) {
            const os = allData.find(o => o.id === id);
            if (!os) return;

            const cliente = allData.find(c => c.id === os.clienteId);
            const clienteNome = cliente ? cliente.nome : 'Cliente não encontrado';
            const statusBadge = os.status === 'aberta' ? '🟡 Aberta' : '🟢 Fechada';
            
            abrirConfirmModal({
                icon: '📋',
                title: 'Excluir Ordem de Serviço',
                message: 'Tem certeza que deseja excluir esta ordem de serviço? Esta ação não pode ser desfeita.',
                itemName: os.numeroOS,
                itemDetails: `
                    <strong>Cliente:</strong> ${clienteNome}<br>
                    <strong>Status:</strong> ${statusBadge}<br>
                    <strong>Valor Total:</strong> R$ ${(os.total || 0).toFixed(2)}<br>
                    <strong>Data de Entrada:</strong> ${new Date(os.dataEntrada).toLocaleDateString('pt-BR')}<br>
                    ${os.placa ? `<strong>Veículo:</strong> ${os.marca || ''} ${os.modelo || ''} (${os.placa})` : ''}
                `,
                buttonText: '🗑️ Excluir OS',
                onConfirm: () => confirmarExclusaoOS(id)
            });
        }

        function confirmarExclusaoOS(id) {
            allData = allData.filter(o => o.id !== id);
            saveToLocalStorage();
            showMessage('✅ Ordem de serviço excluída com sucesso!', 'success');
            atualizarTodasListas();
            fecharConfirmModal();
        }

        function fecharOS(id) {
            const os = allData.find(o => o.id === id);
            if (!os) return;

            os.status = 'fechada';
            os.dataSaida = new Date().toISOString();
            
            saveToLocalStorage();
            showMessage('✅ Ordem de serviço fechada com sucesso!', 'success');
            atualizarTodasListas();
            closeEditPanel();
        }

        function filtrarOS() {
            renderizarOS();
        }

        function renderizarOS() {
            const searchOS = document.getElementById('searchOS').value.toLowerCase();
            const searchPlaca = document.getElementById('searchPlacaOS').value.toLowerCase();
            const searchCpfCnpj = document.getElementById('searchCpfCnpjOS').value.toLowerCase();
            const dataEntrada = document.getElementById('dataEntradaOS').value;
            const dataSaida = document.getElementById('dataSaidaOS').value;
            const filterStatus = document.getElementById('filterStatusOS').value;
            
            const ordens = allData.filter(item => {
                if (item.type !== 'os') return false;
                
                const matchOS = !searchOS || (item.numeroOS && item.numeroOS.toLowerCase().includes(searchOS));
                
                const matchPlaca = !searchPlaca || (item.placa && item.placa.toLowerCase().includes(searchPlaca));
                
                const matchCpfCnpj = !searchCpfCnpj || (item.clienteId && (() => {
                    const cliente = allData.find(c => c.id === item.clienteId);
                    return cliente && (
                        (cliente.cpf && cliente.cpf.includes(searchCpfCnpj)) ||
                        (cliente.cnpj && cliente.cnpj.includes(searchCpfCnpj))
                    );
                })());
                
                const matchStatus = !filterStatus || item.status === filterStatus;
                
                let matchDataEntrada = true;
                if (dataEntrada) {
                    const osDate = new Date(item.dataEntrada).toISOString().split('T')[0];
                    matchDataEntrada = osDate === dataEntrada;
                }
                
                let matchDataSaida = true;
                if (dataSaida && item.dataSaida) {
                    const osDateSaida = new Date(item.dataSaida).toISOString().split('T')[0];
                    matchDataSaida = osDateSaida === dataSaida;
                }
                
                return matchOS && matchPlaca && matchCpfCnpj && matchStatus && matchDataEntrada && matchDataSaida;
            });

            const container = document.getElementById('listaOS');
            
            const hasSearchCriteria = searchOS || searchPlaca || searchCpfCnpj || dataEntrada || dataSaida || filterStatus;
            
            if (ordens.length === 0 && hasSearchCriteria) {
                container.innerHTML = '<div class="message info">❌ Nenhuma ordem de serviço encontrada</div>';
                return;
            }
            
            if (ordens.length === 0) {
                container.innerHTML = '';
                return;
            }

            let html = `
                <div class="os-cards-container">
                    ${ordens.map(os => {
                        const cliente = allData.find(c => c.id === os.clienteId);
                        const clienteNome = cliente ? cliente.nome : 'Cliente não encontrado';
                        const dataFormatada = new Date(os.dataEntrada).toLocaleDateString('pt-BR');
                        const statusClass = os.status === 'aberta' ? 'open' : 'closed';
                        const statusText = os.status === 'aberta' ? 'Aberta' : 'Fechada';
                        
                        return `
                            <div class="os-card">
                                <div class="os-card-header">
                                    <div class="os-number">${os.numeroOS || '-'}</div>
                                    <span class="badge badge-${statusClass}">${statusText}</span>
                                </div>
                                <div class="os-card-body">
                                    <div class="os-info-row">
                                        <span class="os-label">👤 Cliente:</span>
                                        <span class="os-value">${clienteNome}</span>
                                    </div>
                                    <div class="os-info-row">
                                        <span class="os-label">🚗 Veículo:</span>
                                        <span class="os-value">${os.marca || '-'} ${os.modelo || '-'} ${os.placa ? `(${os.placa})` : ''}</span>
                                    </div>
                                    <div class="os-info-row">
                                        <span class="os-label">📅 Entrada:</span>
                                        <span class="os-value">${dataFormatada}</span>
                                    </div>
                                    <div class="os-info-row">
                                        <span class="os-label">💰 Total:</span>
                                        <span class="os-value os-total">R$ ${(os.total || 0).toFixed(2)}</span>
                                    </div>
                                </div>
                                <div class="os-card-actions">
                                    <button class="btn btn-secondary btn-small" onclick="gerarPDFOS('${os.id}')" title="Gerar PDF">📄</button>
                                    <button class="btn btn-secondary btn-small" onclick="editarOS('${os.id}')" title="Ver Detalhes">👁️</button>
                                    <button class="btn btn-danger btn-small" onclick="excluirOS('${os.id}')" title="Excluir">🗑️</button>
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;
            
            container.innerHTML = html;
            
            // Aplicar redimensionamento de colunas
            const table = container.querySelector('table');
            if (table) {
                makeTableResizable(table, 'ordens');
            }
            
            // Adicionar classe para expandir seção
            const section = container.closest('.content-section');
            if (section) section.classList.add('with-table');
        }

        function salvarContaPagar(event) {
            event.preventDefault();
            
            const conta = {
                id: editingId || generateId(),
                type: 'contaPagar',
                numeroDocumento: document.getElementById('numeroDocPagar').value.toUpperCase() || '-',
                empresaNome: document.getElementById('empresaNomePagar').value.toUpperCase() || '-',
                empresaCnpj: document.getElementById('empresaPagar').value || '-',
                dataLancamento: document.getElementById('dataLancamentoPagar').value || '-',
                dataVencimento: document.getElementById('dataVencimentoPagar').value || '-',
                valor: parseFloat(document.getElementById('valorPagar').value) || 0,
                statusPagamento: document.getElementById('statusPagar').value || 'aberto',
                createdAt: new Date().toISOString()
            };

            if (editingId) {
                const index = allData.findIndex(r => r.id === editingId);
                if (index !== -1) {
                    allData[index] = conta;
                    showMessage('✅ Conta atualizada com sucesso!', 'success');
                }
            } else {
                allData.push(conta);
                showMessage('✅ Conta cadastrada com sucesso!', 'success');
            }

            saveToLocalStorage();
            limparFormContaPagar();
            atualizarTodasListas();
            closeEditPanel();
        }

        function limparFormContaPagar() {
            document.getElementById('formContaPagar').reset();
            editingId = null;
            document.getElementById('btnSalvarContaPagar').textContent = '💾 Cadastrar Conta';
            document.getElementById('empresaSelecionadaPagar').innerHTML = '';
        }

        function buscarEmpresaPagar() {
            const searchTerm = document.getElementById('searchEmpresaPagar').value.toLowerCase();
            const resultados = document.getElementById('resultadosEmpresaPagar');
            
            if (searchTerm.length < 2) {
                resultados.style.display = 'none';
                return;
            }

            const empresas = allData.filter(item => {
                if (item.type !== 'cliente' || item.tipoCliente !== 'juridica') return false;
                return (item.nome && item.nome.toLowerCase().includes(searchTerm)) ||
                       (item.cnpj && item.cnpj.includes(searchTerm)) ||
                       (item.razaoSocial && item.razaoSocial.toLowerCase().includes(searchTerm));
            });

            if (empresas.length === 0) {
                resultados.innerHTML = '<div class="search-result-item">❌ Nenhuma empresa encontrada</div>';
                resultados.style.display = 'block';
                return;
            }

            let html = '';
            empresas.forEach(empresa => {
                html += `
                    <div class="search-result-item" onclick="selecionarEmpresaPagar('${empresa.id}')">
                        <strong>${empresa.nome}</strong><br>
                        <small>CNPJ: ${empresa.cnpj || 'Sem CNPJ'}</small>
                        ${empresa.razaoSocial ? `<br><small>Razão Social: ${empresa.razaoSocial}</small>` : ''}
                    </div>
                `;
            });

            resultados.innerHTML = html;
            resultados.style.display = 'block';
        }

        function selecionarEmpresaPagar(id) {
            const empresa = allData.find(c => c.id === id);
            if (!empresa) return;

            document.getElementById('resultadosEmpresaPagar').style.display = 'none';
            document.getElementById('searchEmpresaPagar').value = empresa.nome;
            document.getElementById('empresaNomePagar').value = empresa.nome;
            document.getElementById('empresaPagar').value = empresa.cnpj || '';

            const container = document.getElementById('empresaSelecionadaPagar');
            container.innerHTML = `
                <div class="selected-client">
                    <h4>✓ Empresa Selecionada</h4>
                    <p><strong>Nome:</strong> ${empresa.nome}</p>
                    <p><strong>CNPJ:</strong> ${empresa.cnpj || '-'}</p>
                    ${empresa.razaoSocial ? `<p><strong>Razão Social:</strong> ${empresa.razaoSocial}</p>` : ''}
                </div>
            `;
        }

        function editarContaPagar(id) {
            const conta = allData.find(c => c.id === id);
            if (!conta) {
                showMessage('❌ Conta não encontrada', 'error');
                return;
            }

            openEditPanel();
            
            const content = document.getElementById('editPanelContent');
            content.innerHTML = `
                <h2>Editar Conta a Pagar</h2>
                <form id="formEditContaPagar" onsubmit="salvarContaPagarEdit(event, '${id}')">
                    <div class="form-group">
                        <label>Número do Documento/NF *</label>
                        <input type="text" id="editNumeroDoc" value="${conta.numeroDocumento || ''}" required>
                    </div>
                    <div class="form-group">
                        <label>Nome da Empresa *</label>
                        <input type="text" id="editEmpresaNome" value="${conta.empresaNome || ''}" required>
                    </div>
                    <div class="form-group">
                        <label>CNPJ da Empresa *</label>
                        <input type="text" id="editEmpresaCnpj" value="${conta.empresaCnpj || ''}" required maxlength="18" oninput="maskCNPJ(this)">
                    </div>
                    <div class="form-group">
                        <label>Data de Lançamento *</label>
                        <input type="date" id="editDataLancamento" value="${conta.dataLancamento || ''}" required>
                    </div>
                    <div class="form-group">
                        <label>Data de Vencimento *</label>
                        <input type="date" id="editDataVencimento" value="${conta.dataVencimento || ''}" required>
                    </div>
                    <div class="form-group">
                        <label>Valor (R$) *</label>
                        <input type="number" id="editValor" value="${conta.valor || 0}" step="0.01" min="0" required>
                    </div>
                    <div class="form-group">
                        <label>Status *</label>
                        <select id="editStatus" required>
                            <option value="aberto" ${conta.statusPagamento === 'aberto' ? 'selected' : ''}>Em Aberto</option>
                            <option value="pago" ${conta.statusPagamento === 'pago' ? 'selected' : ''}>Pago</option>
                        </select>
                    </div>
                    <button type="submit" class="btn">💾 Salvar Alterações</button>
                    <button type="button" class="btn btn-secondary" onclick="closeEditPanel()">❌ Fechar</button>
                </form>
            `;
        }

        function salvarContaPagarEdit(event, id) {
            event.preventDefault();
            const conta = allData.find(c => c.id === id);
            if (!conta) return;

            conta.numeroDocumento = document.getElementById('editNumeroDoc').value.toUpperCase() || '-';
            conta.empresaNome = document.getElementById('editEmpresaNome').value.toUpperCase() || '-';
            conta.empresaCnpj = document.getElementById('editEmpresaCnpj').value || '-';
            conta.dataLancamento = document.getElementById('editDataLancamento').value || '-';
            conta.dataVencimento = document.getElementById('editDataVencimento').value || '-';
            conta.valor = parseFloat(document.getElementById('editValor').value) || 0;
            conta.statusPagamento = document.getElementById('editStatus').value || 'aberto';

            saveToLocalStorage();
            showMessage('✅ Conta atualizada com sucesso!', 'success');
            atualizarTodasListas();
            closeEditPanel();
        }

        function excluirContaPagar(id) {
            const conta = allData.find(c => c.id === id);
            if (!conta) return;

            const statusBadge = conta.statusPagamento === 'pago' ? '🟢 Pago' : '🔴 Em Aberto';
            
            abrirConfirmModal({
                icon: '💰',
                title: 'Excluir Conta a Pagar',
                message: 'Tem certeza que deseja excluir esta conta a pagar? Esta ação não pode ser desfeita.',
                itemName: `${conta.numeroDocumento} - ${conta.empresaNome}`,
                itemDetails: `
                    <strong>Empresa:</strong> ${conta.empresaNome}<br>
                    <strong>CNPJ:</strong> ${conta.empresaCnpj || 'Não informado'}<br>
                    <strong>Valor:</strong> R$ ${(conta.valor || 0).toFixed(2)}<br>
                    <strong>Vencimento:</strong> ${new Date(conta.dataVencimento).toLocaleDateString('pt-BR')}<br>
                    <strong>Status:</strong> ${statusBadge}
                `,
                buttonText: '🗑️ Excluir Conta',
                onConfirm: () => confirmarExclusaoContaPagar(id)
            });
        }

        function confirmarExclusaoContaPagar(id) {
            allData = allData.filter(c => c.id !== id);
            saveToLocalStorage();
            showMessage('✅ Conta a pagar excluída com sucesso!', 'success');
            atualizarTodasListas();
            fecharConfirmModal();
        }

        function filtrarContasPagar() {
            renderizarContasPagar();
        }

        function renderizarContasPagar() {
            const searchTerm = document.getElementById('searchContaPagar').value.toLowerCase();
            const filterStatus = document.getElementById('filterStatusPagar').value;
            const dataVencimentoBusca = document.getElementById('dataVencimentoBuscaPagar') ? document.getElementById('dataVencimentoBuscaPagar').value : '';
            
            const contas = allData.filter(item => {
                if (item.type !== 'contaPagar') return false;
                
                const matchSearch = !searchTerm || 
                    (item.numeroDocumento && item.numeroDocumento.toLowerCase().includes(searchTerm)) ||
                    (item.empresaNome && item.empresaNome.toLowerCase().includes(searchTerm)) ||
                    (item.empresaCnpj && item.empresaCnpj.includes(searchTerm));
                
                const matchStatus = !filterStatus || item.statusPagamento === filterStatus;
                
                let matchDataVencimento = true;
                if (dataVencimentoBusca && item.dataVencimento) {
                    matchDataVencimento = item.dataVencimento === dataVencimentoBusca;
                }
                
                return matchSearch && matchStatus && matchDataVencimento;
            });

            const container = document.getElementById('listaContasPagar');
            
            const hasSearchCriteria = searchTerm || filterStatus;
            
            if (contas.length === 0 && hasSearchCriteria) {
                container.innerHTML = '<div class="message info">❌ Nenhuma conta encontrada</div>';
                return;
            }
            
            if (contas.length === 0) {
                container.innerHTML = '';
                return;
            }

            let html = '<table><thead><tr><th>Documento</th><th>Empresa</th><th>CNPJ</th><th>Vencimento</th><th>Valor</th><th>Status</th><th>Ações</th></tr></thead><tbody>';
            
            contas.forEach(conta => {
                const dataVencimento = new Date(conta.dataVencimento).toLocaleDateString('pt-BR');
                
                html += `
                    <tr>
                        <td>${conta.numeroDocumento || '-'}</td>
                        <td>${conta.empresaNome || '-'}</td>
                        <td>${conta.empresaCnpj || '-'}</td>
                        <td>${dataVencimento}</td>
                        <td><strong>R$ ${(conta.valor || 0).toFixed(2)}</strong></td>
                        <td><span class="badge badge-${conta.statusPagamento === 'pago' ? 'paid' : 'pending'}">${conta.statusPagamento === 'pago' ? 'Pago' : 'Em Aberto'}</span></td>
                        <td class="action-buttons">
                            <button class="btn btn-secondary btn-small" onclick="editarContaPagar('${conta.id}')">✏️ Editar</button>
                            <button class="btn btn-danger btn-small" onclick="excluirContaPagar('${conta.id}')">🗑️ Excluir</button>
                        </td>
                    </tr>
                `;
            });
            
            html += '</tbody></table>';
            container.innerHTML = html;
            
            // Aplicar redimensionamento de colunas
            const table = container.querySelector('table');
            if (table) {
                makeTableResizable(table, 'contasReceber');
            }
            
            // Adicionar classe para expandir seção
            const section = container.closest('.content-section');
            if (section) section.classList.add('with-table');
        }

        function salvarContaReceber(event) {
            event.preventDefault();
            
            const conta = {
                id: editingId || generateId(),
                type: 'contaReceber',
                numeroDocumento: document.getElementById('numeroDocReceber').value.toUpperCase() || '-',
                dataEmissao: document.getElementById('dataEmissaoReceber').value || '-',
                dataVencimento: document.getElementById('dataVencimentoReceber').value || '-',
                valor: parseFloat(document.getElementById('valorReceber').value) || 0,
                statusPagamento: document.getElementById('statusReceber').value || 'aberto',
                createdAt: new Date().toISOString()
            };

            if (editingId) {
                const index = allData.findIndex(r => r.id === editingId);
                if (index !== -1) {
                    allData[index] = conta;
                    showMessage('✅ Conta atualizada com sucesso!', 'success');
                }
            } else {
                allData.push(conta);
                showMessage('✅ Conta cadastrada com sucesso!', 'success');
            }

            saveToLocalStorage();
            limparFormContaReceber();
            atualizarTodasListas();
            closeEditPanel();
        }

        function limparFormContaReceber() {
            document.getElementById('formContaReceber').reset();
            editingId = null;
            document.getElementById('btnSalvarContaReceber').textContent = '💾 Cadastrar Conta';
        }

        function editarContaReceber(id) {
            const conta = allData.find(c => c.id === id);
            if (!conta) {
                showMessage('❌ Conta não encontrada', 'error');
                return;
            }

            openEditPanel();
            
            const content = document.getElementById('editPanelContent');
            content.innerHTML = `
                <h2>Editar Conta a Receber</h2>
                <form id="formEditContaReceber" onsubmit="salvarContaReceberEdit(event, '${id}')">
                    <div class="form-group">
                        <label>Número do Documento/NF *</label>
                        <input type="text" id="editNumeroDoc" value="${conta.numeroDocumento || ''}" required>
                    </div>
                    <div class="form-group">
                        <label>Data de Emissão/Lançamento *</label>
                        <input type="date" id="editDataEmissao" value="${conta.dataEmissao || ''}" required>
                    </div>
                    <div class="form-group">
                        <label>Data de Vencimento *</label>
                        <input type="date" id="editDataVencimento" value="${conta.dataVencimento || ''}" required>
                    </div>
                    <div class="form-group">
                        <label>Valor (R$) *</label>
                        <input type="number" id="editValor" value="${conta.valor || 0}" step="0.01" min="0" required>
                    </div>
                    <div class="form-group">
                        <label>Status *</label>
                        <select id="editStatus" required>
                            <option value="aberto" ${conta.statusPagamento === 'aberto' ? 'selected' : ''}>Em Aberto</option>
                            <option value="pago" ${conta.statusPagamento === 'pago' ? 'selected' : ''}>Pago</option>
                        </select>
                    </div>
                    <button type="submit" class="btn">💾 Salvar Alterações</button>
                    <button type="button" class="btn btn-secondary" onclick="closeEditPanel()">❌ Fechar</button>
                </form>
            `;
        }

        function salvarContaReceberEdit(event, id) {
            event.preventDefault();
            const conta = allData.find(c => c.id === id);
            if (!conta) return;

            conta.numeroDocumento = document.getElementById('editNumeroDoc').value.toUpperCase() || '-';
            conta.dataEmissao = document.getElementById('editDataEmissao').value || '-';
            conta.dataVencimento = document.getElementById('editDataVencimento').value || '-';
            conta.valor = parseFloat(document.getElementById('editValor').value) || 0;
            conta.statusPagamento = document.getElementById('editStatus').value || 'aberto';

            saveToLocalStorage();
            showMessage('✅ Conta atualizada com sucesso!', 'success');
            atualizarTodasListas();
            closeEditPanel();
        }

        function excluirContaReceber(id) {
            const conta = allData.find(c => c.id === id);
            if (!conta) return;

            const statusBadge = conta.statusPagamento === 'pago' ? '🟢 Recebido' : '🟡 A Receber';
            
            abrirConfirmModal({
                icon: '💵',
                title: 'Excluir Conta a Receber',
                message: 'Tem certeza que deseja excluir esta conta a receber? Esta ação não pode ser desfeita.',
                itemName: conta.numeroDocumento,
                itemDetails: `
                    <strong>Valor:</strong> R$ ${(conta.valor || 0).toFixed(2)}<br>
                    <strong>Emissão:</strong> ${new Date(conta.dataEmissao).toLocaleDateString('pt-BR')}<br>
                    <strong>Vencimento:</strong> ${new Date(conta.dataVencimento).toLocaleDateString('pt-BR')}<br>
                    <strong>Status:</strong> ${statusBadge}
                `,
                buttonText: '🗑️ Excluir Conta',
                onConfirm: () => confirmarExclusaoContaReceber(id)
            });
        }

        function confirmarExclusaoContaReceber(id) {
            allData = allData.filter(c => c.id !== id);
            saveToLocalStorage();
            showMessage('✅ Conta a receber excluída com sucesso!', 'success');
            atualizarTodasListas();
            fecharConfirmModal();
        }

        function filtrarContasReceber() {
            renderizarContasReceber();
        }

        function renderizarContasReceber() {
            const searchTerm = document.getElementById('searchContaReceber').value.toLowerCase();
            const filterStatus = document.getElementById('filterStatusReceber').value;
            
            const contas = allData.filter(item => {
                if (item.type !== 'contaReceber') return false;
                
                const matchSearch = !searchTerm || 
                    (item.numeroDocumento && item.numeroDocumento.toLowerCase().includes(searchTerm));
                
                const matchStatus = !filterStatus || item.statusPagamento === filterStatus;
                
                return matchSearch && matchStatus;
            });

            const container = document.getElementById('listaContasReceber');
            
            const hasSearchCriteria = searchTerm || filterStatus;
            
            if (contas.length === 0 && hasSearchCriteria) {
                container.innerHTML = '<div class="message info">❌ Nenhuma conta encontrada</div>';
                return;
            }
            
            if (contas.length === 0) {
                container.innerHTML = '';
                return;
            }

            let html = '<table><thead><tr><th>Documento</th><th>Emissão</th><th>Vencimento</th><th>Valor</th><th>Status</th><th>Ações</th></tr></thead><tbody>';
            
            contas.forEach(conta => {
                const dataEmissao = new Date(conta.dataEmissao).toLocaleDateString('pt-BR');
                const dataVencimento = new Date(conta.dataVencimento).toLocaleDateString('pt-BR');
                
                html += `
                    <tr>
                        <td>${conta.numeroDocumento || '-'}</td>
                        <td>${dataEmissao}</td>
                        <td>${dataVencimento}</td>
                        <td><strong>R$ ${(conta.valor || 0).toFixed(2)}</strong></td>
                        <td><span class="badge badge-${conta.statusPagamento === 'pago' ? 'paid' : 'pending'}">${conta.statusPagamento === 'pago' ? 'Pago' : 'Em Aberto'}</span></td>
                        <td class="action-buttons">
                            <button class="btn btn-secondary btn-small" onclick="editarContaReceber('${conta.id}')">✏️ Editar</button>
                            <button class="btn btn-danger btn-small" onclick="excluirContaReceber('${conta.id}')">🗑️ Excluir</button>
                        </td>
                    </tr>
                `;
            });
            
            html += '</tbody></table>';
            container.innerHTML = html;
            
            // Aplicar redimensionamento de colunas
            const table = container.querySelector('table');
            if (table) {
                makeTableResizable(table, 'contasReceber');
            }
            
            // Adicionar classe para expandir seção
            const section = container.closest('.content-section');
            if (section) section.classList.add('with-table');
        }

        function atualizarEstatisticas() {
            const clientes = allData.filter(item => item.type === 'cliente');
            const clientesFisica = clientes.filter(c => c.tipoCliente === 'fisica').length;
            const clientesJuridica = clientes.filter(c => c.tipoCliente === 'juridica').length;
            
            const ordens = allData.filter(item => item.type === 'os');
            const osAbertas = ordens.filter(o => o.status === 'aberta').length;
            const osFechadas = ordens.filter(o => o.status === 'fechada').length;
            
            const faturamentoTotal = ordens.reduce((sum, os) => sum + (os.total || 0), 0);
            
            const hoje = new Date();
            const mesAtual = hoje.getMonth();
            const anoAtual = hoje.getFullYear();
            const faturamentoMensal = ordens
                .filter(os => {
                    const dataOS = new Date(os.dataEntrada);
                    return dataOS.getMonth() === mesAtual && dataOS.getFullYear() === anoAtual;
                })
                .reduce((sum, os) => sum + (os.total || 0), 0);

            const contasPagar = allData.filter(item => item.type === 'contaPagar');
            const contasPagarAbertas = contasPagar.filter(c => c.statusPagamento === 'aberto').length;

            const contasReceber = allData.filter(item => item.type === 'contaReceber');
            const contasReceberAbertas = contasReceber.filter(c => c.statusPagamento === 'aberto').length;

            const statsHTML = `
                <div class="stat-card">
                    <div class="stat-label">Total de Clientes</div>
                    <div class="stat-value">${clientes.length}</div>
                    <small>PF: ${clientesFisica} | PJ: ${clientesJuridica}</small>
                </div>
                <div class="stat-card">
                    <div class="stat-label">OS em Aberto</div>
                    <div class="stat-value">${osAbertas}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">OS Finalizadas</div>
                    <div class="stat-value">${osFechadas}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Faturamento Total</div>
                    <div class="stat-value">R$ ${faturamentoTotal.toFixed(2)}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Faturamento Mensal</div>
                    <div class="stat-value">R$ ${faturamentoMensal.toFixed(2)}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Contas a Pagar</div>
                    <div class="stat-value">${contasPagarAbertas}</div>
                    <small style="color: #e53935;">Em aberto</small>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Contas a Receber</div>
                    <div class="stat-value">${contasReceberAbertas}</div>
                    <small style="color: #43a047;">Em aberto</small>
                </div>
            `;

            document.getElementById('statsGrid').innerHTML = statsHTML;
        }

        function gerarRelatorio(tipo) {
            let titulo = '';
            let summaryHTML = '';
            let tableHTML = '';

            switch(tipo) {
                case 'osAbertas':
                    const osAbertas = allData.filter(item => item.type === 'os' && item.status === 'aberta');
                    const totalOSAbertas = osAbertas.reduce((sum, os) => sum + (os.total || 0), 0);
                    
                    titulo = '📂 Ordens de Serviço em Aberto';
                    summaryHTML = `
                        <div class="modal-summary-item">
                            <div class="modal-summary-label">Total de OS</div>
                            <div class="modal-summary-value warning">${osAbertas.length}</div>
                        </div>
                        <div class="modal-summary-item">
                            <div class="modal-summary-label">Valor Total</div>
                            <div class="modal-summary-value">R$ ${totalOSAbertas.toFixed(2)}</div>
                        </div>
                    `;
                    
                    tableHTML = '<table><thead><tr><th>Número</th><th>Data</th><th>Cliente</th><th>Veículo</th><th>Total</th></tr></thead><tbody>';
                    osAbertas.forEach(os => {
                        const cliente = allData.find(c => c.id === os.clienteId);
                        tableHTML += `<tr>
                            <td><strong>${os.numeroOS || '-'}</strong></td>
                            <td>${new Date(os.dataEntrada).toLocaleDateString('pt-BR')}</td>
                            <td>${cliente ? cliente.nome : 'N/A'}</td>
                            <td>${os.marca || '-'} ${os.modelo || '-'} (${os.placa || '-'})</td>
                            <td><strong>R$ ${(os.total || 0).toFixed(2)}</strong></td>
                        </tr>`;
                    });
                    tableHTML += '</tbody></table>';
                    break;

                case 'osFechadas':
                    const osFechadas = allData.filter(item => item.type === 'os' && item.status === 'fechada');
                    const totalOSFechadas = osFechadas.reduce((sum, os) => sum + (os.total || 0), 0);
                    
                    titulo = '✅ Ordens de Serviço Finalizadas';
                    summaryHTML = `
                        <div class="modal-summary-item">
                            <div class="modal-summary-label">Total de OS</div>
                            <div class="modal-summary-value success">${osFechadas.length}</div>
                        </div>
                        <div class="modal-summary-item">
                            <div class="modal-summary-label">Faturamento</div>
                            <div class="modal-summary-value success">R$ ${totalOSFechadas.toFixed(2)}</div>
                        </div>
                    `;
                    
                    tableHTML = '<table><thead><tr><th>Número</th><th>Data Entrada</th><th>Data Saída</th><th>Cliente</th><th>Total</th></tr></thead><tbody>';
                    osFechadas.forEach(os => {
                        const cliente = allData.find(c => c.id === os.clienteId);
                        tableHTML += `<tr>
                            <td><strong>${os.numeroOS || '-'}</strong></td>
                            <td>${new Date(os.dataEntrada).toLocaleDateString('pt-BR')}</td>
                            <td>${os.dataSaida ? new Date(os.dataSaida).toLocaleDateString('pt-BR') : '-'}</td>
                            <td>${cliente ? cliente.nome : 'N/A'}</td>
                            <td><strong>R$ ${(os.total || 0).toFixed(2)}</strong></td>
                        </tr>`;
                    });
                    tableHTML += '</tbody></table>';
                    break;

                case 'servicosExecutados':
                    const todasOS = allData.filter(item => item.type === 'os');
                    const servicosCount = new Map();
                    let totalServicos = 0;
                    
                    todasOS.forEach(os => {
                        if (os.servicos) {
                            try {
                                const servicos = JSON.parse(os.servicos);
                                servicos.forEach(s => {
                                    const key = s.descricao;
                                    servicosCount.set(key, (servicosCount.get(key) || 0) + s.quantidade);
                                    totalServicos += s.quantidade;
                                });
                            } catch (e) {}
                        }
                    });
                    
                    const servicosArray = Array.from(servicosCount.entries()).sort((a, b) => b[1] - a[1]);
                    const servicoMaisExecutado = servicosArray.length > 0 ? servicosArray[0] : ['Nenhum', 0];
                    
                    titulo = '🔧 Serviços Mais Executados';
                    summaryHTML = `
                        <div class="modal-summary-item">
                            <div class="modal-summary-label">Total Executado</div>
                            <div class="modal-summary-value">${totalServicos}</div>
                        </div>
                        <div class="modal-summary-item">
                            <div class="modal-summary-label">Tipos Diferentes</div>
                            <div class="modal-summary-value">${servicosArray.length}</div>
                        </div>
                        <div class="modal-summary-item">
                            <div class="modal-summary-label">Mais Executado</div>
                            <div class="modal-summary-value success">${servicoMaisExecutado[1]}x</div>
                        </div>
                    `;
                    
                    tableHTML = '<table><thead><tr><th>Serviço</th><th>Quantidade Executada</th><th>Percentual</th></tr></thead><tbody>';
                    servicosArray.forEach(([servico, qtd]) => {
                        const percentual = totalServicos > 0 ? ((qtd / totalServicos) * 100).toFixed(1) : 0;
                        tableHTML += `<tr>
                            <td>${servico}</td>
                            <td><strong>${qtd}</strong></td>
                            <td>${percentual}%</td>
                        </tr>`;
                    });
                    tableHTML += '</tbody></table>';
                    break;

                case 'contasPagar':
                    const dataInicialPagar = document.getElementById('dataInicialContasPagar').value;
                    const dataFinalPagar = document.getElementById('dataFinalContasPagar').value;
                    
                    let contasPagar = allData.filter(item => item.type === 'contaPagar');
                    
                    if (dataInicialPagar && dataFinalPagar) {
                        contasPagar = contasPagar.filter(conta => {
                            const dataVencimento = conta.dataVencimento;
                            return dataVencimento >= dataInicialPagar && dataVencimento <= dataFinalPagar;
                        });
                    }
                    
                    const totalContasPagar = contasPagar.reduce((sum, c) => sum + (c.valor || 0), 0);
                    const totalAbertoPagar = contasPagar.filter(c => c.statusPagamento === 'aberto').reduce((sum, c) => sum + (c.valor || 0), 0);
                    const totalPagoPagar = contasPagar.filter(c => c.statusPagamento === 'pago').reduce((sum, c) => sum + (c.valor || 0), 0);
                    const qtdAbertoPagar = contasPagar.filter(c => c.statusPagamento === 'aberto').length;
                    
                    titulo = '💰 Contas a Pagar';
                    if (dataInicialPagar && dataFinalPagar) {
                        titulo += ` - ${new Date(dataInicialPagar).toLocaleDateString('pt-BR')} a ${new Date(dataFinalPagar).toLocaleDateString('pt-BR')}`;
                    }
                    
                    summaryHTML = `
                        <div class="modal-summary-item">
                            <div class="modal-summary-label">Total Geral</div>
                            <div class="modal-summary-value">R$ ${totalContasPagar.toFixed(2)}</div>
                        </div>
                        <div class="modal-summary-item">
                            <div class="modal-summary-label">Em Aberto</div>
                            <div class="modal-summary-value danger">R$ ${totalAbertoPagar.toFixed(2)}</div>
                        </div>
                        <div class="modal-summary-item">
                            <div class="modal-summary-label">Pago</div>
                            <div class="modal-summary-value success">R$ ${totalPagoPagar.toFixed(2)}</div>
                        </div>
                        <div class="modal-summary-item">
                            <div class="modal-summary-label">Contas Pendentes</div>
                            <div class="modal-summary-value warning">${qtdAbertoPagar}</div>
                        </div>
                    `;
                    
                    tableHTML = '<table><thead><tr><th>Documento</th><th>Empresa</th><th>Lançamento</th><th>Vencimento</th><th>Valor</th><th>Status</th></tr></thead><tbody>';
                    contasPagar.forEach(c => {
                        tableHTML += `<tr>
                            <td>${c.numeroDocumento || '-'}</td>
                            <td>${c.empresaNome || '-'}</td>
                            <td>${new Date(c.dataLancamento).toLocaleDateString('pt-BR')}</td>
                            <td>${new Date(c.dataVencimento).toLocaleDateString('pt-BR')}</td>
                            <td><strong>R$ ${(c.valor || 0).toFixed(2)}</strong></td>
                            <td><span class="badge badge-${c.statusPagamento === 'pago' ? 'paid' : 'pending'}">${c.statusPagamento === 'pago' ? 'Pago' : 'Em Aberto'}</span></td>
                        </tr>`;
                    });
                    tableHTML += '</tbody></table>';
                    break;

                case 'contasReceber':
                    const dataInicialReceber = document.getElementById('dataInicialContasReceber').value;
                    const dataFinalReceber = document.getElementById('dataFinalContasReceber').value;
                    
                    let contasReceber = allData.filter(item => item.type === 'contaReceber');
                    
                    if (dataInicialReceber && dataFinalReceber) {
                        contasReceber = contasReceber.filter(conta => {
                            const dataVencimento = conta.dataVencimento;
                            return dataVencimento >= dataInicialReceber && dataVencimento <= dataFinalReceber;
                        });
                    }
                    
                    const totalContasReceber = contasReceber.reduce((sum, c) => sum + (c.valor || 0), 0);
                    const totalAbertoReceber = contasReceber.filter(c => c.statusPagamento === 'aberto').reduce((sum, c) => sum + (c.valor || 0), 0);
                    const totalPagoReceber = contasReceber.filter(c => c.statusPagamento === 'pago').reduce((sum, c) => sum + (c.valor || 0), 0);
                    const qtdAbertoReceber = contasReceber.filter(c => c.statusPagamento === 'aberto').length;
                    
                    titulo = '💵 Contas a Receber';
                    if (dataInicialReceber && dataFinalReceber) {
                        titulo += ` - ${new Date(dataInicialReceber).toLocaleDateString('pt-BR')} a ${new Date(dataFinalReceber).toLocaleDateString('pt-BR')}`;
                    }
                    
                    summaryHTML = `
                        <div class="modal-summary-item">
                            <div class="modal-summary-label">Total Geral</div>
                            <div class="modal-summary-value">R$ ${totalContasReceber.toFixed(2)}</div>
                        </div>
                        <div class="modal-summary-item">
                            <div class="modal-summary-label">A Receber</div>
                            <div class="modal-summary-value warning">R$ ${totalAbertoReceber.toFixed(2)}</div>
                        </div>
                        <div class="modal-summary-item">
                            <div class="modal-summary-label">Recebido</div>
                            <div class="modal-summary-value success">R$ ${totalPagoReceber.toFixed(2)}</div>
                        </div>
                        <div class="modal-summary-item">
                            <div class="modal-summary-label">Contas Pendentes</div>
                            <div class="modal-summary-value warning">${qtdAbertoReceber}</div>
                        </div>
                    `;
                    
                    tableHTML = '<table><thead><tr><th>Documento</th><th>Emissão</th><th>Vencimento</th><th>Valor</th><th>Status</th></tr></thead><tbody>';
                    contasReceber.forEach(c => {
                        tableHTML += `<tr>
                            <td>${c.numeroDocumento || '-'}</td>
                            <td>${new Date(c.dataEmissao).toLocaleDateString('pt-BR')}</td>
                            <td>${new Date(c.dataVencimento).toLocaleDateString('pt-BR')}</td>
                            <td><strong>R$ ${(c.valor || 0).toFixed(2)}</strong></td>
                            <td><span class="badge badge-${c.statusPagamento === 'pago' ? 'paid' : 'pending'}">${c.statusPagamento === 'pago' ? 'Pago' : 'Em Aberto'}</span></td>
                        </tr>`;
                    });
                    tableHTML += '</tbody></table>';
                    break;

                case 'faturamentoPeriodo':
                    const dataInicial = document.getElementById('dataInicialRelatorio').value;
                    const dataFinal = document.getElementById('dataFinalRelatorio').value;
                    
                    if (!dataInicial || !dataFinal) {
                        showMessage('⚠️ Selecione as datas inicial e final', 'error');
                        return;
                    }

                    const ordensPeriodo = allData.filter(item => {
                        if (item.type !== 'os') return false;
                        const dataOS = item.dataEntrada.split('T')[0];
                        return dataOS >= dataInicial && dataOS <= dataFinal;
                    });

                    const faturamentoPeriodo = ordensPeriodo.reduce((sum, os) => sum + (os.total || 0), 0);
                    const ticketMedio = ordensPeriodo.length > 0 ? faturamentoPeriodo / ordensPeriodo.length : 0;

                    titulo = `📊 Faturamento - ${new Date(dataInicial).toLocaleDateString('pt-BR')} a ${new Date(dataFinal).toLocaleDateString('pt-BR')}`;
                    summaryHTML = `
                        <div class="modal-summary-item">
                            <div class="modal-summary-label">Faturamento Total</div>
                            <div class="modal-summary-value">R$ ${faturamentoPeriodo.toFixed(2)}</div>
                        </div>
                        <div class="modal-summary-item">
                            <div class="modal-summary-label">Ordens de Serviço</div>
                            <div class="modal-summary-value">${ordensPeriodo.length}</div>
                        </div>
                        <div class="modal-summary-item">
                            <div class="modal-summary-label">Ticket Médio</div>
                            <div class="modal-summary-value success">R$ ${ticketMedio.toFixed(2)}</div>
                        </div>
                    `;
                    
                    tableHTML = '<table><thead><tr><th>Número OS</th><th>Data</th><th>Cliente</th><th>Valor</th></tr></thead><tbody>';
                    ordensPeriodo.forEach(os => {
                        const cliente = allData.find(c => c.id === os.clienteId);
                        tableHTML += `<tr>
                            <td><strong>${os.numeroOS || '-'}</strong></td>
                            <td>${new Date(os.dataEntrada).toLocaleDateString('pt-BR')}</td>
                            <td>${cliente ? cliente.nome : 'N/A'}</td>
                            <td><strong>R$ ${(os.total || 0).toFixed(2)}</strong></td>
                        </tr>`;
                    });
                    tableHTML += '</tbody></table>';
                    break;
            }

            // Abrir modal com os dados
            abrirModal(titulo, summaryHTML, tableHTML);
        }

        function abrirModal(titulo, summaryHTML, tableHTML) {
            document.getElementById('modalTitle').textContent = titulo;
            document.getElementById('modalSummary').innerHTML = summaryHTML;
            document.getElementById('modalTableContainer').innerHTML = tableHTML;
            
            // Aplicar redimensionamento nas tabelas do modal
            setTimeout(() => {
                const modalTable = document.querySelector('#modalTableContainer table');
                if (modalTable) {
                    makeTableResizable(modalTable, 'modal_' + titulo.replace(/\s+/g, '_').toLowerCase());
                }
            }, 100);
            
            document.getElementById('relatorioModal').classList.add('active');
        }

        function fecharModal() {
            document.getElementById('relatorioModal').classList.remove('active');
        }

        // Fechar modal clicando fora
        document.getElementById('relatorioModal').addEventListener('click', function(e) {
            if (e.target === this) {
                fecharModal();
            }
        });

        function gerarPDFOS(id) {
            const os = allData.find(o => o.id === id);
            if (!os) {
                showMessage('❌ Ordem de serviço não encontrada', 'error');
                return;
            }

            const cliente = allData.find(c => c.id === os.clienteId);
            const clienteNome = cliente ? cliente.nome : 'Cliente não encontrado';
            const clienteCpfCnpj = cliente ? (cliente.cpf || cliente.cnpj || '-') : '-';
            const clienteTelefone = cliente ? (cliente.telefone || '-') : '-';
            const clienteEndereco = cliente ? (cliente.endereco || '-') : '-';

            let servicosHTML = '';
            let total = 0;

            if (os.servicos) {
                try {
                    const servicos = JSON.parse(os.servicos);
                    servicos.forEach(s => {
                        const subtotal = s.valor * s.quantidade;
                        total += subtotal;
                        servicosHTML += `
                            <tr>
                                <td style="padding: 10px; border: 1px solid #333;">${s.descricao}</td>
                                <td style="padding: 10px; border: 1px solid #333; text-align: center;">${s.quantidade}</td>
                                <td style="padding: 10px; border: 1px solid #333; text-align: right;">R$ ${s.valor.toFixed(2)}</td>
                                <td style="padding: 10px; border: 1px solid #333; text-align: right;">R$ ${subtotal.toFixed(2)}</td>
                            </tr>
                        `;
                    });
                } catch (e) {}
            }

            const dataEntrada = new Date(os.dataEntrada).toLocaleDateString('pt-BR');
            const dataSaida = os.dataSaida ? new Date(os.dataSaida).toLocaleDateString('pt-BR') : '-';

            const pdfWindow = window.open('', '_blank');
            pdfWindow.document.write(`
                <!DOCTYPE html>
                <html lang="pt-BR">
                <head>
                    <meta charset="UTF-8">
                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                    <title>Ordem de Serviço - ${os.numeroOS}</title>
                    <style>
                        * {
                            margin: 0;
                            padding: 0;
                            box-sizing: border-box;
                        }
                        @page {
                            size: A4;
                            margin: 10mm;
                        }
                        body {
                            font-family: Arial, sans-serif;
                            padding: 15px;
                            background: white;
                            color: #000;
                            font-size: 10px;
                        }
                        .container {
                            max-width: 100%;
                            margin: 0 auto;
                            border: 2px solid #000;
                            padding: 12px;
                        }
                        .header {
                            text-align: center;
                            border-bottom: 2px solid #000;
                            padding-bottom: 8px;
                            margin-bottom: 12px;
                        }
                        .header h1 {
                            font-size: 18px;
                            margin-bottom: 3px;
                            color: #000;
                        }
                        .header h2 {
                            font-size: 14px;
                            color: #333;
                        }
                        .os-number {
                            background: #000;
                            color: white;
                            padding: 6px;
                            text-align: center;
                            font-size: 14px;
                            font-weight: bold;
                            margin-bottom: 12px;
                        }
                        .section {
                            margin-bottom: 10px;
                            border: 1px solid #333;
                            padding: 8px;
                            page-break-inside: avoid;
                        }
                        .section-title {
                            font-size: 11px;
                            font-weight: bold;
                            background: #f0f0f0;
                            padding: 5px;
                            margin: -8px -8px 8px -8px;
                            border-bottom: 1px solid #333;
                        }
                        .info-row {
                            display: flex;
                            margin-bottom: 4px;
                            line-height: 1.3;
                        }
                        .info-label {
                            font-weight: bold;
                            min-width: 120px;
                        }
                        .info-value {
                            flex: 1;
                        }
                        table {
                            width: 100%;
                            border-collapse: collapse;
                            margin-top: 5px;
                            font-size: 9px;
                        }
                        th {
                            background: #333;
                            color: white;
                            padding: 5px;
                            text-align: left;
                            border: 1px solid #333;
                        }
                        td {
                            padding: 5px;
                            border: 1px solid #333;
                        }
                        .total-section {
                            background: #000;
                            color: white;
                            padding: 8px;
                            text-align: right;
                            font-size: 14px;
                            font-weight: bold;
                            margin-top: 10px;
                        }
                        .observacoes {
                            min-height: 50px;
                            border: 1px solid #333;
                            padding: 6px;
                            margin-top: 5px;
                            font-size: 9px;
                        }
                        .footer {
                            margin-top: 15px;
                            padding-top: 10px;
                            border-top: 2px solid #000;
                            display: flex;
                            justify-content: space-between;
                            page-break-inside: avoid;
                        }
                        .assinatura {
                            text-align: center;
                            flex: 1;
                        }
                        .assinatura-linha {
                            border-top: 1px solid #000;
                            margin-top: 30px;
                            padding-top: 3px;
                            font-size: 9px;
                        }
                        .status-badge {
                            display: inline-block;
                            padding: 3px 10px;
                            border-radius: 3px;
                            font-weight: bold;
                            font-size: 10px;
                        }
                        .status-aberta {
                            background: #fff3cd;
                            color: #856404;
                            border: 1px solid #856404;
                        }
                        .status-fechada {
                            background: #d4edda;
                            color: #155724;
                            border: 1px solid #155724;
                        }
                        @media print {
                            body {
                                padding: 0;
                            }
                            .no-print {
                                display: none !important;
                            }
                            .container {
                                border: 2px solid #000;
                                padding: 12px;
                            }
                        }
                        .print-button {
                            position: fixed;
                            top: 20px;
                            right: 20px;
                            padding: 15px 30px;
                            background: #1e88e5;
                            color: white;
                            border: none;
                            border-radius: 8px;
                            font-size: 16px;
                            font-weight: bold;
                            cursor: pointer;
                            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
                            z-index: 1000;
                        }
                        .print-button:hover {
                            background: #1565c0;
                        }
                        @media screen {
                            body {
                                padding: 20px;
                            }
                            .container {
                                max-width: 800px;
                            }
                        }
                    </style>
                </head>
                <body>
                    <button class="print-button no-print" onclick="window.print()">🖨️ Imprimir / Salvar PDF</button>
                    
                    <div class="container">
                        <div class="header">
                            <h1>AUTO MECÂNICA PREMIUM</h1>
                            <h2>Ordem de Serviço</h2>
                        </div>

                        <div class="os-number">
                            ${os.numeroOS} - <span class="status-badge status-${os.status === 'aberta' ? 'aberta' : 'fechada'}">${os.status === 'aberta' ? 'ABERTA' : 'FECHADA'}</span>
                        </div>

                        <div class="section">
                            <div class="section-title">📅 INFORMAÇÕES DA ORDEM</div>
                            <div class="info-row">
                                <div class="info-label">Data de Entrada:</div>
                                <div class="info-value">${dataEntrada}</div>
                            </div>
                            <div class="info-row">
                                <div class="info-label">Data de Saída:</div>
                                <div class="info-value">${dataSaida}</div>
                            </div>
                            ${os.recebidoPor ? `
                            <div class="info-row">
                                <div class="info-label">Recebido Por:</div>
                                <div class="info-value">${os.recebidoPor}</div>
                            </div>
                            ` : ''}
                            ${os.autorizadoPor ? `
                            <div class="info-row">
                                <div class="info-label">Autorizado Por:</div>
                                <div class="info-value">${os.autorizadoPor}</div>
                            </div>
                            ` : ''}
                        </div>

                        <div class="section">
                            <div class="section-title">👤 DADOS DO CLIENTE</div>
                            <div class="info-row">
                                <div class="info-label">Nome:</div>
                                <div class="info-value">${clienteNome}</div>
                            </div>
                            <div class="info-row">
                                <div class="info-label">CPF/CNPJ:</div>
                                <div class="info-value">${clienteCpfCnpj}</div>
                            </div>
                            <div class="info-row">
                                <div class="info-label">Telefone:</div>
                                <div class="info-value">${clienteTelefone}</div>
                            </div>
                            <div class="info-row">
                                <div class="info-label">Endereço:</div>
                                <div class="info-value">${clienteEndereco}</div>
                            </div>
                        </div>

                        <div class="section">
                            <div class="section-title">🚗 DADOS DO VEÍCULO</div>
                            <div class="info-row">
                                <div class="info-label">Placa:</div>
                                <div class="info-value">${os.placa || '-'}</div>
                            </div>
                            <div class="info-row">
                                <div class="info-label">Marca:</div>
                                <div class="info-value">${os.marca || '-'}</div>
                            </div>
                            <div class="info-row">
                                <div class="info-label">Modelo:</div>
                                <div class="info-value">${os.modelo || '-'}</div>
                            </div>
                            <div class="info-row">
                                <div class="info-label">Cor:</div>
                                <div class="info-value">${os.cor || '-'}</div>
                            </div>
                            <div class="info-row">
                                <div class="info-label">Quilometragem:</div>
                                <div class="info-value">${os.quilometragem || '-'}</div>
                            </div>
                        </div>

                        <div class="section">
                            <div class="section-title">🔧 SERVIÇOS EXECUTADOS</div>
                            <table>
                                <thead>
                                    <tr>
                                        <th>Descrição</th>
                                        <th style="text-align: center; width: 80px;">Qtd</th>
                                        <th style="text-align: right; width: 120px;">Valor Unit.</th>
                                        <th style="text-align: right; width: 120px;">Subtotal</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${servicosHTML}
                                </tbody>
                            </table>
                        </div>

                        <div class="total-section">
                            VALOR TOTAL: R$ ${total.toFixed(2)}
                        </div>

                        ${os.observacoes ? `
                        <div class="section">
                            <div class="section-title">📝 OBSERVAÇÕES</div>
                            <div class="observacoes">${os.observacoes}</div>
                        </div>
                        ` : ''}

                        <div class="footer">
                            <div class="assinatura">
                                <div class="assinatura-linha">Assinatura do Cliente</div>
                            </div>
                            <div class="assinatura">
                                <div class="assinatura-linha">Assinatura do Responsável</div>
                            </div>
                        </div>
                    </div>
                </body>
                </html>
            `);
            pdfWindow.document.close();
        }

        function atualizarTodasListas() {
            renderizarClientes();
            renderizarServicos();
            renderizarOS();
            renderizarContasPagar();
            renderizarContasReceber();
        }

        function openEditPanel() {
            document.getElementById('editPanel').classList.add('open');
            document.getElementById('overlay').classList.add('active');
        }

        function closeEditPanel() {
            document.getElementById('editPanel').classList.remove('open');
            document.getElementById('overlay').classList.remove('active');
            editingId = null;
        }

        // Inicialização garantida - funciona em qualquer ambiente
        function inicializarSistema() {
            try {
                loadFromLocalStorage();
                console.log('✅ Sistema inicializado com sucesso!');
            } catch (error) {
                console.error('Erro ao inicializar:', error);
                showMessage('⚠️ Sistema iniciado. Dados serão salvos localmente.', 'info');
            }
        }

        // Funções de Configuração - Tema
        function toggleTheme() {
            currentTheme = currentTheme === 'light' ? 'dark' : 'light';
            applyTheme(currentTheme);
            saveToLocalStorage();
        }

        function applyTheme(theme) {
            const body = document.body;
            const themeIcon = document.getElementById('themeIcon');
            const themeText = document.getElementById('themeText');
            
            if (theme === 'dark') {
                body.classList.add('dark-theme');
                if (themeIcon) themeIcon.textContent = '🌙';
                if (themeText) themeText.textContent = 'Modo Escuro';
            } else {
                body.classList.remove('dark-theme');
                if (themeIcon) themeIcon.textContent = '☀️';
                if (themeText) themeText.textContent = 'Modo Claro';
            }
        }

        // Funções de Configuração - Fonte
        function adjustFontSize(value) {
            currentFontSize = parseInt(value);
            applyFontSize(currentFontSize);
            document.getElementById('fontSizeValue').textContent = currentFontSize + '%';
            saveToLocalStorage();
        }

        function applyFontSize(percentage) {
            const scaleFactor = percentage / 100;
            document.documentElement.style.fontSize = (16 * scaleFactor) + 'px';
            
            // Atualizar o slider se existir
            const slider = document.getElementById('fontSizeSlider');
            if (slider) {
                slider.value = percentage;
            }
            
            const valueDisplay = document.getElementById('fontSizeValue');
            if (valueDisplay) {
                valueDisplay.textContent = percentage + '%';
            }
        }

        function resetFontSize() {
            currentFontSize = 100;
            applyFontSize(100);
            document.getElementById('fontSizeSlider').value = 100;
            document.getElementById('fontSizeValue').textContent = '100%';
            saveToLocalStorage();
            showMessage('✅ Tamanho da fonte restaurado para o padrão!', 'success');
        }

        // Funções de Importação/Exportação
        function exportarDados() {
            const dataToExport = {
                data: allData,
                exportDate: new Date().toISOString(),
                version: '1.0',
                systemName: 'Sistema de Gestão de Oficina'
            };
            
            const dataStr = JSON.stringify(dataToExport, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `backup_oficina_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            showMessage('✅ Dados exportados com sucesso!', 'success');
        }

        function importarDados() {
            document.getElementById('importFile').click();
        }

        function processarImportacao(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    
                    // Validar estrutura dos dados
                    if (!importedData.data || !Array.isArray(importedData.data)) {
                        throw new Error('Formato de arquivo inválido');
                    }

                    // Confirmar importação
                    abrirConfirmModal({
                        icon: '📥',
                        title: 'Confirmar Importação',
                        message: 'Esta ação irá substituir todos os dados atuais. Tem certeza que deseja continuar?',
                        itemName: `${importedData.data.length} registros encontrados`,
                        itemDetails: `
                            <strong>Data do Backup:</strong> ${new Date(importedData.exportDate).toLocaleDateString('pt-BR')}<br>
                            <strong>Versão:</strong> ${importedData.version || 'N/A'}<br>
                            <strong>Sistema:</strong> ${importedData.systemName || 'N/A'}
                        `,
                        buttonText: '📥 Confirmar Importação',
                        onConfirm: () => confirmarImportacao(importedData.data)
                    });

                } catch (error) {
                    showMessage('❌ Erro ao ler arquivo: ' + error.message, 'error');
                }
            };
            reader.readAsText(file);
            
            // Limpar input
            event.target.value = '';
        }

        function confirmarImportacao(dadosImportados) {
            allData = dadosImportados;
            
            // Recalcular contador de OS
            const maxOS = Math.max(0, ...allData
                .filter(item => item.type === 'os' && item.numeroOS)
                .map(os => parseInt(os.numeroOS.replace('OS-', '')) || 0)
            );
            osCounter = maxOS + 1;
            
            saveToLocalStorage();
            atualizarTodasListas();
            atualizarEstatisticas();
            fecharConfirmModal();
            
            showMessage('✅ Dados importados com sucesso!', 'success');
        }

        // Múltiplas estratégias de inicialização
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', inicializarSistema);
        } else {
            inicializarSistema();
        }
        
        // Garantir inicialização mesmo em ambientes problemáticos
        window.addEventListener('load', function() {
            if (allData.length === 0) {
                inicializarSistema();
            }
        });
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'99e0f307404f480d',t:'MTc2MzA2NTAxMi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>